<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 16 End-to-end testing | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot</title>
  <meta name="description" content="Chapter 16 End-to-end testing | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 16 End-to-end testing | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="Cinderella-Man/hands-on-elixir-and-otp-cryptocurrency-trading-bot" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 16 End-to-end testing | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot" />
  <meta name="twitter:site" content="@kamilskowron" />
  
  

<meta name="author" content="Kamil Skowron" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="backtest-trading-strategy.html"/>
<link rel="next" href="mox-rocks.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-52FKGBX2B8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-52FKGBX2B8');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Hands-on Elixir & OTP: Cryptocurrency trading bot</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#want-to-learn-elixir-otp-by-creating-a-real-world-project"><i class="fa fa-check"></i>Want to learn Elixir &amp; OTP by creating a real-world project?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#limit-of-liabilitydisclaimer-of-warranty"><i class="fa fa-check"></i>Limit of Liability/Disclaimer of Warranty</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pdf-epub"><i class="fa fa-check"></i>PDF &amp; EPUB</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface-1"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-this-book-covers"><i class="fa fa-check"></i>What this book covers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributing-errata-and-source-code"><i class="fa fa-check"></i>Contributing, Errata and Source code</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><i class="fa fa-check"></i><b>1</b> Stream live cryptocurrency prices from the Binance WSS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#create-a-new-umbrella-app"><i class="fa fa-check"></i><b>1.2</b> Create a new umbrella app</a></li>
<li class="chapter" data-level="1.3" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#create-a-supervised-application-inside-an-umbrella"><i class="fa fa-check"></i><b>1.3</b> Create a supervised application inside an umbrella</a></li>
<li class="chapter" data-level="1.4" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#connect-to-binances-websocket-stream-using-the-websockex-module"><i class="fa fa-check"></i><b>1.4</b> Connect to Binance’s WebSocket Stream using the WebSockex module</a></li>
<li class="chapter" data-level="1.5" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#decode-incoming-events-using-the-jason-module"><i class="fa fa-check"></i><b>1.5</b> Decode incoming events using the Jason module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><i class="fa fa-check"></i><b>2</b> Create a naive trading strategy - a single trader process without supervision</a>
<ul>
<li class="chapter" data-level="2.1" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#initialisation"><i class="fa fa-check"></i><b>2.2</b> Initialisation</a></li>
<li class="chapter" data-level="2.3" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#how-trading-strategy-will-work"><i class="fa fa-check"></i><b>2.3</b> How trading strategy will work?</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-of-the-first-scenario"><i class="fa fa-check"></i><b>2.3.1</b> Implementation of the first scenario</a></li>
<li class="chapter" data-level="2.3.2" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-of-the-second-scenario"><i class="fa fa-check"></i><b>2.3.2</b> Implementation of the second scenario</a></li>
<li class="chapter" data-level="2.3.3" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-of-the-third-scenario"><i class="fa fa-check"></i><b>2.3.3</b> Implementation of the third scenario</a></li>
<li class="chapter" data-level="2.3.4" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-fallback-scenario"><i class="fa fa-check"></i><b>2.3.4</b> Implementation fallback scenario</a></li>
<li class="chapter" data-level="2.3.5" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#updating-the-naive-interface"><i class="fa fa-check"></i><b>2.3.5</b> Updating the Naive interface</a></li>
<li class="chapter" data-level="2.3.6" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#updating-streamer-app"><i class="fa fa-check"></i><b>2.3.6</b> Updating streamer app</a></li>
<li class="chapter" data-level="2.3.7" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#access-details-to-binance"><i class="fa fa-check"></i><b>2.3.7</b> Access details to Binance</a></li>
<li class="chapter" data-level="2.3.8" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#test-run"><i class="fa fa-check"></i><b>2.3.8</b> Test run</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html"><i class="fa fa-check"></i><b>3</b> Introduce PubSub as a communication method</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#design"><i class="fa fa-check"></i><b>3.2</b> Design</a></li>
<li class="chapter" data-level="3.3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#implementation"><i class="fa fa-check"></i><b>3.3</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html"><i class="fa fa-check"></i><b>4</b> Mock the Binance API</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#design-1"><i class="fa fa-check"></i><b>4.2</b> Design</a></li>
<li class="chapter" data-level="4.3" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#create-binancemock-app"><i class="fa fa-check"></i><b>4.3</b> Create “BinanceMock” app</a></li>
<li class="chapter" data-level="4.4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-getting-exchange-info"><i class="fa fa-check"></i><b>4.4</b> Implement getting exchange info</a></li>
<li class="chapter" data-level="4.5" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-placing-buy-and-sell-orders"><i class="fa fa-check"></i><b>4.5</b> Implement placing buy and sell orders</a></li>
<li class="chapter" data-level="4.6" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-order-retrival"><i class="fa fa-check"></i><b>4.6</b> Implement order retrival</a></li>
<li class="chapter" data-level="4.7" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-callback-for-incoming-trade-events"><i class="fa fa-check"></i><b>4.7</b> Implement callback for incoming trade events</a></li>
<li class="chapter" data-level="4.8" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#upgrade-trader-and-config"><i class="fa fa-check"></i><b>4.8</b> Upgrade trader and config</a></li>
<li class="chapter" data-level="4.9" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#test-the-implementation"><i class="fa fa-check"></i><b>4.9</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html"><i class="fa fa-check"></i><b>5</b> Enable parallel trading on multiple symbols</a>
<ul>
<li class="chapter" data-level="5.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#introduction---architectural-design"><i class="fa fa-check"></i><b>5.2</b> Introduction - architectural design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#update-application-supervisor"><i class="fa fa-check"></i><b>5.2.1</b> Update application supervisor</a></li>
<li class="chapter" data-level="5.2.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#add-interface-method"><i class="fa fa-check"></i><b>5.2.2</b> Add interface method</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.symbolsupervisor"><i class="fa fa-check"></i><b>5.3</b> Implement <code>Naive.SymbolSupervisor</code></a></li>
<li class="chapter" data-level="5.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.leader"><i class="fa fa-check"></i><b>5.4</b> Implement <code>Naive.Leader</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-leader-module"><i class="fa fa-check"></i><b>5.4.1</b> Updating the <code>leader</code> module</a></li>
<li class="chapter" data-level="5.4.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-naive.trader-module"><i class="fa fa-check"></i><b>5.4.2</b> Updating the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="5.4.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#finalizing-naive.leader-implementation"><i class="fa fa-check"></i><b>5.4.3</b> Finalizing <code>Naive.Leader</code> implementation</a></li>
<li class="chapter" data-level="5.4.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#iex-testing"><i class="fa fa-check"></i><b>5.4.4</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><i class="fa fa-check"></i><b>6</b> Introduce a <code>buy_down_interval</code> to make a single trader more profitable</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#why-we-need-to-buy-below-the-current-price-feature-overview"><i class="fa fa-check"></i><b>6.2</b> Why we need to buy below the current price? Feature overview</a></li>
<li class="chapter" data-level="6.3" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#naive.trader-implementation"><i class="fa fa-check"></i><b>6.3</b> <code>Naive.Trader</code> implementation</a></li>
<li class="chapter" data-level="6.4" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#naive.leader-implementation"><i class="fa fa-check"></i><b>6.4</b> <code>Naive.Leader</code> implementation</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#iex-testing-1"><i class="fa fa-check"></i><b>6.4.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html"><i class="fa fa-check"></i><b>7</b> Introduce a trader budget and calculating the quantity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#objectives-6"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#fetch-step_size"><i class="fa fa-check"></i><b>7.2</b> Fetch <code>step_size</code></a></li>
<li class="chapter" data-level="7.3" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state-inside-the-leader"><i class="fa fa-check"></i><b>7.3</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>’s state inside the <code>Leader</code></a></li>
<li class="chapter" data-level="7.4" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state"><i class="fa fa-check"></i><b>7.4</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>’s state</a></li>
<li class="chapter" data-level="7.5" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#calculate-quantity"><i class="fa fa-check"></i><b>7.5</b> Calculate quantity</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#iex-testing-2"><i class="fa fa-check"></i><b>7.5.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html"><i class="fa fa-check"></i><b>8</b> Add support for multiple transactions per order</a>
<ul>
<li class="chapter" data-level="8.1" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#objectives-7"><i class="fa fa-check"></i><b>8.1</b> Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#the-issue-with-the-current-implementation"><i class="fa fa-check"></i><b>8.2</b> The issue with the current implementation</a></li>
<li class="chapter" data-level="8.3" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.3</b> Improve buy order filled callback</a></li>
<li class="chapter" data-level="8.4" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#implement-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.4</b> Implement buy order “filled” callback</a></li>
<li class="chapter" data-level="8.5" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-sell-order-callback"><i class="fa fa-check"></i><b>8.5</b> Improve sell order callback</a></li>
<li class="chapter" data-level="8.6" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#test-the-implementation-1"><i class="fa fa-check"></i><b>8.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html"><i class="fa fa-check"></i><b>9</b> Run multiple traders in parallel</a>
<ul>
<li class="chapter" data-level="9.1" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#objectives-8"><i class="fa fa-check"></i><b>9.1</b> Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#describe-and-design-the-required-functionality"><i class="fa fa-check"></i><b>9.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="9.3" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-inside-naive.trader"><i class="fa fa-check"></i><b>9.3</b> Implement rebuy inside <code>Naive.Trader</code></a></li>
<li class="chapter" data-level="9.4" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-in-the-naive.leader"><i class="fa fa-check"></i><b>9.4</b> Implement rebuy in the <code>Naive.Leader</code></a></li>
<li class="chapter" data-level="9.5" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#improve-logs-by-assigning-ids-to-traders"><i class="fa fa-check"></i><b>9.5</b> Improve logs by assigning ids to traders</a></li>
<li class="chapter" data-level="9.6" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#test-the-implementation-2"><i class="fa fa-check"></i><b>9.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html"><i class="fa fa-check"></i><b>10</b> Fine-tune trading strategy per symbol</a>
<ul>
<li class="chapter" data-level="10.1" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#objectives-9"><i class="fa fa-check"></i><b>10.1</b> Objectives</a></li>
<li class="chapter" data-level="10.2" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#describe-and-design-the-required-functionality-1"><i class="fa fa-check"></i><b>10.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="10.3" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#add-docker-to-project"><i class="fa fa-check"></i><b>10.3</b> Add docker to project</a></li>
<li class="chapter" data-level="10.4" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#set-up-ecto-inside-the-naive-app"><i class="fa fa-check"></i><b>10.4</b> Set up <code>ecto</code> inside the <code>naive</code> app</a></li>
<li class="chapter" data-level="10.5" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#create-and-migrate-the-db"><i class="fa fa-check"></i><b>10.5</b> Create and migrate the DB</a></li>
<li class="chapter" data-level="10.6" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#seed-symbols-settings"><i class="fa fa-check"></i><b>10.6</b> Seed symbols’ settings</a></li>
<li class="chapter" data-level="10.7" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#update-the-naive.leader-to-fetch-settings"><i class="fa fa-check"></i><b>10.7</b> Update the <code>Naive.Leader</code> to fetch settings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html"><i class="fa fa-check"></i><b>11</b> Supervise and autostart streaming</a>
<ul>
<li class="chapter" data-level="11.1" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#objectives-10"><i class="fa fa-check"></i><b>11.1</b> Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#describe-and-design-the-required-functionality-2"><i class="fa fa-check"></i><b>11.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="11.3" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#register-the-streamer.binance-processes-with-names"><i class="fa fa-check"></i><b>11.3</b> Register the <code>Streamer.Binance</code> processes with names</a></li>
<li class="chapter" data-level="11.4" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#set-up-ecto-inside-the-streamer-app"><i class="fa fa-check"></i><b>11.4</b> Set up <code>ecto</code> inside the <code>streamer</code> app</a></li>
<li class="chapter" data-level="11.5" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#create-and-migrate-the-db-1"><i class="fa fa-check"></i><b>11.5</b> Create and migrate the db</a></li>
<li class="chapter" data-level="11.6" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#seed-default-settings"><i class="fa fa-check"></i><b>11.6</b> Seed default settings</a></li>
<li class="chapter" data-level="11.7" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-supervision-tree-and-start-streaming-functionality"><i class="fa fa-check"></i><b>11.7</b> Implement the supervision tree and start streaming functionality</a></li>
<li class="chapter" data-level="11.8" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-stop-functionality"><i class="fa fa-check"></i><b>11.8</b> Implement the stop functionality</a></li>
<li class="chapter" data-level="11.9" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-autostart-streaming-functionality"><i class="fa fa-check"></i><b>11.9</b> Implement the autostart streaming functionality</a></li>
<li class="chapter" data-level="11.10" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#test-the-implementation-3"><i class="fa fa-check"></i><b>11.10</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html"><i class="fa fa-check"></i><b>12</b> Start, stop, shutdown and autostart trading</a>
<ul>
<li class="chapter" data-level="12.1" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#objectives-11"><i class="fa fa-check"></i><b>12.1</b> Objectives</a></li>
<li class="chapter" data-level="12.2" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#describe-and-design-the-required-functionality-3"><i class="fa fa-check"></i><b>12.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="12.3" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#re-implement-the-start-trading-functionality"><i class="fa fa-check"></i><b>12.3</b> (Re-)Implement the start trading functionality</a></li>
<li class="chapter" data-level="12.4" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-stop-trading-functionality"><i class="fa fa-check"></i><b>12.4</b> Implement the stop trading functionality</a></li>
<li class="chapter" data-level="12.5" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-autostart-trading-functionality"><i class="fa fa-check"></i><b>12.5</b> Implement the autostart trading functionality</a></li>
<li class="chapter" data-level="12.6" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-shutdown-trading-functionality"><i class="fa fa-check"></i><b>12.6</b> Implement the shutdown trading functionality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html"><i class="fa fa-check"></i><b>13</b> Abstract duplicated supervision code</a>
<ul>
<li class="chapter" data-level="13.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#objectives-12"><i class="fa fa-check"></i><b>13.1</b> Objectives</a></li>
<li class="chapter" data-level="13.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#overview-of-requirements"><i class="fa fa-check"></i><b>13.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="13.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#pseudo-generalize-core.servicesupervisor-module"><i class="fa fa-check"></i><b>13.3</b> Pseudo generalize Core.ServiceSupervisor module</a></li>
<li class="chapter" data-level="13.4" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#utilize-pseudo-generalized-code-inside-the-naive-dynamicsymbolsupervisor"><i class="fa fa-check"></i><b>13.4</b> Utilize pseudo generalized code inside the Naive DynamicSymbolSupervisor</a></li>
<li class="chapter" data-level="13.5" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#implement-a-truly-generic-core.servicesupervisor"><i class="fa fa-check"></i><b>13.5</b> Implement a truly generic <code>Core.ServiceSupervisor</code></a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#first-path-starting-with-the-fetch_symbols_to_start0-function"><i class="fa fa-check"></i><b>13.5.1</b> First path starting with the <code>fetch_symbols_to_start/0</code> function</a></li>
<li class="chapter" data-level="13.5.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#second-path-starting-with-the-update_status2"><i class="fa fa-check"></i><b>13.5.2</b> Second path starting with the <code>update_status/2</code></a></li>
<li class="chapter" data-level="13.5.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#third-path-starting-with-the-get_pid1-function"><i class="fa fa-check"></i><b>13.5.3</b> Third path starting with the <code>get_pid/1</code> function</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#remove-boilerplate-using-use-macro"><i class="fa fa-check"></i><b>13.6</b> Remove boilerplate using <code>use</code> macro</a></li>
<li class="chapter" data-level="13.7" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#use-the-core.servicesupervisor-module-inside-the-streamer-application"><i class="fa fa-check"></i><b>13.7</b> Use the <code>Core.ServiceSupervisor</code> module inside the <code>streamer</code> application</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html"><i class="fa fa-check"></i><b>14</b> Store trade events and orders inside the database</a>
<ul>
<li class="chapter" data-level="14.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#objectives-13"><i class="fa fa-check"></i><b>14.1</b> Objectives</a></li>
<li class="chapter" data-level="14.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#overview-of-requirements-1"><i class="fa fa-check"></i><b>14.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="14.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-data_warehouse-application-in-the-umbrella"><i class="fa fa-check"></i><b>14.3</b> Create a new <code>data_warehouse</code> application in the umbrella</a></li>
<li class="chapter" data-level="14.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#connect-to-the-database-using-ecto"><i class="fa fa-check"></i><b>14.4</b> Connect to the database using Ecto</a></li>
<li class="chapter" data-level="14.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-trade-events-data"><i class="fa fa-check"></i><b>14.5</b> Store trade events’ data</a></li>
<li class="chapter" data-level="14.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-orders-data"><i class="fa fa-check"></i><b>14.6</b> Store orders’ data</a></li>
<li class="chapter" data-level="14.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#implement-supervision"><i class="fa fa-check"></i><b>14.7</b> Implement supervision</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-subscriber_settings-table"><i class="fa fa-check"></i><b>14.7.1</b> Create <code>subscriber_settings</code> table</a></li>
<li class="chapter" data-level="14.7.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#redesign-supervision-using-registry"><i class="fa fa-check"></i><b>14.7.2</b> Redesign supervision using Registry</a></li>
<li class="chapter" data-level="14.7.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-the-datawarehouse.subscriber.dynamicsupervisor-module"><i class="fa fa-check"></i><b>14.7.3</b> Create the <code>DataWarehouse.Subscriber.DynamicSupervisor</code> module</a></li>
<li class="chapter" data-level="14.7.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#register-worker-processes-using-via"><i class="fa fa-check"></i><b>14.7.4</b> Register Worker processes using :via</a></li>
<li class="chapter" data-level="14.7.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-supervision-level-for-registry-task-and-the-dynamicsupervisor"><i class="fa fa-check"></i><b>14.7.5</b> Create a new supervision level for Registry, Task and the DynamicSupervisor</a></li>
<li class="chapter" data-level="14.7.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#link-the-subscribersupervisor-to-the-application"><i class="fa fa-check"></i><b>14.7.6</b> Link the <code>SubscriberSupervisor</code> to the <code>Application</code></a></li>
<li class="chapter" data-level="14.7.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#add-interface"><i class="fa fa-check"></i><b>14.7.7</b> Add interface</a></li>
<li class="chapter" data-level="14.7.8" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#test"><i class="fa fa-check"></i><b>14.7.8</b> Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html"><i class="fa fa-check"></i><b>15</b> Backtest trading strategy</a>
<ul>
<li class="chapter" data-level="15.1" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#objectives-14"><i class="fa fa-check"></i><b>15.1</b> Objectives</a></li>
<li class="chapter" data-level="15.2" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#overview-of-requirements-2"><i class="fa fa-check"></i><b>15.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="15.3" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#implement-the-storing-task"><i class="fa fa-check"></i><b>15.3</b> Implement the storing task</a></li>
<li class="chapter" data-level="15.4" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#test-the-backtesting"><i class="fa fa-check"></i><b>15.4</b> Test the backtesting</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html"><i class="fa fa-check"></i><b>16</b> End-to-end testing</a>
<ul>
<li class="chapter" data-level="16.1" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#objectives-15"><i class="fa fa-check"></i><b>16.1</b> Objectives</a></li>
<li class="chapter" data-level="16.2" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#decide-on-the-tested-functionality"><i class="fa fa-check"></i><b>16.2</b> Decide on the tested functionality</a></li>
<li class="chapter" data-level="16.3" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#implement-basic-test"><i class="fa fa-check"></i><b>16.3</b> Implement basic test</a></li>
<li class="chapter" data-level="16.4" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#introduce-environment-based-config-files"><i class="fa fa-check"></i><b>16.4</b> Introduce environment based config files</a></li>
<li class="chapter" data-level="16.5" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#add-convenience-aliases"><i class="fa fa-check"></i><b>16.5</b> Add convenience aliases</a></li>
<li class="chapter" data-level="16.6" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#cache-initial-seed-data-inside-a-file"><i class="fa fa-check"></i><b>16.6</b> Cache initial seed data inside a file</a></li>
<li class="chapter" data-level="16.7" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#update-seeding-scripts-to-use-the-binancemock"><i class="fa fa-check"></i><b>16.7</b> Update seeding scripts to use the BinanceMock</a></li>
<li class="chapter" data-level="16.8" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#introduce-the-core-application"><i class="fa fa-check"></i><b>16.8</b> Introduce the Core application</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="mox-rocks.html"><a href="mox-rocks.html"><i class="fa fa-check"></i><b>17</b> Mox rocks</a>
<ul>
<li class="chapter" data-level="17.1" data-path="mox-rocks.html"><a href="mox-rocks.html#objectives-16"><i class="fa fa-check"></i><b>17.1</b> Objectives</a></li>
<li class="chapter" data-level="17.2" data-path="mox-rocks.html"><a href="mox-rocks.html#introduction-to-mock-based-tests"><i class="fa fa-check"></i><b>17.2</b> Introduction to mock based tests</a></li>
<li class="chapter" data-level="17.3" data-path="mox-rocks.html"><a href="mox-rocks.html#add-the-mox-package"><i class="fa fa-check"></i><b>17.3</b> Add the <code>mox</code> package</a></li>
<li class="chapter" data-level="17.4" data-path="mox-rocks.html"><a href="mox-rocks.html#investigate-the-naive.trader-module"><i class="fa fa-check"></i><b>17.4</b> Investigate the <code>Naive.Trader</code> module</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-binance-module"><i class="fa fa-check"></i><b>17.4.1</b> Mock the <code>Binance</code> module</a></li>
<li class="chapter" data-level="17.4.2" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-naiveleader-module"><i class="fa fa-check"></i><b>17.4.2</b> Mock the <code>NaiveLeader</code> module</a></li>
<li class="chapter" data-level="17.4.3" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-phoenix.pubsub-module"><i class="fa fa-check"></i><b>17.4.3</b> Mock the <code>Phoenix.PubSub</code> module</a></li>
<li class="chapter" data-level="17.4.4" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-logger-module"><i class="fa fa-check"></i><b>17.4.4</b> Mock the <code>Logger</code> module</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="mox-rocks.html"><a href="mox-rocks.html#implement-a-test-of-the-naive.trader-module"><i class="fa fa-check"></i><b>17.5</b> Implement a test of the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="17.6" data-path="mox-rocks.html"><a href="mox-rocks.html#define-an-alias-to-run-unit-tests"><i class="fa fa-check"></i><b>17.6</b> Define an alias to run unit tests</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="functional-elixir.html"><a href="functional-elixir.html"><i class="fa fa-check"></i><b>18</b> Functional Elixir</a>
<ul>
<li class="chapter" data-level="18.1" data-path="functional-elixir.html"><a href="functional-elixir.html#objectives-17"><i class="fa fa-check"></i><b>18.1</b> Objectives</a></li>
<li class="chapter" data-level="18.2" data-path="functional-elixir.html"><a href="functional-elixir.html#the-reasoning-behind-the-functional-approach"><i class="fa fa-check"></i><b>18.2</b> The reasoning behind the functional approach</a></li>
<li class="chapter" data-level="18.3" data-path="functional-elixir.html"><a href="functional-elixir.html#simplifying-by-splitting"><i class="fa fa-check"></i><b>18.3</b> Simplifying by splitting</a></li>
<li class="chapter" data-level="18.4" data-path="functional-elixir.html"><a href="functional-elixir.html#abstracting-the-pure-logic"><i class="fa fa-check"></i><b>18.4</b> Abstracting the “pure” logic</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="functional-elixir.html"><a href="functional-elixir.html#place-a-buy-order-rules"><i class="fa fa-check"></i><b>18.4.1</b> Place a buy order rules</a></li>
<li class="chapter" data-level="18.4.2" data-path="functional-elixir.html"><a href="functional-elixir.html#race-condition-rules"><i class="fa fa-check"></i><b>18.4.2</b> Race condition rules</a></li>
<li class="chapter" data-level="18.4.3" data-path="functional-elixir.html"><a href="functional-elixir.html#fetch-the-buy-order-rules"><i class="fa fa-check"></i><b>18.4.3</b> Fetch the buy order rules</a></li>
<li class="chapter" data-level="18.4.4" data-path="functional-elixir.html"><a href="functional-elixir.html#place-a-sell-order-rules"><i class="fa fa-check"></i><b>18.4.4</b> Place a sell order rules</a></li>
<li class="chapter" data-level="18.4.5" data-path="functional-elixir.html"><a href="functional-elixir.html#terminate-trader-rules"><i class="fa fa-check"></i><b>18.4.5</b> Terminate trader rules</a></li>
<li class="chapter" data-level="18.4.6" data-path="functional-elixir.html"><a href="functional-elixir.html#fetch-the-sell-order-rules"><i class="fa fa-check"></i><b>18.4.6</b> Fetch the sell order rules</a></li>
<li class="chapter" data-level="18.4.7" data-path="functional-elixir.html"><a href="functional-elixir.html#trigger-rebuy-rules"><i class="fa fa-check"></i><b>18.4.7</b> Trigger rebuy rules</a></li>
<li class="chapter" data-level="18.4.8" data-path="functional-elixir.html"><a href="functional-elixir.html#the-final-clause-rules"><i class="fa fa-check"></i><b>18.4.8</b> The final clause rules</a></li>
<li class="chapter" data-level="18.4.9" data-path="functional-elixir.html"><a href="functional-elixir.html#changes-to-the-naive.trader-module"><i class="fa fa-check"></i><b>18.4.9</b> Changes to the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="18.4.10" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---place-buy-order"><i class="fa fa-check"></i><b>18.4.10</b> <code>Naive.Trader</code> - place buy order</a></li>
<li class="chapter" data-level="18.4.11" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---race-condition-clause"><i class="fa fa-check"></i><b>18.4.11</b> <code>Naive.Trader</code> - Race condition clause</a></li>
<li class="chapter" data-level="18.4.12" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---place-a-sell-order"><i class="fa fa-check"></i><b>18.4.12</b> <code>Naive.Trader</code> - Place a sell order</a></li>
<li class="chapter" data-level="18.4.13" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---fetch-the-buy-order"><i class="fa fa-check"></i><b>18.4.13</b> <code>Naive.Trader</code> - Fetch the buy order</a></li>
<li class="chapter" data-level="18.4.14" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---terminate-the-trader"><i class="fa fa-check"></i><b>18.4.14</b> <code>Naive.Trader</code> - Terminate the trader</a></li>
<li class="chapter" data-level="18.4.15" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---fetch-the-sell-order"><i class="fa fa-check"></i><b>18.4.15</b> <code>Naive.Trader</code> - Fetch the sell order</a></li>
<li class="chapter" data-level="18.4.16" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---triggering-rebuy"><i class="fa fa-check"></i><b>18.4.16</b> <code>Naive.Trader</code> - Triggering rebuy</a></li>
<li class="chapter" data-level="18.4.17" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---the-final-ignore-clause"><i class="fa fa-check"></i><b>18.4.17</b> <code>Naive.Trader</code> - The final ignore clause</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="functional-elixir.html"><a href="functional-elixir.html#dealing-with-dirty-code"><i class="fa fa-check"></i><b>18.5</b> Dealing with dirty code</a></li>
<li class="chapter" data-level="18.6" data-path="functional-elixir.html"><a href="functional-elixir.html#making-dirty-code-testable"><i class="fa fa-check"></i><b>18.6</b> Making dirty code testable</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="functional-elixir.html"><a href="functional-elixir.html#passing-functions-arguments"><i class="fa fa-check"></i><b>18.6.1</b> Passing functions arguments</a></li>
<li class="chapter" data-level="18.6.2" data-path="functional-elixir.html"><a href="functional-elixir.html#passing-grouped-functions-as-a-context"><i class="fa fa-check"></i><b>18.6.2</b> Passing grouped functions as a context</a></li>
<li class="chapter" data-level="18.6.3" data-path="functional-elixir.html"><a href="functional-elixir.html#passing-grouped-modules-as-a-context"><i class="fa fa-check"></i><b>18.6.3</b> Passing grouped modules as a context</a></li>
<li class="chapter" data-level="18.6.4" data-path="functional-elixir.html"><a href="functional-elixir.html#injecting-modules-to-modules-attributes-based-on-the-configuration"><i class="fa fa-check"></i><b>18.6.4</b> Injecting modules to module’s attributes based on the configuration</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="functional-elixir.html"><a href="functional-elixir.html#the-power-with-in"><i class="fa fa-check"></i><b>18.7</b> The power <code>with</code>-in</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="functional-elixir.html"><a href="functional-elixir.html#idiomatic-error-handling"><i class="fa fa-check"></i><b>18.7.1</b> Idiomatic error handling</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="functional-elixir.html"><a href="functional-elixir.html#do-or-not-to-do"><i class="fa fa-check"></i><b>18.8</b> Do or not to do</a></li>
<li class="chapter" data-level="18.9" data-path="functional-elixir.html"><a href="functional-elixir.html#final-thoughts"><i class="fa fa-check"></i><b>18.9</b> Final thoughts</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html"><i class="fa fa-check"></i><b>19</b> Idiomatic OTP</a>
<ul>
<li class="chapter" data-level="19.1" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#objectives-18"><i class="fa fa-check"></i><b>19.1</b> Objectives</a></li>
<li class="chapter" data-level="19.2" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#the-concept"><i class="fa fa-check"></i><b>19.2</b> The concept</a></li>
<li class="chapter" data-level="19.3" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#initial-implementation"><i class="fa fa-check"></i><b>19.3</b> Initial implementation</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#maybe-functions"><i class="fa fa-check"></i><b>19.3.1</b> Maybe functions</a></li>
<li class="chapter" data-level="19.3.2" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#testing"><i class="fa fa-check"></i><b>19.3.2</b> Testing</a></li>
<li class="chapter" data-level="19.3.3" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#supervision"><i class="fa fa-check"></i><b>19.3.3</b> Supervision</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#idiomatic-solution"><i class="fa fa-check"></i><b>19.4</b> Idiomatic solution</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html"><i class="fa fa-check"></i><b>20</b> Idiomatic trading strategy</a>
<ul>
<li class="chapter" data-level="20.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#objectives-19"><i class="fa fa-check"></i><b>20.1</b> Objectives</a></li>
<li class="chapter" data-level="20.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#following-the-ohlc-footsteps"><i class="fa fa-check"></i><b>20.2</b> Following the OHLC footsteps</a></li>
<li class="chapter" data-level="20.3" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#simplifying-the-naive-supervision-tree"><i class="fa fa-check"></i><b>20.3</b> Simplifying the Naive supervision tree</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive.dynamictradersupervisor-module"><i class="fa fa-check"></i><b>20.3.1</b> The <code>Naive.DynamicTraderSupervisor</code> module</a></li>
<li class="chapter" data-level="20.3.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive-module"><i class="fa fa-check"></i><b>20.3.2</b> The <code>Naive</code> module</a></li>
<li class="chapter" data-level="20.3.3" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive.supervisor-module"><i class="fa fa-check"></i><b>20.3.3</b> The <code>Naive.Supervisor</code> module</a></li>
<li class="chapter" data-level="20.3.4" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive.trader-module"><i class="fa fa-check"></i><b>20.3.4</b> The <code>Naive.Trader</code> module</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#supporting-multiple-positions"><i class="fa fa-check"></i><b>20.4</b> Supporting multiple positions</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#initialization"><i class="fa fa-check"></i><b>20.4.1</b> Initialization</a></li>
<li class="chapter" data-level="20.4.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#parallelising-the-strategy"><i class="fa fa-check"></i><b>20.4.2</b> Parallelising the strategy</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#retrofitting-the-shutdown-functionality"><i class="fa fa-check"></i><b>20.5</b> Retrofitting the “shutdown” functionality</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#handling-updated-settings"><i class="fa fa-check"></i><b>20.5.1</b> Handling updated settings</a></li>
<li class="chapter" data-level="20.5.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#updating-the-naive.strategy-to-honour-the-shutdown-state"><i class="fa fa-check"></i><b>20.5.2</b> Updating the <code>Naive.Strategy</code> to honour the “shutdown” state</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#updating-the-strategy-to-handle-rebuys"><i class="fa fa-check"></i><b>20.6</b> Updating the Strategy to handle rebuys</a></li>
<li class="chapter" data-level="20.7" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#fetching-active-positions"><i class="fa fa-check"></i><b>20.7</b> Fetching active positions</a></li>
<li class="chapter" data-level="20.8" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#tidying-up"><i class="fa fa-check"></i><b>20.8</b> Tidying up</a></li>
<li class="chapter" data-level="20.9" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#final-thoughts-1"><i class="fa fa-check"></i><b>20.9</b> Final thoughts</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html"><i class="fa fa-check"></i><b>21</b> Layers of abstraction</a>
<ul>
<li class="chapter" data-level="21.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#objectives-20"><i class="fa fa-check"></i><b>21.1</b> Objectives</a></li>
<li class="chapter" data-level="21.2" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#admitting-the-simplification"><i class="fa fa-check"></i><b>21.2</b> Admitting the simplification</a></li>
<li class="chapter" data-level="21.3" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#abstracting-the-exchange"><i class="fa fa-check"></i><b>21.3</b> Abstracting the exchange</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#defining-the-core.exchange-behaviour"><i class="fa fa-check"></i><b>21.3.1</b> Defining the <code>Core.Exchange</code> behaviour</a></li>
<li class="chapter" data-level="21.3.2" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#implementation-of-the-core.exchange.binance-module"><i class="fa fa-check"></i><b>21.3.2</b> Implementation of the <code>Core.Exchange.Binance</code> module</a></li>
<li class="chapter" data-level="21.3.3" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-binancemock-module-to-implement-the-core.exchange-behaviour"><i class="fa fa-check"></i><b>21.3.3</b> Updating the <code>BinanceMock</code> module to implement the <code>Core.Exchange</code> behaviour</a></li>
<li class="chapter" data-level="21.3.4" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-naive.strategy"><i class="fa fa-check"></i><b>21.3.4</b> Updating the <code>Naive.Strategy</code></a></li>
<li class="chapter" data-level="21.3.5" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-seed-scripts"><i class="fa fa-check"></i><b>21.3.5</b> Updating the seed scripts</a></li>
<li class="chapter" data-level="21.3.6" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#manual-testing-after-the-refactoring"><i class="fa fa-check"></i><b>21.3.6</b> Manual testing after the refactoring</a></li>
<li class="chapter" data-level="21.3.7" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#storing-the-data"><i class="fa fa-check"></i><b>21.3.7</b> Storing the data</a></li>
<li class="chapter" data-level="21.3.8" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#the-mox-approach-summary"><i class="fa fa-check"></i><b>21.3.8</b> The <code>Mox</code> approach summary</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#mimicking-the-reality"><i class="fa fa-check"></i><b>21.4</b> Mimicking the reality</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-naive.strategy-1"><i class="fa fa-check"></i><b>21.4.1</b> Updating the <code>Naive.Strategy</code></a></li>
<li class="chapter" data-level="21.4.2" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#testing-the-naive.strategy"><i class="fa fa-check"></i><b>21.4.2</b> Testing the <code>Naive.Strategy</code></a></li>
<li class="chapter" data-level="21.4.3" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#logging-elephant-in-the-room"><i class="fa fa-check"></i><b>21.4.3</b> Logging elephant in the room</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#swapping-back-to-attributes"><i class="fa fa-check"></i><b>21.5</b> Swapping back to attributes</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#config-files"><i class="fa fa-check"></i><b>21.5.1</b> Config files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="win-with-pure-logic.html"><a href="win-with-pure-logic.html"><i class="fa fa-check"></i><b>22</b> 80/20 win with pure logic</a>
<ul>
<li class="chapter" data-level="22.1" data-path="win-with-pure-logic.html"><a href="win-with-pure-logic.html#objectives-21"><i class="fa fa-check"></i><b>22.1</b> Objectives</a></li>
<li class="chapter" data-level="22.2" data-path="win-with-pure-logic.html"><a href="win-with-pure-logic.html#testing-the-pure-logic"><i class="fa fa-check"></i><b>22.2</b> Testing the pure logic</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html"><i class="fa fa-check"></i><b>23</b> Back to the Monolith</a>
<ul>
<li class="chapter" data-level="23.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#objectives-22"><i class="fa fa-check"></i><b>23.1</b> Objectives</a></li>
<li class="chapter" data-level="23.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reverting-the-course-to-the-monolith"><i class="fa fa-check"></i><b>23.2</b> Reverting the course to the monolith</a></li>
<li class="chapter" data-level="23.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#creating-a-new-phoenix-app"><i class="fa fa-check"></i><b>23.3</b> Creating a new Phoenix app</a></li>
<li class="chapter" data-level="23.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-core-app"><i class="fa fa-check"></i><b>23.4</b> Reintegrating the <code>core</code> app</a></li>
<li class="chapter" data-level="23.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-binance_mock-app"><i class="fa fa-check"></i><b>23.5</b> Reintegrating the <code>binance_mock</code> app</a></li>
<li class="chapter" data-level="23.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-streamer-app"><i class="fa fa-check"></i><b>23.6</b> Reintegrating the <code>streamer</code> app</a>
<ul>
<li class="chapter" data-level="23.6.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervisor"><i class="fa fa-check"></i><b>23.6.1</b> Supervisor</a></li>
<li class="chapter" data-level="23.6.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#worker"><i class="fa fa-check"></i><b>23.6.2</b> Worker</a></li>
<li class="chapter" data-level="23.6.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dynamicstreamersupervisor"><i class="fa fa-check"></i><b>23.6.3</b> DynamicStreamerSupervisor</a></li>
<li class="chapter" data-level="23.6.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#schemasettings.ex-and-schemastreaming_status_enum.ex"><i class="fa fa-check"></i><b>23.6.4</b> schema/settings.ex and schema/streaming_status_enum.ex</a></li>
<li class="chapter" data-level="23.6.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#application"><i class="fa fa-check"></i><b>23.6.5</b> application</a></li>
<li class="chapter" data-level="23.6.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#db-migrations-and-seeding"><i class="fa fa-check"></i><b>23.6.6</b> DB migrations and seeding</a></li>
<li class="chapter" data-level="23.6.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#config"><i class="fa fa-check"></i><b>23.6.7</b> Config</a></li>
<li class="chapter" data-level="23.6.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#deps"><i class="fa fa-check"></i><b>23.6.8</b> Deps</a></li>
</ul></li>
<li class="chapter" data-level="23.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-naive-app"><i class="fa fa-check"></i><b>23.7</b> Reintegrating the <code>naive</code> app</a>
<ul>
<li class="chapter" data-level="23.7.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#naive.ex"><i class="fa fa-check"></i><b>23.7.1</b> naive.ex</a></li>
<li class="chapter" data-level="23.7.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#strategy.ex---formula.ex"><i class="fa fa-check"></i><b>23.7.2</b> strategy.ex -&gt; formula.ex</a></li>
<li class="chapter" data-level="23.7.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#trader.ex"><i class="fa fa-check"></i><b>23.7.3</b> <code>trader.ex</code></a></li>
<li class="chapter" data-level="23.7.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervisor.ex"><i class="fa fa-check"></i><b>23.7.4</b> <code>supervisor.ex</code></a></li>
<li class="chapter" data-level="23.7.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dynamic_trader_supervisor.ex"><i class="fa fa-check"></i><b>23.7.5</b> <code>dynamic_trader_supervisor.ex</code></a></li>
<li class="chapter" data-level="23.7.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#repo-and-schema-files"><i class="fa fa-check"></i><b>23.7.6</b> Repo and <code>schema</code> files</a></li>
<li class="chapter" data-level="23.7.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#application.ex"><i class="fa fa-check"></i><b>23.7.7</b> <code>application.ex</code></a></li>
<li class="chapter" data-level="23.7.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#migration-and-seeding"><i class="fa fa-check"></i><b>23.7.8</b> Migration and seeding</a></li>
<li class="chapter" data-level="23.7.9" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#configuration"><i class="fa fa-check"></i><b>23.7.9</b> Configuration</a></li>
<li class="chapter" data-level="23.7.10" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#tests"><i class="fa fa-check"></i><b>23.7.10</b> Tests</a></li>
<li class="chapter" data-level="23.7.11" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dependencies"><i class="fa fa-check"></i><b>23.7.11</b> Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="23.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-data_warehouse-app"><i class="fa fa-check"></i><b>23.8</b> Reintegrating the <code>data_warehouse</code> app</a>
<ul>
<li class="chapter" data-level="23.8.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#exchangeorder.ex"><i class="fa fa-check"></i><b>23.8.1</b> <code>exchange/order.ex</code></a></li>
<li class="chapter" data-level="23.8.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#exchangetrade_event.ex"><i class="fa fa-check"></i><b>23.8.2</b> <code>exchange/trade_event.ex</code></a></li>
<li class="chapter" data-level="23.8.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datapublisher.ex"><i class="fa fa-check"></i><b>23.8.3</b> <code>data/publisher.ex</code></a></li>
<li class="chapter" data-level="23.8.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollector.ex"><i class="fa fa-check"></i><b>23.8.4</b> <code>data/collector.ex</code></a></li>
<li class="chapter" data-level="23.8.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorcollector_supervisor.ex"><i class="fa fa-check"></i><b>23.8.5</b> <code>data/collector/collector_supervisor.ex</code></a></li>
<li class="chapter" data-level="23.8.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectordynamic_worker_supervisor.ex"><i class="fa fa-check"></i><b>23.8.6</b> <code>/data/collector/dynamic_worker_supervisor.ex</code></a></li>
<li class="chapter" data-level="23.8.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorsettings_status_enum.ex"><i class="fa fa-check"></i><b>23.8.7</b> <code>/data/collector/settings_status_enum.ex</code></a></li>
<li class="chapter" data-level="23.8.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorsettings.ex"><i class="fa fa-check"></i><b>23.8.8</b> <code>/data/collector/settings.ex</code></a></li>
<li class="chapter" data-level="23.8.9" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorworker.ex"><i class="fa fa-check"></i><b>23.8.9</b> <code>/data/collector/worker.ex</code></a></li>
<li class="chapter" data-level="23.8.10" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervision-tree"><i class="fa fa-check"></i><b>23.8.10</b> Supervision tree</a></li>
<li class="chapter" data-level="23.8.11" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#migrations"><i class="fa fa-check"></i><b>23.8.11</b> Migrations</a></li>
</ul></li>
<li class="chapter" data-level="23.9" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-indicator-app"><i class="fa fa-check"></i><b>23.9</b> Reintegrating the <code>indicator</code> app</a>
<ul>
<li class="chapter" data-level="23.9.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dataaggregator.ex"><i class="fa fa-check"></i><b>23.9.1</b> /data/aggregator.ex</a></li>
<li class="chapter" data-level="23.9.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dataaggregatorohlc.ex"><i class="fa fa-check"></i><b>23.9.2</b> /data/aggregator/ohlc.ex</a></li>
<li class="chapter" data-level="23.9.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dataaggregatorohlcworker.ex"><i class="fa fa-check"></i><b>23.9.3</b> /data/aggregator/ohlc/worker.ex</a></li>
<li class="chapter" data-level="23.9.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervision-tree-1"><i class="fa fa-check"></i><b>23.9.4</b> Supervision tree</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.bookdown.org/" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hands-on Elixir &amp; OTP: Cryptocurrency trading bot</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="end-to-end-testing" class="section level1 hasAnchor" number="16">
<h1><span class="header-section-number">Chapter 16</span> End-to-end testing<a href="end-to-end-testing.html#end-to-end-testing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="objectives-15" class="section level2 hasAnchor" number="16.1">
<h2><span class="header-section-number">16.1</span> Objectives<a href="end-to-end-testing.html#objectives-15" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>decide on the tested functionality</li>
<li>implement basic test</li>
<li>introduce environment based config files</li>
<li>add convenience aliases</li>
<li>cache initial seed data inside a file</li>
<li>update seeding scripts to use the BinanceMock</li>
<li>introduce the core application</li>
</ul>
</div>
<div id="decide-on-the-tested-functionality" class="section level2 hasAnchor" number="16.2">
<h2><span class="header-section-number">16.2</span> Decide on the tested functionality<a href="end-to-end-testing.html#decide-on-the-tested-functionality" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We’ve reached the stage where we have a decent solution in place, and to ensure that it’s still working correctly after any future refactoring, we will add tests. We will start with the “integration”/“end-to-end”(E2E) test, which will confirm that the whole “trading” works.</p>
<p>To perform tests at this level, we will need to orchestrate databases together with processes and broadcast trade events from within the test to cause our trading strategy to place orders. We will be able to confirm the right behavior by checking the database after running the test.</p>
<p>You should have the <strong>least</strong> amount of this type of test as they are very brittle and require substantial effort to set up and maintain. My personal rule of thumb is that only major “happy paths” should be tested this way.</p>
<div style="page-break-after: always;"></div>
<p>Let’s look at the current flow of data through our system:</p>
<p><img src="images/chapter_16_01_current_flow.png" width="100%" style="display: block; margin: auto;" /></p>
<p>Currently, the <code>Streamer.Binance</code> establishes a WebSocket connection with Binance. It decodes the incoming trade events and broadcasts them to PubSub(<code>TRADE_EVENTS:#{symbol}</code> topics). PubSub then sends them to the <code>Naive.Trader</code> processes. As those processes place orders(or orders get filled), they broadcast orders to the PubSub(<code>ORDERS:#{symbol}</code> topics). The <code>DataWarehouse.Subscriber.Worker</code> processes subscribe to the broadcasted orders and store them in the database.</p>
<div style="page-break-after: always;"></div>
<p>What we could do is to stop all the <code>Streamer.Binance</code> processes and broadcast trade events directly from the test. We would then be able to fine-tune the prices inside those events to run through the full trade cycle:</p>
<p><img src="images/chapter_16_02_test.png" width="100%" style="display: block; margin: auto;" /></p>
<p>This would allow us to fetch orders from the database to confirm that trading indeed happened.</p>
</div>
<div id="implement-basic-test" class="section level2 hasAnchor" number="16.3">
<h2><span class="header-section-number">16.3</span> Implement basic test<a href="end-to-end-testing.html#implement-basic-test" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will place our test inside the <code>NaiveTest</code> module inside the <code>apps/naive/test/naive_test.exs</code> file.
First, we will need to alias multiple modules that we will use to either initialize or confirm the results:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb306-1"><a href="end-to-end-testing.html#cb306-1" tabindex="-1"></a>  <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb306-2"><a href="end-to-end-testing.html#cb306-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb306-3"><a href="end-to-end-testing.html#cb306-3" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">DataWarehouse</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">Order</span></span>
<span id="cb306-4"><a href="end-to-end-testing.html#cb306-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">Settings</span>, <span class="va">as:</span> <span class="cn">TradingSettings</span></span>
<span id="cb306-5"><a href="end-to-end-testing.html#cb306-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">TradeEvent</span></span>
<span id="cb306-6"><a href="end-to-end-testing.html#cb306-6" tabindex="-1"></a></span>
<span id="cb306-7"><a href="end-to-end-testing.html#cb306-7" tabindex="-1"></a>  <span class="im">import</span> <span class="cn">Ecto</span><span class="op">.</span><span class="cn">Query</span>, <span class="va">only:</span> <span class="ot">[</span><span class="va">from:</span> <span class="dv">2</span><span class="ot">]</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>Now we can update the generated test to have a tag in front of it:</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb307-1"><a href="end-to-end-testing.html#cb307-1" tabindex="-1"></a>  <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb307-2"><a href="end-to-end-testing.html#cb307-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb307-3"><a href="end-to-end-testing.html#cb307-3" tabindex="-1"></a>  <span class="ot">@tag</span> <span class="va">integration:</span> <span class="cn">true</span></span></code></pre></div>
<p>We will use this tag to select only this test when we are running the integration tests.</p>
<p>The first step will be to update the trading settings to values that will cause trading activity:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb308-1"><a href="end-to-end-testing.html#cb308-1" tabindex="-1"></a>  <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb308-2"><a href="end-to-end-testing.html#cb308-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb308-3"><a href="end-to-end-testing.html#cb308-3" tabindex="-1"></a>  test <span class="st">&quot;Naive trader full trade(buy + sell) test&quot;</span> <span class="kw">do</span></span>
<span id="cb308-4"><a href="end-to-end-testing.html#cb308-4" tabindex="-1"></a>    symbol <span class="op">=</span> <span class="st">&quot;XRPUSDT&quot;</span></span>
<span id="cb308-5"><a href="end-to-end-testing.html#cb308-5" tabindex="-1"></a></span>
<span id="cb308-6"><a href="end-to-end-testing.html#cb308-6" tabindex="-1"></a>    <span class="co"># Step 1 - Update trading settings</span></span>
<span id="cb308-7"><a href="end-to-end-testing.html#cb308-7" tabindex="-1"></a></span>
<span id="cb308-8"><a href="end-to-end-testing.html#cb308-8" tabindex="-1"></a>    settings <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb308-9"><a href="end-to-end-testing.html#cb308-9" tabindex="-1"></a>      <span class="va">profit_interval:</span> <span class="fl">0.001</span>,</span>
<span id="cb308-10"><a href="end-to-end-testing.html#cb308-10" tabindex="-1"></a>      <span class="va">buy_down_interval:</span> <span class="fl">0.0025</span>,</span>
<span id="cb308-11"><a href="end-to-end-testing.html#cb308-11" tabindex="-1"></a>      <span class="va">chunks:</span> <span class="dv">5</span>,</span>
<span id="cb308-12"><a href="end-to-end-testing.html#cb308-12" tabindex="-1"></a>      <span class="va">budget:</span> <span class="fl">100.0</span></span>
<span id="cb308-13"><a href="end-to-end-testing.html#cb308-13" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb308-14"><a href="end-to-end-testing.html#cb308-14" tabindex="-1"></a></span>
<span id="cb308-15"><a href="end-to-end-testing.html#cb308-15" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:ok</span>, _<span class="fu">}</span> <span class="op">=</span></span>
<span id="cb308-16"><a href="end-to-end-testing.html#cb308-16" tabindex="-1"></a>      <span class="cn">TradingSettings</span></span>
<span id="cb308-17"><a href="end-to-end-testing.html#cb308-17" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span>get_by!<span class="fu">(</span><span class="va">symbol:</span> symbol<span class="fu">)</span></span>
<span id="cb308-18"><a href="end-to-end-testing.html#cb308-18" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Ecto</span><span class="op">.</span><span class="cn">Changeset</span><span class="op">.</span>change<span class="fu">(</span>settings<span class="fu">)</span></span>
<span id="cb308-19"><a href="end-to-end-testing.html#cb308-19" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span>update<span class="fu">()</span></span></code></pre></div>
<p>As we updated the trading settings, we can now start trading:</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb309-1"><a href="end-to-end-testing.html#cb309-1" tabindex="-1"></a>    <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb309-2"><a href="end-to-end-testing.html#cb309-2" tabindex="-1"></a>    <span class="co"># `test` function continued</span></span>
<span id="cb309-3"><a href="end-to-end-testing.html#cb309-3" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb309-4"><a href="end-to-end-testing.html#cb309-4" tabindex="-1"></a>    <span class="co"># Step 2 - Start trading on symbol</span></span>
<span id="cb309-5"><a href="end-to-end-testing.html#cb309-5" tabindex="-1"></a></span>
<span id="cb309-6"><a href="end-to-end-testing.html#cb309-6" tabindex="-1"></a>    <span class="cn">Naive</span><span class="op">.</span>start_trading<span class="fu">(</span>symbol<span class="fu">)</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>Before we start broadcasting events, we need to ensure that the <code>DataWarehouse</code> application will store resulting orders into the database:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb310-1"><a href="end-to-end-testing.html#cb310-1" tabindex="-1"></a>    <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb310-2"><a href="end-to-end-testing.html#cb310-2" tabindex="-1"></a>    <span class="co"># `test` function continued</span></span>
<span id="cb310-3"><a href="end-to-end-testing.html#cb310-3" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb310-4"><a href="end-to-end-testing.html#cb310-4" tabindex="-1"></a>    <span class="co"># Step 3 - Start storing orders</span></span>
<span id="cb310-5"><a href="end-to-end-testing.html#cb310-5" tabindex="-1"></a></span>
<span id="cb310-6"><a href="end-to-end-testing.html#cb310-6" tabindex="-1"></a>    <span class="cn">DataWarehouse</span><span class="op">.</span>start_storing<span class="fu">(</span><span class="st">&quot;ORDERS&quot;</span>, <span class="st">&quot;XRPUSDT&quot;</span><span class="fu">)</span></span>
<span id="cb310-7"><a href="end-to-end-testing.html#cb310-7" tabindex="-1"></a>    <span class="va">:timer</span><span class="op">.</span>sleep<span class="fu">(</span><span class="dv">5000</span><span class="fu">)</span></span></code></pre></div>
<p>Additionally, as seen in the above code, we need to allow some time(5 seconds above) to initialize trading and data storing processes.</p>
<p>We can now move on to broadcasting trade events:</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb311-1"><a href="end-to-end-testing.html#cb311-1" tabindex="-1"></a>    <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb311-2"><a href="end-to-end-testing.html#cb311-2" tabindex="-1"></a>    <span class="co"># `test` function continued</span></span>
<span id="cb311-3"><a href="end-to-end-testing.html#cb311-3" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb311-4"><a href="end-to-end-testing.html#cb311-4" tabindex="-1"></a>    <span class="co"># Step 4 - Broadcast 9 events</span></span>
<span id="cb311-5"><a href="end-to-end-testing.html#cb311-5" tabindex="-1"></a></span>
<span id="cb311-6"><a href="end-to-end-testing.html#cb311-6" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb311-7"><a href="end-to-end-testing.html#cb311-7" tabindex="-1"></a>      <span class="co"># buy order placed @ 0.4307</span></span>
<span id="cb311-8"><a href="end-to-end-testing.html#cb311-8" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">1</span>, <span class="st">&quot;0.43183010&quot;</span>, <span class="st">&quot;213.10000000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-9"><a href="end-to-end-testing.html#cb311-9" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">2</span>, <span class="st">&quot;0.43183020&quot;</span>, <span class="st">&quot;56.10000000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-10"><a href="end-to-end-testing.html#cb311-10" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">3</span>, <span class="st">&quot;0.43183030&quot;</span>, <span class="st">&quot;12.10000000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-11"><a href="end-to-end-testing.html#cb311-11" tabindex="-1"></a>      <span class="co"># event at the expected buy price</span></span>
<span id="cb311-12"><a href="end-to-end-testing.html#cb311-12" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">4</span>, <span class="st">&quot;0.4307&quot;</span>, <span class="st">&quot;38.92000000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-13"><a href="end-to-end-testing.html#cb311-13" tabindex="-1"></a>      <span class="co"># event below the expected buy price</span></span>
<span id="cb311-14"><a href="end-to-end-testing.html#cb311-14" tabindex="-1"></a>      <span class="co"># it should trigger fake fill event for placed buy order</span></span>
<span id="cb311-15"><a href="end-to-end-testing.html#cb311-15" tabindex="-1"></a>      <span class="co"># and place sell order @ 0.4319</span></span>
<span id="cb311-16"><a href="end-to-end-testing.html#cb311-16" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">5</span>, <span class="st">&quot;0.43065&quot;</span>, <span class="st">&quot;126.53000000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-17"><a href="end-to-end-testing.html#cb311-17" tabindex="-1"></a>      <span class="co"># event below the expected sell price</span></span>
<span id="cb311-18"><a href="end-to-end-testing.html#cb311-18" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">6</span>, <span class="st">&quot;0.43189&quot;</span>, <span class="st">&quot;26.18500000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-19"><a href="end-to-end-testing.html#cb311-19" tabindex="-1"></a>      <span class="co"># event at exact the expected sell price</span></span>
<span id="cb311-20"><a href="end-to-end-testing.html#cb311-20" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">7</span>, <span class="st">&quot;0.4319&quot;</span>, <span class="st">&quot;62.92640000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-21"><a href="end-to-end-testing.html#cb311-21" tabindex="-1"></a>      <span class="co"># event above the expected sell price</span></span>
<span id="cb311-22"><a href="end-to-end-testing.html#cb311-22" tabindex="-1"></a>      <span class="co"># it should trigger fake fill event for placed sell order</span></span>
<span id="cb311-23"><a href="end-to-end-testing.html#cb311-23" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">8</span>, <span class="st">&quot;0.43205&quot;</span>, <span class="st">&quot;345.14235000&quot;</span><span class="fu">)</span>,</span>
<span id="cb311-24"><a href="end-to-end-testing.html#cb311-24" tabindex="-1"></a>      <span class="co"># this one should trigger buy order for a new trader process</span></span>
<span id="cb311-25"><a href="end-to-end-testing.html#cb311-25" tabindex="-1"></a>      generate_event<span class="fu">(</span><span class="dv">9</span>, <span class="st">&quot;0.43210&quot;</span>, <span class="st">&quot;3201.86480000&quot;</span><span class="fu">)</span></span>
<span id="cb311-26"><a href="end-to-end-testing.html#cb311-26" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb311-27"><a href="end-to-end-testing.html#cb311-27" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>each<span class="fu">(</span><span class="kw">fn</span> event <span class="op">-&gt;</span></span>
<span id="cb311-28"><a href="end-to-end-testing.html#cb311-28" tabindex="-1"></a>      <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>broadcast<span class="fu">(</span></span>
<span id="cb311-29"><a href="end-to-end-testing.html#cb311-29" tabindex="-1"></a>        <span class="cn">Core</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb311-30"><a href="end-to-end-testing.html#cb311-30" tabindex="-1"></a>        <span class="st">&quot;TRADE_EVENTS:</span><span class="ot">#{</span>symbol<span class="ot">}</span><span class="st">&quot;</span>,</span>
<span id="cb311-31"><a href="end-to-end-testing.html#cb311-31" tabindex="-1"></a>        event</span>
<span id="cb311-32"><a href="end-to-end-testing.html#cb311-32" tabindex="-1"></a>      <span class="fu">)</span></span>
<span id="cb311-33"><a href="end-to-end-testing.html#cb311-33" tabindex="-1"></a></span>
<span id="cb311-34"><a href="end-to-end-testing.html#cb311-34" tabindex="-1"></a>      <span class="va">:timer</span><span class="op">.</span>sleep<span class="fu">(</span><span class="dv">10</span><span class="fu">)</span></span>
<span id="cb311-35"><a href="end-to-end-testing.html#cb311-35" tabindex="-1"></a>    <span class="kw">end</span><span class="fu">)</span></span>
<span id="cb311-36"><a href="end-to-end-testing.html#cb311-36" tabindex="-1"></a></span>
<span id="cb311-37"><a href="end-to-end-testing.html#cb311-37" tabindex="-1"></a>    <span class="va">:timer</span><span class="op">.</span>sleep<span class="fu">(</span><span class="dv">2000</span><span class="fu">)</span></span></code></pre></div>
<p>The above code will broadcast trade events to the PubSub topic that the trader processes are subscribed to.
It should cause 3 orders to be placed at specific prices. In the last step, we will confirm this by querying the database:</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb312-1"><a href="end-to-end-testing.html#cb312-1" tabindex="-1"></a>    <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb312-2"><a href="end-to-end-testing.html#cb312-2" tabindex="-1"></a>    <span class="co"># `test` function continued</span></span>
<span id="cb312-3"><a href="end-to-end-testing.html#cb312-3" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb312-4"><a href="end-to-end-testing.html#cb312-4" tabindex="-1"></a>    <span class="co"># Step 5 - Check orders table</span></span>
<span id="cb312-5"><a href="end-to-end-testing.html#cb312-5" tabindex="-1"></a></span>
<span id="cb312-6"><a href="end-to-end-testing.html#cb312-6" tabindex="-1"></a>    query <span class="op">=</span></span>
<span id="cb312-7"><a href="end-to-end-testing.html#cb312-7" tabindex="-1"></a>      from<span class="fu">(</span>o <span class="kw">in</span> <span class="cn">Order</span>,</span>
<span id="cb312-8"><a href="end-to-end-testing.html#cb312-8" tabindex="-1"></a>        <span class="va">select:</span> <span class="ot">[</span>o<span class="op">.</span>price, o<span class="op">.</span>side, o<span class="op">.</span>status<span class="ot">]</span>,</span>
<span id="cb312-9"><a href="end-to-end-testing.html#cb312-9" tabindex="-1"></a>        <span class="va">order_by:</span> o<span class="op">.</span>inserted_at,</span>
<span id="cb312-10"><a href="end-to-end-testing.html#cb312-10" tabindex="-1"></a>        <span class="va">where:</span> o<span class="op">.</span>symbol <span class="op">==</span> <span class="op">^</span>symbol</span>
<span id="cb312-11"><a href="end-to-end-testing.html#cb312-11" tabindex="-1"></a>      <span class="fu">)</span></span>
<span id="cb312-12"><a href="end-to-end-testing.html#cb312-12" tabindex="-1"></a></span>
<span id="cb312-13"><a href="end-to-end-testing.html#cb312-13" tabindex="-1"></a>    <span class="ot">[</span>buy_1, sell_1, buy_2<span class="ot">]</span> <span class="op">=</span> <span class="cn">DataWarehouse</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span>all<span class="fu">(</span>query<span class="fu">)</span></span>
<span id="cb312-14"><a href="end-to-end-testing.html#cb312-14" tabindex="-1"></a></span>
<span id="cb312-15"><a href="end-to-end-testing.html#cb312-15" tabindex="-1"></a>    assert buy_1 <span class="op">==</span> <span class="ot">[</span><span class="st">&quot;0.43070000&quot;</span>, <span class="st">&quot;BUY&quot;</span>, <span class="st">&quot;FILLED&quot;</span><span class="ot">]</span></span>
<span id="cb312-16"><a href="end-to-end-testing.html#cb312-16" tabindex="-1"></a>    assert sell_1 <span class="op">==</span> <span class="ot">[</span><span class="st">&quot;0.43190000&quot;</span>, <span class="st">&quot;SELL&quot;</span>, <span class="st">&quot;FILLED&quot;</span><span class="ot">]</span></span>
<span id="cb312-17"><a href="end-to-end-testing.html#cb312-17" tabindex="-1"></a>    assert buy_2 <span class="op">==</span> <span class="ot">[</span><span class="st">&quot;0.43100000&quot;</span>, <span class="st">&quot;BUY&quot;</span>, <span class="st">&quot;NEW&quot;</span><span class="ot">]</span></span></code></pre></div>
<p>That finishes the test function. The final addition inside the <code>NaiveTest</code> module will be to add a private helper function that generates trade event for the passed values:</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb313-1"><a href="end-to-end-testing.html#cb313-1" tabindex="-1"></a>  <span class="co"># /apps/naive/test/naive_test.exs</span></span>
<span id="cb313-2"><a href="end-to-end-testing.html#cb313-2" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb313-3"><a href="end-to-end-testing.html#cb313-3" tabindex="-1"></a>  </span>
<span id="cb313-4"><a href="end-to-end-testing.html#cb313-4" tabindex="-1"></a>  <span class="kw">defp</span> generate_event<span class="fu">(</span>id, price, quantity<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb313-5"><a href="end-to-end-testing.html#cb313-5" tabindex="-1"></a>    %<span class="cn">TradeEvent</span><span class="fu">{</span></span>
<span id="cb313-6"><a href="end-to-end-testing.html#cb313-6" tabindex="-1"></a>      <span class="va">event_type:</span> <span class="st">&quot;trade&quot;</span>,</span>
<span id="cb313-7"><a href="end-to-end-testing.html#cb313-7" tabindex="-1"></a>      <span class="va">event_time:</span> <span class="dv">1_000</span> <span class="op">+</span> id <span class="op">*</span> <span class="dv">10</span>,</span>
<span id="cb313-8"><a href="end-to-end-testing.html#cb313-8" tabindex="-1"></a>      <span class="va">symbol:</span> <span class="st">&quot;XRPUSDT&quot;</span>,</span>
<span id="cb313-9"><a href="end-to-end-testing.html#cb313-9" tabindex="-1"></a>      <span class="va">trade_id:</span> <span class="dv">2_000</span> <span class="op">+</span> id <span class="op">*</span> <span class="dv">10</span>,</span>
<span id="cb313-10"><a href="end-to-end-testing.html#cb313-10" tabindex="-1"></a>      <span class="va">price:</span> price,</span>
<span id="cb313-11"><a href="end-to-end-testing.html#cb313-11" tabindex="-1"></a>      <span class="va">quantity:</span> quantity,</span>
<span id="cb313-12"><a href="end-to-end-testing.html#cb313-12" tabindex="-1"></a>      <span class="va">buyer_order_id:</span> <span class="dv">3_000</span> <span class="op">+</span> id <span class="op">*</span> <span class="dv">10</span>,</span>
<span id="cb313-13"><a href="end-to-end-testing.html#cb313-13" tabindex="-1"></a>      <span class="va">seller_order_id:</span> <span class="dv">4_000</span> <span class="op">+</span> id <span class="op">*</span> <span class="dv">10</span>,</span>
<span id="cb313-14"><a href="end-to-end-testing.html#cb313-14" tabindex="-1"></a>      <span class="va">trade_time:</span> <span class="dv">5_000</span> <span class="op">+</span> id <span class="op">*</span> <span class="dv">10</span>,</span>
<span id="cb313-15"><a href="end-to-end-testing.html#cb313-15" tabindex="-1"></a>      <span class="va">buyer_market_maker:</span> <span class="cn">false</span></span>
<span id="cb313-16"><a href="end-to-end-testing.html#cb313-16" tabindex="-1"></a>    <span class="fu">}</span></span>
<span id="cb313-17"><a href="end-to-end-testing.html#cb313-17" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>This finishes the implementation of the test, but as we are now using DataWarehouse’s modules inside the Naive application, we need to add <code>data_warehouse</code> to the dependencies:</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb314-1"><a href="end-to-end-testing.html#cb314-1" tabindex="-1"></a>  <span class="co"># /apps/naive/mix.exs</span></span>
<span id="cb314-2"><a href="end-to-end-testing.html#cb314-2" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb314-3"><a href="end-to-end-testing.html#cb314-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb314-4"><a href="end-to-end-testing.html#cb314-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb314-5"><a href="end-to-end-testing.html#cb314-5" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:data_warehouse</span>, <span class="va">in_umbrella:</span> <span class="cn">true</span>, <span class="va">only:</span> <span class="va">:test</span><span class="fu">}</span>,</span>
<span id="cb314-6"><a href="end-to-end-testing.html#cb314-6" tabindex="-1"></a>      <span class="op">...</span></span></code></pre></div>
<p>We could now run our new integration test, but it would be run against our current(development) databases. In addition, as we will need to reset all the data inside them before every test run, it could mean losing data. To avoid all of those problems, we will use separate databases for testing.</p>
</div>
<div id="introduce-environment-based-config-files" class="section level2 hasAnchor" number="16.4">
<h2><span class="header-section-number">16.4</span> Introduce environment based config files<a href="end-to-end-testing.html#introduce-environment-based-config-files" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Currently, our new test is running in the test environment (the <code>MIX_ENV</code> environmental variable is set to <code>"test"</code> whenever we run <code>mix test</code>), but we do not leverage that fact to configure our application for example: to use test databases as mentioned above.</p>
<p>Configuration for our applications lives in <code>config/config.exs</code> configuration file. Inside it, we have access to the name of the environment, which we will utilize to place an environment based <code>import_config/1</code> function:</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb315-1"><a href="end-to-end-testing.html#cb315-1" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb315-2"><a href="end-to-end-testing.html#cb315-2" tabindex="-1"></a><span class="co"># add the below at the end of the file</span></span>
<span id="cb315-3"><a href="end-to-end-testing.html#cb315-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb315-4"><a href="end-to-end-testing.html#cb315-4" tabindex="-1"></a>import_config <span class="st">&quot;</span><span class="ot">#{</span>config_env<span class="fu">()</span><span class="ot">}</span><span class="st">.exs&quot;</span></span></code></pre></div>
<p>Now we will create multiple config files, one for each environment:</p>
<ul>
<li><code>/config/dev.exs</code> for development:</li>
</ul>
<div class="sourceCode" id="cb316"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb316-1"><a href="end-to-end-testing.html#cb316-1" tabindex="-1"></a><span class="co"># /config/dev.exs</span></span>
<span id="cb316-2"><a href="end-to-end-testing.html#cb316-2" tabindex="-1"></a><span class="im">import</span> <span class="cn">Config</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<ul>
<li><code>/config/test.exs</code> for future “unit” testing:</li>
</ul>
<div class="sourceCode" id="cb317"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb317-1"><a href="end-to-end-testing.html#cb317-1" tabindex="-1"></a><span class="co"># /config/test.exs</span></span>
<span id="cb317-2"><a href="end-to-end-testing.html#cb317-2" tabindex="-1"></a><span class="im">import</span> <span class="cn">Config</span></span></code></pre></div>
<ul>
<li><code>/config/integration.exs</code> for end-to-end testing:</li>
</ul>
<div class="sourceCode" id="cb318"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb318-1"><a href="end-to-end-testing.html#cb318-1" tabindex="-1"></a><span class="co"># /config/integration.exs</span></span>
<span id="cb318-2"><a href="end-to-end-testing.html#cb318-2" tabindex="-1"></a><span class="im">import</span> <span class="cn">Config</span></span>
<span id="cb318-3"><a href="end-to-end-testing.html#cb318-3" tabindex="-1"></a></span>
<span id="cb318-4"><a href="end-to-end-testing.html#cb318-4" tabindex="-1"></a>config <span class="va">:streamer</span>, <span class="cn">Streamer</span><span class="op">.</span><span class="cn">Repo</span>, <span class="va">database:</span> <span class="st">&quot;streamer_test&quot;</span></span>
<span id="cb318-5"><a href="end-to-end-testing.html#cb318-5" tabindex="-1"></a></span>
<span id="cb318-6"><a href="end-to-end-testing.html#cb318-6" tabindex="-1"></a>config <span class="va">:naive</span>, <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span>, <span class="va">database:</span> <span class="st">&quot;naive_test&quot;</span></span>
<span id="cb318-7"><a href="end-to-end-testing.html#cb318-7" tabindex="-1"></a></span>
<span id="cb318-8"><a href="end-to-end-testing.html#cb318-8" tabindex="-1"></a>config <span class="va">:data_warehouse</span>, <span class="cn">DataWarehouse</span><span class="op">.</span><span class="cn">Repo</span>, <span class="va">database:</span> <span class="st">&quot;data_warehouse_test&quot;</span></span></code></pre></div>
<ul>
<li><code>/config/prod.exs</code> for production:</li>
</ul>
<div class="sourceCode" id="cb319"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb319-1"><a href="end-to-end-testing.html#cb319-1" tabindex="-1"></a><span class="co"># /config/prod.exs</span></span>
<span id="cb319-2"><a href="end-to-end-testing.html#cb319-2" tabindex="-1"></a><span class="im">import</span> <span class="cn">Config</span></span>
<span id="cb319-3"><a href="end-to-end-testing.html#cb319-3" tabindex="-1"></a></span>
<span id="cb319-4"><a href="end-to-end-testing.html#cb319-4" tabindex="-1"></a>config <span class="va">:naive</span>,</span>
<span id="cb319-5"><a href="end-to-end-testing.html#cb319-5" tabindex="-1"></a>  <span class="va">binance_client:</span> <span class="cn">Binance</span></span></code></pre></div>
<p>After adding the above environment-based configuration files, our test will use the test databases.</p>
<p>There’s one more remaining problem - we need to set those test databases before each test run, and as this process requires multiple steps, it’s a little bit cumbersome.</p>
</div>
<div id="add-convenience-aliases" class="section level2 hasAnchor" number="16.5">
<h2><span class="header-section-number">16.5</span> Add convenience aliases<a href="end-to-end-testing.html#add-convenience-aliases" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To be able to run our new integration test as easily as possible without bothering ourselves with all the database setup, we will introduce aliases in both the <code>streamer</code> and <code>naive</code> applications that will wrap seeding the databases:</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb320-1"><a href="end-to-end-testing.html#cb320-1" tabindex="-1"></a><span class="co"># /apps/naive/mix.exs &amp; /apps/streamer/mix.exs </span></span>
<span id="cb320-2"><a href="end-to-end-testing.html#cb320-2" tabindex="-1"></a>  <span class="kw">def</span> project <span class="kw">do</span></span>
<span id="cb320-3"><a href="end-to-end-testing.html#cb320-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb320-4"><a href="end-to-end-testing.html#cb320-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb320-5"><a href="end-to-end-testing.html#cb320-5" tabindex="-1"></a>      <span class="va">aliases:</span> aliases<span class="fu">()</span></span>
<span id="cb320-6"><a href="end-to-end-testing.html#cb320-6" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb320-7"><a href="end-to-end-testing.html#cb320-7" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb320-8"><a href="end-to-end-testing.html#cb320-8" tabindex="-1"></a></span>
<span id="cb320-9"><a href="end-to-end-testing.html#cb320-9" tabindex="-1"></a>  <span class="kw">defp</span> aliases <span class="kw">do</span></span>
<span id="cb320-10"><a href="end-to-end-testing.html#cb320-10" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb320-11"><a href="end-to-end-testing.html#cb320-11" tabindex="-1"></a>      <span class="va">seed:</span> <span class="ot">[</span><span class="st">&quot;run priv/seed_settings.exs&quot;</span><span class="ot">]</span></span>
<span id="cb320-12"><a href="end-to-end-testing.html#cb320-12" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb320-13"><a href="end-to-end-testing.html#cb320-13" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>Inside the main <code>mix.exs</code> file of our umbrella, we will use those with usual <code>ecto</code>’s commands like <code>ecto.create</code> and <code>ecto.migrate</code>:</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb321-1"><a href="end-to-end-testing.html#cb321-1" tabindex="-1"></a>  <span class="co"># /mix.exs </span></span>
<span id="cb321-2"><a href="end-to-end-testing.html#cb321-2" tabindex="-1"></a>  <span class="kw">def</span> project <span class="kw">do</span></span>
<span id="cb321-3"><a href="end-to-end-testing.html#cb321-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb321-4"><a href="end-to-end-testing.html#cb321-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb321-5"><a href="end-to-end-testing.html#cb321-5" tabindex="-1"></a>      <span class="va">aliases:</span> aliases<span class="fu">()</span></span>
<span id="cb321-6"><a href="end-to-end-testing.html#cb321-6" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb321-7"><a href="end-to-end-testing.html#cb321-7" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb321-8"><a href="end-to-end-testing.html#cb321-8" tabindex="-1"></a></span>
<span id="cb321-9"><a href="end-to-end-testing.html#cb321-9" tabindex="-1"></a>  <span class="kw">defp</span> aliases <span class="kw">do</span></span>
<span id="cb321-10"><a href="end-to-end-testing.html#cb321-10" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb321-11"><a href="end-to-end-testing.html#cb321-11" tabindex="-1"></a>      <span class="va">setup:</span> <span class="ot">[</span></span>
<span id="cb321-12"><a href="end-to-end-testing.html#cb321-12" tabindex="-1"></a>        <span class="st">&quot;ecto.drop&quot;</span>,</span>
<span id="cb321-13"><a href="end-to-end-testing.html#cb321-13" tabindex="-1"></a>        <span class="st">&quot;ecto.create&quot;</span>,</span>
<span id="cb321-14"><a href="end-to-end-testing.html#cb321-14" tabindex="-1"></a>        <span class="st">&quot;ecto.migrate&quot;</span>,</span>
<span id="cb321-15"><a href="end-to-end-testing.html#cb321-15" tabindex="-1"></a>        <span class="st">&quot;cmd --app naive --app streamer mix seed&quot;</span></span>
<span id="cb321-16"><a href="end-to-end-testing.html#cb321-16" tabindex="-1"></a>      <span class="ot">]</span>,</span>
<span id="cb321-17"><a href="end-to-end-testing.html#cb321-17" tabindex="-1"></a>      <span class="st">&quot;test.integration&quot;</span>: <span class="ot">[</span></span>
<span id="cb321-18"><a href="end-to-end-testing.html#cb321-18" tabindex="-1"></a>        <span class="st">&quot;setup&quot;</span>,</span>
<span id="cb321-19"><a href="end-to-end-testing.html#cb321-19" tabindex="-1"></a>        <span class="st">&quot;test --only integration&quot;</span></span>
<span id="cb321-20"><a href="end-to-end-testing.html#cb321-20" tabindex="-1"></a>      <span class="ot">]</span></span>
<span id="cb321-21"><a href="end-to-end-testing.html#cb321-21" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb321-22"><a href="end-to-end-testing.html#cb321-22" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>We can now safely run our test:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb322-1"><a href="end-to-end-testing.html#cb322-1" tabindex="-1"></a><span class="ex">$</span> MIX_ENV=integration mix test.integration</span></code></pre></div>
<p>Wait… Why do we need to set the <code>MIX_ENV</code> before calling our alias?</p>
<p>So, as I mentioned earlier, the <code>mix test</code> command automatically assigns the <code>"test"</code> environment when called. However, our alias contains other commands like <code>mix ecto.create</code>, which without specifying the environment explicitly, would be run using the dev database. So we would set up the dev databases(drop, create, migrate &amp; seed) and then run tests on the test databases.</p>
<p>So our test is now passing, but it relies on the database being setup upfront, which requires seeding using a couple of requests to the Binance API.</p>
</div>
<div id="cache-initial-seed-data-inside-a-file" class="section level2 hasAnchor" number="16.6">
<h2><span class="header-section-number">16.6</span> Cache initial seed data inside a file<a href="end-to-end-testing.html#cache-initial-seed-data-inside-a-file" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Relying on the 3rd party API to be able to seed our database to run tests is a horrible idea. However, we can fix that by cache the response JSON in a file.</p>
<p>How will this data be tunneled into the test database?</p>
<p>In the spirit of limiting the change footprint, we could update the <code>BinanceMock</code> module to serve the cached data dependent on the flag - let’s add that flag first:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb323-1"><a href="end-to-end-testing.html#cb323-1" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb323-2"><a href="end-to-end-testing.html#cb323-2" tabindex="-1"></a><span class="co"># add below lines under the `import Config` line </span></span>
<span id="cb323-3"><a href="end-to-end-testing.html#cb323-3" tabindex="-1"></a>config <span class="va">:binance_mock</span>,</span>
<span id="cb323-4"><a href="end-to-end-testing.html#cb323-4" tabindex="-1"></a>  <span class="va">use_cached_exchange_info:</span> <span class="cn">false</span></span></code></pre></div>
<div class="sourceCode" id="cb324"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb324-1"><a href="end-to-end-testing.html#cb324-1" tabindex="-1"></a><span class="co"># /config/integration.exs</span></span>
<span id="cb324-2"><a href="end-to-end-testing.html#cb324-2" tabindex="-1"></a><span class="co"># add below lines under the `import Config` line </span></span>
<span id="cb324-3"><a href="end-to-end-testing.html#cb324-3" tabindex="-1"></a>config <span class="va">:binance_mock</span>,</span>
<span id="cb324-4"><a href="end-to-end-testing.html#cb324-4" tabindex="-1"></a>  <span class="va">use_cached_exchange_info:</span> <span class="cn">true</span></span></code></pre></div>
<p>We can see how convenient it is to have a configuration file per environment - we enabled cached exchange info data only for the test environment.</p>
<p>Inside the <code>BinanceMock</code> module, we can now update the <code>get_exchange_info/0</code> function to use this configuration value to serve either cached or live exchange info response:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb325-1"><a href="end-to-end-testing.html#cb325-1" tabindex="-1"></a>  <span class="co"># /apps/binance_mock/lib/binance_mock.ex</span></span>
<span id="cb325-2"><a href="end-to-end-testing.html#cb325-2" tabindex="-1"></a>  <span class="kw">def</span> get_exchange_info<span class="fu">()</span> <span class="kw">do</span></span>
<span id="cb325-3"><a href="end-to-end-testing.html#cb325-3" tabindex="-1"></a>    <span class="kw">case</span> <span class="cn">Application</span><span class="op">.</span>get_env<span class="fu">(</span><span class="va">:binance_mock</span>, <span class="va">:use_cached_exchange_info</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb325-4"><a href="end-to-end-testing.html#cb325-4" tabindex="-1"></a>      <span class="cn">true</span> <span class="op">-&gt;</span> get_cached_exchange_info<span class="fu">()</span></span>
<span id="cb325-5"><a href="end-to-end-testing.html#cb325-5" tabindex="-1"></a>      _ <span class="op">-&gt;</span> <span class="cn">Binance</span><span class="op">.</span>get_exchange_info<span class="fu">()</span></span>
<span id="cb325-6"><a href="end-to-end-testing.html#cb325-6" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb325-7"><a href="end-to-end-testing.html#cb325-7" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb325-8"><a href="end-to-end-testing.html#cb325-8" tabindex="-1"></a></span>
<span id="cb325-9"><a href="end-to-end-testing.html#cb325-9" tabindex="-1"></a>  <span class="co"># add this at the bottom of the module</span></span>
<span id="cb325-10"><a href="end-to-end-testing.html#cb325-10" tabindex="-1"></a>  <span class="kw">defp</span> get_cached_exchange_info <span class="kw">do</span></span>
<span id="cb325-11"><a href="end-to-end-testing.html#cb325-11" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:ok</span>, data<span class="fu">}</span> <span class="op">=</span></span>
<span id="cb325-12"><a href="end-to-end-testing.html#cb325-12" tabindex="-1"></a>      <span class="cn">File</span><span class="op">.</span>cwd!<span class="fu">()</span></span>
<span id="cb325-13"><a href="end-to-end-testing.html#cb325-13" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Path</span><span class="op">.</span>split<span class="fu">()</span></span>
<span id="cb325-14"><a href="end-to-end-testing.html#cb325-14" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>drop<span class="fu">(</span><span class="op">-</span><span class="dv">1</span><span class="fu">)</span></span>
<span id="cb325-15"><a href="end-to-end-testing.html#cb325-15" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Kernel</span><span class="op">.++</span><span class="fu">(</span><span class="ot">[</span></span>
<span id="cb325-16"><a href="end-to-end-testing.html#cb325-16" tabindex="-1"></a>        <span class="st">&quot;binance_mock&quot;</span>,</span>
<span id="cb325-17"><a href="end-to-end-testing.html#cb325-17" tabindex="-1"></a>        <span class="st">&quot;test&quot;</span>,</span>
<span id="cb325-18"><a href="end-to-end-testing.html#cb325-18" tabindex="-1"></a>        <span class="st">&quot;assets&quot;</span>,</span>
<span id="cb325-19"><a href="end-to-end-testing.html#cb325-19" tabindex="-1"></a>        <span class="st">&quot;exchange_info.json&quot;</span></span>
<span id="cb325-20"><a href="end-to-end-testing.html#cb325-20" tabindex="-1"></a>      <span class="ot">]</span><span class="fu">)</span></span>
<span id="cb325-21"><a href="end-to-end-testing.html#cb325-21" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Path</span><span class="op">.</span>join<span class="fu">()</span></span>
<span id="cb325-22"><a href="end-to-end-testing.html#cb325-22" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">File</span><span class="op">.</span>read<span class="fu">()</span></span>
<span id="cb325-23"><a href="end-to-end-testing.html#cb325-23" tabindex="-1"></a></span>
<span id="cb325-24"><a href="end-to-end-testing.html#cb325-24" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:ok</span>, <span class="cn">Jason</span><span class="op">.</span>decode!<span class="fu">(</span>data<span class="fu">)</span> <span class="op">|&gt;</span> <span class="cn">Binance</span><span class="op">.</span><span class="cn">ExchangeInfo</span><span class="op">.</span>new<span class="fu">()}</span></span>
<span id="cb325-25"><a href="end-to-end-testing.html#cb325-25" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>As the <code>binance_mock</code> app wasn’t using the <code>jason</code> package before, we need to add it to dependencies:</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb326-1"><a href="end-to-end-testing.html#cb326-1" tabindex="-1"></a>  <span class="co"># /apps/binance_mock/mix.exs</span></span>
<span id="cb326-2"><a href="end-to-end-testing.html#cb326-2" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb326-3"><a href="end-to-end-testing.html#cb326-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb326-4"><a href="end-to-end-testing.html#cb326-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb326-5"><a href="end-to-end-testing.html#cb326-5" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:jason</span>, <span class="st">&quot;~&gt; 1.2&quot;</span><span class="fu">}</span>,</span>
<span id="cb326-6"><a href="end-to-end-testing.html#cb326-6" tabindex="-1"></a>      <span class="op">...</span></span></code></pre></div>
<p>The above change will take care of flipping between serving the live/cached exchange info data, but we still need to manually save the current response to the file (to be used as a cached version later).</p>
<p>Let’s open the IEx terminal to fetch the exchange info data and serialize it to JSON:</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb327-1"><a href="end-to-end-testing.html#cb327-1" tabindex="-1"></a><span class="ex">$</span> iex <span class="at">-S</span> mix</span>
<span id="cb327-2"><a href="end-to-end-testing.html#cb327-2" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="op">&gt;</span> Binance.get_exchange_info<span class="kw">()</span> <span class="kw">|</span><span class="op">&gt;</span> elem<span class="kw">(</span><span class="ex">1</span><span class="kw">)</span> <span class="kw">|</span><span class="op">&gt;</span> Jason.encode!</span></code></pre></div>
<p>You should get the following error:</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb328-1"><a href="end-to-end-testing.html#cb328-1" tabindex="-1"></a><span class="ex">...</span> of type Binance.ExchangeInfo <span class="er">(</span><span class="ex">a</span> struct<span class="kw">)</span><span class="ex">,</span> Jason.Encoder protocol must always be</span>
<span id="cb328-2"><a href="end-to-end-testing.html#cb328-2" tabindex="-1"></a><span class="ex">explicitly</span> implemented.</span>
<span id="cb328-3"><a href="end-to-end-testing.html#cb328-3" tabindex="-1"></a></span>
<span id="cb328-4"><a href="end-to-end-testing.html#cb328-4" tabindex="-1"></a><span class="ex">If</span> you own the struct, you can derive the implementation specifying which fields</span>
<span id="cb328-5"><a href="end-to-end-testing.html#cb328-5" tabindex="-1"></a><span class="ex">should</span> be encoded to JSON:</span>
<span id="cb328-6"><a href="end-to-end-testing.html#cb328-6" tabindex="-1"></a></span>
<span id="cb328-7"><a href="end-to-end-testing.html#cb328-7" tabindex="-1"></a>    <span class="ex">@derive</span> {Jason.Encoder, only: <span class="pp">[</span><span class="ss">....</span><span class="pp">]</span>}</span>
<span id="cb328-8"><a href="end-to-end-testing.html#cb328-8" tabindex="-1"></a>    <span class="ex">defstruct</span> ...</span>
<span id="cb328-9"><a href="end-to-end-testing.html#cb328-9" tabindex="-1"></a></span>
<span id="cb328-10"><a href="end-to-end-testing.html#cb328-10" tabindex="-1"></a><span class="ex">It</span> is also possible to encode all fields, although this should be used carefully</span>
<span id="cb328-11"><a href="end-to-end-testing.html#cb328-11" tabindex="-1"></a><span class="ex">to</span> avoid accidentally leaking private information when new fields are added:</span>
<span id="cb328-12"><a href="end-to-end-testing.html#cb328-12" tabindex="-1"></a></span>
<span id="cb328-13"><a href="end-to-end-testing.html#cb328-13" tabindex="-1"></a>    <span class="ex">@derive</span> Jason.Encoder</span>
<span id="cb328-14"><a href="end-to-end-testing.html#cb328-14" tabindex="-1"></a>    <span class="ex">defstruct</span> ...</span>
<span id="cb328-15"><a href="end-to-end-testing.html#cb328-15" tabindex="-1"></a></span>
<span id="cb328-16"><a href="end-to-end-testing.html#cb328-16" tabindex="-1"></a><span class="ex">Finally,</span> if you dont own the struct you want to encode to JSON, you may use</span>
<span id="cb328-17"><a href="end-to-end-testing.html#cb328-17" tabindex="-1"></a><span class="ex">Protocol.derive/3</span> placed outside of any module: </span>
<span id="cb328-18"><a href="end-to-end-testing.html#cb328-18" tabindex="-1"></a></span>
<span id="cb328-19"><a href="end-to-end-testing.html#cb328-19" tabindex="-1"></a>    <span class="ex">Protocol.derive</span><span class="er">(</span><span class="ex">Jason.Encoder,</span> NameOfTheStruct, only: <span class="pp">[</span><span class="ss">...</span><span class="pp">]</span><span class="kw">)</span></span>
<span id="cb328-20"><a href="end-to-end-testing.html#cb328-20" tabindex="-1"></a>    <span class="ex">Protocol.derive</span><span class="er">(</span><span class="ex">Jason.Encoder,</span> NameOfTheStruct<span class="kw">)</span></span></code></pre></div>
<p>In a nutshell, this means that the <code>jason</code> package doesn’t know how to encode the <code>Binance.ExchangeInfo</code> struct. Ok, as we don’t own this struct(it’s a part of the <code>binance</code> package), we will follow the last suggestion and try to derive the <code>Jason.Encoder</code> module for the <code>Binance.ExchangeInfo</code> struct:</p>
<div class="sourceCode" id="cb329"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb329-1"><a href="end-to-end-testing.html#cb329-1" tabindex="-1"></a><span class="ex">$</span> iex <span class="at">-S</span> mix</span>
<span id="cb329-2"><a href="end-to-end-testing.html#cb329-2" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="op">&gt;</span> require <span class="ex">Protocol</span></span>
<span id="cb329-3"><a href="end-to-end-testing.html#cb329-3" tabindex="-1"></a><span class="ex">Protocol</span></span>
<span id="cb329-4"><a href="end-to-end-testing.html#cb329-4" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">2</span><span class="kw">)</span><span class="op">&gt;</span> Protocol.derive<span class="kw">(</span><span class="ex">Jason.Encoder,</span> Binance.ExchangeInfo<span class="kw">)</span></span>
<span id="cb329-5"><a href="end-to-end-testing.html#cb329-5" tabindex="-1"></a><span class="ex">warning:</span> the Jason.Encoder protocol has already been consolidated, an implementation for</span>
<span id="cb329-6"><a href="end-to-end-testing.html#cb329-6" tabindex="-1"></a><span class="ex">Binance.ExchangeInfo</span> has no effect. If you want to implement protocols after compilation</span>
<span id="cb329-7"><a href="end-to-end-testing.html#cb329-7" tabindex="-1"></a><span class="ex">or</span> during tests, check the <span class="st">&quot;Consolidation&quot;</span> section in the Protocol module documentation</span>
<span id="cb329-8"><a href="end-to-end-testing.html#cb329-8" tabindex="-1"></a>  <span class="ex">iex:2:</span> <span class="er">(</span><span class="fu">file</span><span class="kw">)</span></span></code></pre></div>
<p>Hmm… This didn’t work again. The reason for it is a mechanism called the “Protocol consolidation”. Long story short, Elixir at compilation time knows upfront what structs derive which protocols, and to speed things up, it consolidates them at that moment. To avoid this process being run in development, we can modify the main <code>mix.exs</code> file to disable it:</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb330-1"><a href="end-to-end-testing.html#cb330-1" tabindex="-1"></a>  <span class="co"># /mix.exs </span></span>
<span id="cb330-2"><a href="end-to-end-testing.html#cb330-2" tabindex="-1"></a>  <span class="kw">def</span> project <span class="kw">do</span></span>
<span id="cb330-3"><a href="end-to-end-testing.html#cb330-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb330-4"><a href="end-to-end-testing.html#cb330-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb330-5"><a href="end-to-end-testing.html#cb330-5" tabindex="-1"></a>      <span class="va">consolidate_protocols:</span> <span class="cn">Mix</span><span class="op">.</span>env<span class="fu">()</span> <span class="op">==</span> <span class="va">:prod</span></span>
<span id="cb330-6"><a href="end-to-end-testing.html#cb330-6" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb330-7"><a href="end-to-end-testing.html#cb330-7" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>We should now be able to encode JSON using the <code>jason</code> module:</p>
<div class="sourceCode" id="cb331"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb331-1"><a href="end-to-end-testing.html#cb331-1" tabindex="-1"></a><span class="ex">$</span> mkdir apps/binance_mock/test/assets</span>
<span id="cb331-2"><a href="end-to-end-testing.html#cb331-2" tabindex="-1"></a><span class="ex">$</span> iex <span class="at">-S</span> mix</span>
<span id="cb331-3"><a href="end-to-end-testing.html#cb331-3" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="op">&gt;</span> require <span class="ex">Protocol</span></span>
<span id="cb331-4"><a href="end-to-end-testing.html#cb331-4" tabindex="-1"></a><span class="ex">Protocol</span></span>
<span id="cb331-5"><a href="end-to-end-testing.html#cb331-5" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">2</span><span class="kw">)</span><span class="op">&gt;</span> Protocol.derive<span class="kw">(</span><span class="ex">Jason.Encoder,</span> Binance.ExchangeInfo<span class="kw">)</span></span>
<span id="cb331-6"><a href="end-to-end-testing.html#cb331-6" tabindex="-1"></a><span class="ex">:ok</span></span>
<span id="cb331-7"><a href="end-to-end-testing.html#cb331-7" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">3</span><span class="kw">)</span><span class="op">&gt;</span> data <span class="ex">=</span> Binance.get_exchange_info<span class="er">(</span><span class="kw">)</span> <span class="kw">|</span><span class="op">&gt;</span> elem<span class="kw">(</span><span class="ex">1</span><span class="kw">)</span> <span class="kw">|</span><span class="op">&gt;</span> Jason.encode<span class="pp">!(</span>pretty: true<span class="pp">)</span></span>
<span id="cb331-8"><a href="end-to-end-testing.html#cb331-8" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb331-9"><a href="end-to-end-testing.html#cb331-9" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">4</span><span class="kw">)</span><span class="op">&gt;</span> File.write<span class="kw">(</span><span class="st">&quot;apps/binance_mock/test/assets/exchange_info.json&quot;</span><span class="ex">,</span> data<span class="kw">)</span></span>
<span id="cb331-10"><a href="end-to-end-testing.html#cb331-10" tabindex="-1"></a><span class="ex">:ok</span></span></code></pre></div>
<p>So we have the BinanceMock updated to serve cached/live responses based on the configuration and cached exchange info response.</p>
<p>The last step is to ensure that seeding uses the BinanceMock module instead of using Binance directly to leverage the above implementation.</p>
</div>
<div id="update-seeding-scripts-to-use-the-binancemock" class="section level2 hasAnchor" number="16.7">
<h2><span class="header-section-number">16.7</span> Update seeding scripts to use the BinanceMock<a href="end-to-end-testing.html#update-seeding-scripts-to-use-the-binancemock" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The seed settings script for the <code>Naive</code> application(apps/naive/priv/seed_settings.exs) already uses the <code>BinanceMock</code>.</p>
<p>Inside the <code>Streamer</code> application (apps/streamer/priv/seed_settings.exs) we can see that the <code>Binance</code> module is getting used. So we can update the fetching part of the script to the following to fix it:</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb332-1"><a href="end-to-end-testing.html#cb332-1" tabindex="-1"></a><span class="co"># /apps/streamer/priv/seed_settings.exs</span></span>
<span id="cb332-2"><a href="end-to-end-testing.html#cb332-2" tabindex="-1"></a>binance_client <span class="op">=</span> <span class="cn">Application</span><span class="op">.</span>compile_env<span class="fu">(</span><span class="va">:streamer</span>, <span class="va">:binance_client</span><span class="fu">)</span> <span class="co"># &lt;= new</span></span>
<span id="cb332-3"><a href="end-to-end-testing.html#cb332-3" tabindex="-1"></a></span>
<span id="cb332-4"><a href="end-to-end-testing.html#cb332-4" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info<span class="fu">(</span><span class="st">&quot;Fetching exchange info from Binance to create streaming settings&quot;</span><span class="fu">)</span></span>
<span id="cb332-5"><a href="end-to-end-testing.html#cb332-5" tabindex="-1"></a></span>
<span id="cb332-6"><a href="end-to-end-testing.html#cb332-6" tabindex="-1"></a><span class="fu">{</span><span class="va">:ok</span>, %<span class="fu">{</span><span class="va">symbols:</span> symbols<span class="fu">}}</span> <span class="op">=</span> binance_client<span class="op">.</span>get_exchange_info<span class="fu">()</span> <span class="co"># &lt;= updated</span></span></code></pre></div>
<p>We need to update the config to point to the <code>BinanceMock</code> for the <code>streamer</code> application in the same way as we do for the <code>naive</code> application:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb333-1"><a href="end-to-end-testing.html#cb333-1" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb333-2"><a href="end-to-end-testing.html#cb333-2" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb333-3"><a href="end-to-end-testing.html#cb333-3" tabindex="-1"></a>config <span class="va">:streamer</span>,</span>
<span id="cb333-4"><a href="end-to-end-testing.html#cb333-4" tabindex="-1"></a>  <span class="va">binance_client:</span> <span class="cn">BinanceMock</span>, <span class="co"># &lt;= added</span></span>
<span id="cb333-5"><a href="end-to-end-testing.html#cb333-5" tabindex="-1"></a>  <span class="va">ecto_repos:</span> <span class="ot">[</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Repo</span><span class="ot">]</span></span>
<span id="cb333-6"><a href="end-to-end-testing.html#cb333-6" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
<div class="sourceCode" id="cb334"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb334-1"><a href="end-to-end-testing.html#cb334-1" tabindex="-1"></a><span class="co"># /config/prod.exs</span></span>
<span id="cb334-2"><a href="end-to-end-testing.html#cb334-2" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb334-3"><a href="end-to-end-testing.html#cb334-3" tabindex="-1"></a>config <span class="va">:streamer</span>,</span>
<span id="cb334-4"><a href="end-to-end-testing.html#cb334-4" tabindex="-1"></a>  <span class="va">binance_client:</span> <span class="cn">Binance</span></span></code></pre></div>
<p>as well as swap the <code>binance</code> to the <code>BinanceMock</code> inside the list of dependencies of the <code>Streamer</code> app:</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb335-1"><a href="end-to-end-testing.html#cb335-1" tabindex="-1"></a><span class="co"># /apps/streamer/mix.exs</span></span>
<span id="cb335-2"><a href="end-to-end-testing.html#cb335-2" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb335-3"><a href="end-to-end-testing.html#cb335-3" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb335-4"><a href="end-to-end-testing.html#cb335-4" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb335-5"><a href="end-to-end-testing.html#cb335-5" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:binance_mock</span>, <span class="va">in_umbrella:</span> <span class="cn">true</span><span class="fu">}</span>,</span>
<span id="cb335-6"><a href="end-to-end-testing.html#cb335-6" tabindex="-1"></a>      <span class="op">...</span></span></code></pre></div>
<p>At this moment, we should be ready to run our test using the test database together with cached Binance response:</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb336-1"><a href="end-to-end-testing.html#cb336-1" tabindex="-1"></a><span class="ex">$</span> MIX_ENV=test mix test.integration</span>
<span id="cb336-2"><a href="end-to-end-testing.html#cb336-2" tabindex="-1"></a><span class="ex">**</span> <span class="er">(</span><span class="ex">Mix</span><span class="kw">)</span> <span class="ex">Could</span> not sort dependencies. There are cycles in the dependency graph</span></code></pre></div>
<p>And this is the moment when we will pay for cutting corners in the past. Let me explain. When we started this project, as we implemented communication using the PubSub topics, we put both the <code>PubSub</code> process(in the supervision tree) and the <code>TradeEvent</code> struct inside the streamer application. The knock-on effect of this decision is that any other app in the umbrella that would like to use either <code>PubSub</code> or <code>TradeEvent</code> struct needs to depend on the <code>streamer</code> application:</p>
<p><img src="images/chapter_16_03_relying_on_streamer.png" width="100%" style="display: block; margin: auto;" /></p>
<p>As we added the <code>binance_mock</code> application as a dependency of the streamer application, we created a dependency cycle.</p>
<p>This is quite typical in daily work as a software engineer. One of the common problems(besides naming things) is deciding where things belong. For example, do PubSub and TradeEvent belong in the Streamer app? Or maybe we should put it in the BinanceMock?</p>
<p>I believe that it should be neither of them as those applications use the PubSub and TradeEvent struct. I believe that they should be placed in neither of those applications as those applications are only
using the struct and PubSub process.</p>
<p>What we should do instead is to create a new supervised application where we can attach the PubSub to the supervision tree and hold the system-wide structs(like TradeEvent) so every app can depend on it instead of each other:</p>
<p><img src="images/chapter_16_04_core.png" width="100%" style="display: block; margin: auto;" /></p>
<div style="page-break-after: always;"></div>
</div>
<div id="introduce-the-core-application" class="section level2 hasAnchor" number="16.8">
<h2><span class="header-section-number">16.8</span> Introduce the Core application<a href="end-to-end-testing.html#introduce-the-core-application" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s start with create a new application:</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb337-1"><a href="end-to-end-testing.html#cb337-1" tabindex="-1"></a><span class="ex">$</span> cd apps</span>
<span id="cb337-2"><a href="end-to-end-testing.html#cb337-2" tabindex="-1"></a><span class="ex">$</span> mix new <span class="at">--sup</span> core</span></code></pre></div>
<p>We can now create a new directory called <code>struct</code> inside the <code>apps/core/lib/core</code> directory and move the <code>TradeEvent</code> struct from the <code>streamer</code> app to it(in the same terminal or from the <code>apps</code> directory):</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb338-1"><a href="end-to-end-testing.html#cb338-1" tabindex="-1"></a><span class="ex">$</span> mkdir core/lib/core/struct</span>
<span id="cb338-2"><a href="end-to-end-testing.html#cb338-2" tabindex="-1"></a><span class="ex">$</span> mv streamer/lib/streamer/binance/trade_event.ex core/lib/core/struct</span></code></pre></div>
<p>Now we need to update the module to <code>Core.Struct.TradeEvent</code>:</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb339-1"><a href="end-to-end-testing.html#cb339-1" tabindex="-1"></a><span class="co"># /apps/core/lib/core/struct/trade_event.ex</span></span>
<span id="cb339-2"><a href="end-to-end-testing.html#cb339-2" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb339-3"><a href="end-to-end-testing.html#cb339-3" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Core</span><span class="op">.</span><span class="cn">Struct</span><span class="op">.</span><span class="cn">TradeEvent</span> <span class="kw">do</span></span></code></pre></div>
<p>As we moved the <code>TradeEvent</code> struct over to the <code>Core</code> application, we need to:</p>
<ul>
<li>update all places that reference the <code>Streamer.Binance.TradeEvent</code> to <code>Core.Struct.TradeEvent</code></li>
<li>add the <code>core</code> to the dependencies lists of all apps in the umbrella</li>
<li>remove the <code>streamer</code> from the dependencies lists of all apps in the umbrella</li>
</ul>
<p>The final step will be to move the PubSub process from the supervision tree of the Streamer application to the supervision of the Core application.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb340-1"><a href="end-to-end-testing.html#cb340-1" tabindex="-1"></a><span class="co"># /apps/streamer/lib/streamer/application.ex</span></span>
<span id="cb340-2"><a href="end-to-end-testing.html#cb340-2" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>_type, _args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb340-3"><a href="end-to-end-testing.html#cb340-3" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb340-4"><a href="end-to-end-testing.html#cb340-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb340-5"><a href="end-to-end-testing.html#cb340-5" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb340-6"><a href="end-to-end-testing.html#cb340-6" tabindex="-1"></a>        <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb340-7"><a href="end-to-end-testing.html#cb340-7" tabindex="-1"></a>        <span class="va">name:</span> <span class="cn">Streamer</span><span class="op">.</span><span class="cn">PubSub</span>, <span class="va">adapter_name:</span> <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span><span class="cn">PG2</span></span>
<span id="cb340-8"><a href="end-to-end-testing.html#cb340-8" tabindex="-1"></a>      <span class="fu">}</span>, <span class="co"># ^ remove it from here</span></span>
<span id="cb340-9"><a href="end-to-end-testing.html#cb340-9" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb340-10"><a href="end-to-end-testing.html#cb340-10" tabindex="-1"></a>    <span class="ot">]</span></span></code></pre></div>
<div class="sourceCode" id="cb341"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb341-1"><a href="end-to-end-testing.html#cb341-1" tabindex="-1"></a><span class="co"># /apps/core/lib/core/application.ex</span></span>
<span id="cb341-2"><a href="end-to-end-testing.html#cb341-2" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>_type, _args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb341-3"><a href="end-to-end-testing.html#cb341-3" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb341-4"><a href="end-to-end-testing.html#cb341-4" tabindex="-1"></a>      <span class="fu">{</span></span>
<span id="cb341-5"><a href="end-to-end-testing.html#cb341-5" tabindex="-1"></a>        <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb341-6"><a href="end-to-end-testing.html#cb341-6" tabindex="-1"></a>        <span class="va">name:</span> <span class="cn">Core</span><span class="op">.</span><span class="cn">PubSub</span>, <span class="va">adapter_name:</span> <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span><span class="cn">PG2</span></span>
<span id="cb341-7"><a href="end-to-end-testing.html#cb341-7" tabindex="-1"></a>      <span class="fu">}</span> <span class="co"># ^ add it here</span></span>
<span id="cb341-8"><a href="end-to-end-testing.html#cb341-8" tabindex="-1"></a>    <span class="ot">]</span></span></code></pre></div>
<p>As we changed the module name of the PubSub process(from <code>Streamer.PubSub</code> to <code>Core.PubSub</code>), we need to update all the places where it’s referenced as well as add the <code>phoenix_pubsub</code> package to dependencies of the <code>core</code> application:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb342-1"><a href="end-to-end-testing.html#cb342-1" tabindex="-1"></a>  <span class="co"># /apps/core/mix.exs</span></span>
<span id="cb342-2"><a href="end-to-end-testing.html#cb342-2" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb342-3"><a href="end-to-end-testing.html#cb342-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb342-4"><a href="end-to-end-testing.html#cb342-4" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:phoenix_pubsub</span>, <span class="st">&quot;~&gt; 2.0&quot;</span><span class="fu">}</span></span>
<span id="cb342-5"><a href="end-to-end-testing.html#cb342-5" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb342-6"><a href="end-to-end-testing.html#cb342-6" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>We can now run our test that will use the test database as well as cached exchange info:</p>
<div class="sourceCode" id="cb343"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb343-1"><a href="end-to-end-testing.html#cb343-1" tabindex="-1"></a><span class="ex">$</span> MIX_ENV=test mix test.integration</span></code></pre></div>
<p>We should see a lot of setup log followed by a confirmation:</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb344-1"><a href="end-to-end-testing.html#cb344-1" tabindex="-1"></a><span class="ex">Finished</span> in 0.03 seconds <span class="er">(</span><span class="ex">0.00s</span> async, 0.03s sync<span class="kw">)</span></span>
<span id="cb344-2"><a href="end-to-end-testing.html#cb344-2" tabindex="-1"></a><span class="ex">1</span> test, 0 failures, 1 excluded</span></code></pre></div>
<p>This wraps up our implementation of the end-to-end test. In the next chapter, we will see how we would implement a unit test for our trading strategy.</p>
<p>The additional benefit of all the time that we put in the implementation of this test is that we won’t need to remember how to set up local environment anymore as it’s as simple as:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb345-1"><a href="end-to-end-testing.html#cb345-1" tabindex="-1"></a><span class="ex">mix</span> setup</span></code></pre></div>
<p>Yay! :)</p>
<p>It’s worth reiterating the downsides of the end-to-end tests:</p>
<ul>
<li>lack of visibility over what’s broken - most of the time, we will see the result of error but not the error itself</li>
<li>requirement of synchronous execution - they rely on the database(s), so they can’t be run in parallel</li>
<li>randomness/flakiness - as there’s no feedback loop, we wait for a hardcoded amount of time, that we assume it’s enough to finish initialization/execution - this can randomly fail</li>
</ul>
<p>It’s possible to implement a feedback loop and run our tests inside “sandbox” (transaction), but it’s not worth it as we can invest that time into developing reliable unit tests.</p>
<p>[Note] Please remember to run the <code>mix format</code> to keep things nice and tidy.</p>
<p>The source code for this chapter can be found on <a href="https://github.com/Cinderella-Man/hands-on-elixir-and-otp-cryptocurrency-trading-bot-source-code/tree/chapter_16">GitHub</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="backtest-trading-strategy.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="mox-rocks.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Cinderella-Man/hands-on-elixir-and-otp-cryptocurrency-trading-bot/edit/main/16-end-to-end-testing.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
