<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 23 Back to the Monolith | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot</title>
  <meta name="description" content="Chapter 23 Back to the Monolith | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 23 Back to the Monolith | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="Cinderella-Man/hands-on-elixir-and-otp-cryptocurrency-trading-bot" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 23 Back to the Monolith | Hands-on Elixir &amp; OTP: Cryptocurrency trading bot" />
  <meta name="twitter:site" content="@kamilskowron" />
  
  

<meta name="author" content="Kamil Skowron" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="win-with-pure-logic.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-52FKGBX2B8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-52FKGBX2B8');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Hands-on Elixir & OTP: Cryptocurrency trading bot</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#want-to-learn-elixir-otp-by-creating-a-real-world-project"><i class="fa fa-check"></i>Want to learn Elixir &amp; OTP by creating a real-world project?</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#limit-of-liabilitydisclaimer-of-warranty"><i class="fa fa-check"></i>Limit of Liability/Disclaimer of Warranty</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#pdf-epub"><i class="fa fa-check"></i>PDF &amp; EPUB</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface-1"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-this-book-covers"><i class="fa fa-check"></i>What this book covers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributing-errata-and-source-code"><i class="fa fa-check"></i>Contributing, Errata and Source code</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><i class="fa fa-check"></i><b>1</b> Stream live cryptocurrency prices from the Binance WSS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#create-a-new-umbrella-app"><i class="fa fa-check"></i><b>1.2</b> Create a new umbrella app</a></li>
<li class="chapter" data-level="1.3" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#create-a-supervised-application-inside-an-umbrella"><i class="fa fa-check"></i><b>1.3</b> Create a supervised application inside an umbrella</a></li>
<li class="chapter" data-level="1.4" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#connect-to-binances-websocket-stream-using-the-websockex-module"><i class="fa fa-check"></i><b>1.4</b> Connect to Binance’s WebSocket Stream using the WebSockex module</a></li>
<li class="chapter" data-level="1.5" data-path="stream-live-cryptocurrency-prices-from-the-binance-wss.html"><a href="stream-live-cryptocurrency-prices-from-the-binance-wss.html#decode-incoming-events-using-the-jason-module"><i class="fa fa-check"></i><b>1.5</b> Decode incoming events using the Jason module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><i class="fa fa-check"></i><b>2</b> Create a naive trading strategy - a single trader process without supervision</a>
<ul>
<li class="chapter" data-level="2.1" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#initialisation"><i class="fa fa-check"></i><b>2.2</b> Initialisation</a></li>
<li class="chapter" data-level="2.3" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#how-trading-strategy-will-work"><i class="fa fa-check"></i><b>2.3</b> How trading strategy will work?</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-of-the-first-scenario"><i class="fa fa-check"></i><b>2.3.1</b> Implementation of the first scenario</a></li>
<li class="chapter" data-level="2.3.2" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-of-the-second-scenario"><i class="fa fa-check"></i><b>2.3.2</b> Implementation of the second scenario</a></li>
<li class="chapter" data-level="2.3.3" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-of-the-third-scenario"><i class="fa fa-check"></i><b>2.3.3</b> Implementation of the third scenario</a></li>
<li class="chapter" data-level="2.3.4" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#implementation-fallback-scenario"><i class="fa fa-check"></i><b>2.3.4</b> Implementation fallback scenario</a></li>
<li class="chapter" data-level="2.3.5" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#updating-the-naive-interface"><i class="fa fa-check"></i><b>2.3.5</b> Updating the Naive interface</a></li>
<li class="chapter" data-level="2.3.6" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#updating-streamer-app"><i class="fa fa-check"></i><b>2.3.6</b> Updating streamer app</a></li>
<li class="chapter" data-level="2.3.7" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#access-details-to-binance"><i class="fa fa-check"></i><b>2.3.7</b> Access details to Binance</a></li>
<li class="chapter" data-level="2.3.8" data-path="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy---a-single-trader-process-without-supervision.html#test-run"><i class="fa fa-check"></i><b>2.3.8</b> Test run</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html"><i class="fa fa-check"></i><b>3</b> Introduce PubSub as a communication method</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#design"><i class="fa fa-check"></i><b>3.2</b> Design</a></li>
<li class="chapter" data-level="3.3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#implementation"><i class="fa fa-check"></i><b>3.3</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html"><i class="fa fa-check"></i><b>4</b> Mock the Binance API</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#design-1"><i class="fa fa-check"></i><b>4.2</b> Design</a></li>
<li class="chapter" data-level="4.3" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#create-binancemock-app"><i class="fa fa-check"></i><b>4.3</b> Create “BinanceMock” app</a></li>
<li class="chapter" data-level="4.4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-getting-exchange-info"><i class="fa fa-check"></i><b>4.4</b> Implement getting exchange info</a></li>
<li class="chapter" data-level="4.5" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-placing-buy-and-sell-orders"><i class="fa fa-check"></i><b>4.5</b> Implement placing buy and sell orders</a></li>
<li class="chapter" data-level="4.6" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-order-retrival"><i class="fa fa-check"></i><b>4.6</b> Implement order retrival</a></li>
<li class="chapter" data-level="4.7" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-callback-for-incoming-trade-events"><i class="fa fa-check"></i><b>4.7</b> Implement callback for incoming trade events</a></li>
<li class="chapter" data-level="4.8" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#upgrade-trader-and-config"><i class="fa fa-check"></i><b>4.8</b> Upgrade trader and config</a></li>
<li class="chapter" data-level="4.9" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#test-the-implementation"><i class="fa fa-check"></i><b>4.9</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html"><i class="fa fa-check"></i><b>5</b> Enable parallel trading on multiple symbols</a>
<ul>
<li class="chapter" data-level="5.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#introduction---architectural-design"><i class="fa fa-check"></i><b>5.2</b> Introduction - architectural design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#update-application-supervisor"><i class="fa fa-check"></i><b>5.2.1</b> Update application supervisor</a></li>
<li class="chapter" data-level="5.2.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#add-interface-method"><i class="fa fa-check"></i><b>5.2.2</b> Add interface method</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.symbolsupervisor"><i class="fa fa-check"></i><b>5.3</b> Implement <code>Naive.SymbolSupervisor</code></a></li>
<li class="chapter" data-level="5.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.leader"><i class="fa fa-check"></i><b>5.4</b> Implement <code>Naive.Leader</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-leader-module"><i class="fa fa-check"></i><b>5.4.1</b> Updating the <code>leader</code> module</a></li>
<li class="chapter" data-level="5.4.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-naive.trader-module"><i class="fa fa-check"></i><b>5.4.2</b> Updating the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="5.4.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#finalizing-naive.leader-implementation"><i class="fa fa-check"></i><b>5.4.3</b> Finalizing <code>Naive.Leader</code> implementation</a></li>
<li class="chapter" data-level="5.4.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#iex-testing"><i class="fa fa-check"></i><b>5.4.4</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><i class="fa fa-check"></i><b>6</b> Introduce a <code>buy_down_interval</code> to make a single trader more profitable</a>
<ul>
<li class="chapter" data-level="6.1" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#why-we-need-to-buy-below-the-current-price-feature-overview"><i class="fa fa-check"></i><b>6.2</b> Why we need to buy below the current price? Feature overview</a></li>
<li class="chapter" data-level="6.3" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#naive.trader-implementation"><i class="fa fa-check"></i><b>6.3</b> <code>Naive.Trader</code> implementation</a></li>
<li class="chapter" data-level="6.4" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#naive.leader-implementation"><i class="fa fa-check"></i><b>6.4</b> <code>Naive.Leader</code> implementation</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html"><a href="introduce-a-buy_down_interval-to-make-a-single-trader-more-profitable.html#iex-testing-1"><i class="fa fa-check"></i><b>6.4.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html"><i class="fa fa-check"></i><b>7</b> Introduce a trader budget and calculating the quantity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#objectives-6"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#fetch-step_size"><i class="fa fa-check"></i><b>7.2</b> Fetch <code>step_size</code></a></li>
<li class="chapter" data-level="7.3" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state-inside-the-leader"><i class="fa fa-check"></i><b>7.3</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>’s state inside the <code>Leader</code></a></li>
<li class="chapter" data-level="7.4" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state"><i class="fa fa-check"></i><b>7.4</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>’s state</a></li>
<li class="chapter" data-level="7.5" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#calculate-quantity"><i class="fa fa-check"></i><b>7.5</b> Calculate quantity</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#iex-testing-2"><i class="fa fa-check"></i><b>7.5.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html"><i class="fa fa-check"></i><b>8</b> Add support for multiple transactions per order</a>
<ul>
<li class="chapter" data-level="8.1" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#objectives-7"><i class="fa fa-check"></i><b>8.1</b> Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#the-issue-with-the-current-implementation"><i class="fa fa-check"></i><b>8.2</b> The issue with the current implementation</a></li>
<li class="chapter" data-level="8.3" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.3</b> Improve buy order filled callback</a></li>
<li class="chapter" data-level="8.4" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#implement-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.4</b> Implement buy order “filled” callback</a></li>
<li class="chapter" data-level="8.5" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-sell-order-callback"><i class="fa fa-check"></i><b>8.5</b> Improve sell order callback</a></li>
<li class="chapter" data-level="8.6" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#test-the-implementation-1"><i class="fa fa-check"></i><b>8.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html"><i class="fa fa-check"></i><b>9</b> Run multiple traders in parallel</a>
<ul>
<li class="chapter" data-level="9.1" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#objectives-8"><i class="fa fa-check"></i><b>9.1</b> Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#describe-and-design-the-required-functionality"><i class="fa fa-check"></i><b>9.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="9.3" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-inside-naive.trader"><i class="fa fa-check"></i><b>9.3</b> Implement rebuy inside <code>Naive.Trader</code></a></li>
<li class="chapter" data-level="9.4" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-in-the-naive.leader"><i class="fa fa-check"></i><b>9.4</b> Implement rebuy in the <code>Naive.Leader</code></a></li>
<li class="chapter" data-level="9.5" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#improve-logs-by-assigning-ids-to-traders"><i class="fa fa-check"></i><b>9.5</b> Improve logs by assigning ids to traders</a></li>
<li class="chapter" data-level="9.6" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#test-the-implementation-2"><i class="fa fa-check"></i><b>9.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html"><i class="fa fa-check"></i><b>10</b> Fine-tune trading strategy per symbol</a>
<ul>
<li class="chapter" data-level="10.1" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#objectives-9"><i class="fa fa-check"></i><b>10.1</b> Objectives</a></li>
<li class="chapter" data-level="10.2" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#describe-and-design-the-required-functionality-1"><i class="fa fa-check"></i><b>10.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="10.3" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#add-docker-to-project"><i class="fa fa-check"></i><b>10.3</b> Add docker to project</a></li>
<li class="chapter" data-level="10.4" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#set-up-ecto-inside-the-naive-app"><i class="fa fa-check"></i><b>10.4</b> Set up <code>ecto</code> inside the <code>naive</code> app</a></li>
<li class="chapter" data-level="10.5" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#create-and-migrate-the-db"><i class="fa fa-check"></i><b>10.5</b> Create and migrate the DB</a></li>
<li class="chapter" data-level="10.6" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#seed-symbols-settings"><i class="fa fa-check"></i><b>10.6</b> Seed symbols’ settings</a></li>
<li class="chapter" data-level="10.7" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#update-the-naive.leader-to-fetch-settings"><i class="fa fa-check"></i><b>10.7</b> Update the <code>Naive.Leader</code> to fetch settings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html"><i class="fa fa-check"></i><b>11</b> Supervise and autostart streaming</a>
<ul>
<li class="chapter" data-level="11.1" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#objectives-10"><i class="fa fa-check"></i><b>11.1</b> Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#describe-and-design-the-required-functionality-2"><i class="fa fa-check"></i><b>11.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="11.3" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#register-the-streamer.binance-processes-with-names"><i class="fa fa-check"></i><b>11.3</b> Register the <code>Streamer.Binance</code> processes with names</a></li>
<li class="chapter" data-level="11.4" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#set-up-ecto-inside-the-streamer-app"><i class="fa fa-check"></i><b>11.4</b> Set up <code>ecto</code> inside the <code>streamer</code> app</a></li>
<li class="chapter" data-level="11.5" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#create-and-migrate-the-db-1"><i class="fa fa-check"></i><b>11.5</b> Create and migrate the db</a></li>
<li class="chapter" data-level="11.6" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#seed-default-settings"><i class="fa fa-check"></i><b>11.6</b> Seed default settings</a></li>
<li class="chapter" data-level="11.7" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-supervision-tree-and-start-streaming-functionality"><i class="fa fa-check"></i><b>11.7</b> Implement the supervision tree and start streaming functionality</a></li>
<li class="chapter" data-level="11.8" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-stop-functionality"><i class="fa fa-check"></i><b>11.8</b> Implement the stop functionality</a></li>
<li class="chapter" data-level="11.9" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-autostart-streaming-functionality"><i class="fa fa-check"></i><b>11.9</b> Implement the autostart streaming functionality</a></li>
<li class="chapter" data-level="11.10" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#test-the-implementation-3"><i class="fa fa-check"></i><b>11.10</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html"><i class="fa fa-check"></i><b>12</b> Start, stop, shutdown and autostart trading</a>
<ul>
<li class="chapter" data-level="12.1" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#objectives-11"><i class="fa fa-check"></i><b>12.1</b> Objectives</a></li>
<li class="chapter" data-level="12.2" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#describe-and-design-the-required-functionality-3"><i class="fa fa-check"></i><b>12.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="12.3" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#re-implement-the-start-trading-functionality"><i class="fa fa-check"></i><b>12.3</b> (Re-)Implement the start trading functionality</a></li>
<li class="chapter" data-level="12.4" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-stop-trading-functionality"><i class="fa fa-check"></i><b>12.4</b> Implement the stop trading functionality</a></li>
<li class="chapter" data-level="12.5" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-autostart-trading-functionality"><i class="fa fa-check"></i><b>12.5</b> Implement the autostart trading functionality</a></li>
<li class="chapter" data-level="12.6" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-shutdown-trading-functionality"><i class="fa fa-check"></i><b>12.6</b> Implement the shutdown trading functionality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html"><i class="fa fa-check"></i><b>13</b> Abstract duplicated supervision code</a>
<ul>
<li class="chapter" data-level="13.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#objectives-12"><i class="fa fa-check"></i><b>13.1</b> Objectives</a></li>
<li class="chapter" data-level="13.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#overview-of-requirements"><i class="fa fa-check"></i><b>13.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="13.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#pseudo-generalize-core.servicesupervisor-module"><i class="fa fa-check"></i><b>13.3</b> Pseudo generalize Core.ServiceSupervisor module</a></li>
<li class="chapter" data-level="13.4" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#utilize-pseudo-generalized-code-inside-the-naive-dynamicsymbolsupervisor"><i class="fa fa-check"></i><b>13.4</b> Utilize pseudo generalized code inside the Naive DynamicSymbolSupervisor</a></li>
<li class="chapter" data-level="13.5" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#implement-a-truly-generic-core.servicesupervisor"><i class="fa fa-check"></i><b>13.5</b> Implement a truly generic <code>Core.ServiceSupervisor</code></a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#first-path-starting-with-the-fetch_symbols_to_start0-function"><i class="fa fa-check"></i><b>13.5.1</b> First path starting with the <code>fetch_symbols_to_start/0</code> function</a></li>
<li class="chapter" data-level="13.5.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#second-path-starting-with-the-update_status2"><i class="fa fa-check"></i><b>13.5.2</b> Second path starting with the <code>update_status/2</code></a></li>
<li class="chapter" data-level="13.5.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#third-path-starting-with-the-get_pid1-function"><i class="fa fa-check"></i><b>13.5.3</b> Third path starting with the <code>get_pid/1</code> function</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#remove-boilerplate-using-use-macro"><i class="fa fa-check"></i><b>13.6</b> Remove boilerplate using <code>use</code> macro</a></li>
<li class="chapter" data-level="13.7" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#use-the-core.servicesupervisor-module-inside-the-streamer-application"><i class="fa fa-check"></i><b>13.7</b> Use the <code>Core.ServiceSupervisor</code> module inside the <code>streamer</code> application</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html"><i class="fa fa-check"></i><b>14</b> Store trade events and orders inside the database</a>
<ul>
<li class="chapter" data-level="14.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#objectives-13"><i class="fa fa-check"></i><b>14.1</b> Objectives</a></li>
<li class="chapter" data-level="14.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#overview-of-requirements-1"><i class="fa fa-check"></i><b>14.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="14.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-data_warehouse-application-in-the-umbrella"><i class="fa fa-check"></i><b>14.3</b> Create a new <code>data_warehouse</code> application in the umbrella</a></li>
<li class="chapter" data-level="14.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#connect-to-the-database-using-ecto"><i class="fa fa-check"></i><b>14.4</b> Connect to the database using Ecto</a></li>
<li class="chapter" data-level="14.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-trade-events-data"><i class="fa fa-check"></i><b>14.5</b> Store trade events’ data</a></li>
<li class="chapter" data-level="14.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-orders-data"><i class="fa fa-check"></i><b>14.6</b> Store orders’ data</a></li>
<li class="chapter" data-level="14.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#implement-supervision"><i class="fa fa-check"></i><b>14.7</b> Implement supervision</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-subscriber_settings-table"><i class="fa fa-check"></i><b>14.7.1</b> Create <code>subscriber_settings</code> table</a></li>
<li class="chapter" data-level="14.7.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#redesign-supervision-using-registry"><i class="fa fa-check"></i><b>14.7.2</b> Redesign supervision using Registry</a></li>
<li class="chapter" data-level="14.7.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-the-datawarehouse.subscriber.dynamicsupervisor-module"><i class="fa fa-check"></i><b>14.7.3</b> Create the <code>DataWarehouse.Subscriber.DynamicSupervisor</code> module</a></li>
<li class="chapter" data-level="14.7.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#register-worker-processes-using-via"><i class="fa fa-check"></i><b>14.7.4</b> Register Worker processes using :via</a></li>
<li class="chapter" data-level="14.7.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-supervision-level-for-registry-task-and-the-dynamicsupervisor"><i class="fa fa-check"></i><b>14.7.5</b> Create a new supervision level for Registry, Task and the DynamicSupervisor</a></li>
<li class="chapter" data-level="14.7.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#link-the-subscribersupervisor-to-the-application"><i class="fa fa-check"></i><b>14.7.6</b> Link the <code>SubscriberSupervisor</code> to the <code>Application</code></a></li>
<li class="chapter" data-level="14.7.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#add-interface"><i class="fa fa-check"></i><b>14.7.7</b> Add interface</a></li>
<li class="chapter" data-level="14.7.8" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#test"><i class="fa fa-check"></i><b>14.7.8</b> Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html"><i class="fa fa-check"></i><b>15</b> Backtest trading strategy</a>
<ul>
<li class="chapter" data-level="15.1" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#objectives-14"><i class="fa fa-check"></i><b>15.1</b> Objectives</a></li>
<li class="chapter" data-level="15.2" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#overview-of-requirements-2"><i class="fa fa-check"></i><b>15.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="15.3" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#implement-the-storing-task"><i class="fa fa-check"></i><b>15.3</b> Implement the storing task</a></li>
<li class="chapter" data-level="15.4" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#test-the-backtesting"><i class="fa fa-check"></i><b>15.4</b> Test the backtesting</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html"><i class="fa fa-check"></i><b>16</b> End-to-end testing</a>
<ul>
<li class="chapter" data-level="16.1" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#objectives-15"><i class="fa fa-check"></i><b>16.1</b> Objectives</a></li>
<li class="chapter" data-level="16.2" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#decide-on-the-tested-functionality"><i class="fa fa-check"></i><b>16.2</b> Decide on the tested functionality</a></li>
<li class="chapter" data-level="16.3" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#implement-basic-test"><i class="fa fa-check"></i><b>16.3</b> Implement basic test</a></li>
<li class="chapter" data-level="16.4" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#introduce-environment-based-config-files"><i class="fa fa-check"></i><b>16.4</b> Introduce environment based config files</a></li>
<li class="chapter" data-level="16.5" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#add-convenience-aliases"><i class="fa fa-check"></i><b>16.5</b> Add convenience aliases</a></li>
<li class="chapter" data-level="16.6" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#cache-initial-seed-data-inside-a-file"><i class="fa fa-check"></i><b>16.6</b> Cache initial seed data inside a file</a></li>
<li class="chapter" data-level="16.7" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#update-seeding-scripts-to-use-the-binancemock"><i class="fa fa-check"></i><b>16.7</b> Update seeding scripts to use the BinanceMock</a></li>
<li class="chapter" data-level="16.8" data-path="end-to-end-testing.html"><a href="end-to-end-testing.html#introduce-the-core-application"><i class="fa fa-check"></i><b>16.8</b> Introduce the Core application</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="mox-rocks.html"><a href="mox-rocks.html"><i class="fa fa-check"></i><b>17</b> Mox rocks</a>
<ul>
<li class="chapter" data-level="17.1" data-path="mox-rocks.html"><a href="mox-rocks.html#objectives-16"><i class="fa fa-check"></i><b>17.1</b> Objectives</a></li>
<li class="chapter" data-level="17.2" data-path="mox-rocks.html"><a href="mox-rocks.html#introduction-to-mock-based-tests"><i class="fa fa-check"></i><b>17.2</b> Introduction to mock based tests</a></li>
<li class="chapter" data-level="17.3" data-path="mox-rocks.html"><a href="mox-rocks.html#add-the-mox-package"><i class="fa fa-check"></i><b>17.3</b> Add the <code>mox</code> package</a></li>
<li class="chapter" data-level="17.4" data-path="mox-rocks.html"><a href="mox-rocks.html#investigate-the-naive.trader-module"><i class="fa fa-check"></i><b>17.4</b> Investigate the <code>Naive.Trader</code> module</a>
<ul>
<li class="chapter" data-level="17.4.1" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-binance-module"><i class="fa fa-check"></i><b>17.4.1</b> Mock the <code>Binance</code> module</a></li>
<li class="chapter" data-level="17.4.2" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-naiveleader-module"><i class="fa fa-check"></i><b>17.4.2</b> Mock the <code>NaiveLeader</code> module</a></li>
<li class="chapter" data-level="17.4.3" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-phoenix.pubsub-module"><i class="fa fa-check"></i><b>17.4.3</b> Mock the <code>Phoenix.PubSub</code> module</a></li>
<li class="chapter" data-level="17.4.4" data-path="mox-rocks.html"><a href="mox-rocks.html#mock-the-logger-module"><i class="fa fa-check"></i><b>17.4.4</b> Mock the <code>Logger</code> module</a></li>
</ul></li>
<li class="chapter" data-level="17.5" data-path="mox-rocks.html"><a href="mox-rocks.html#implement-a-test-of-the-naive.trader-module"><i class="fa fa-check"></i><b>17.5</b> Implement a test of the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="17.6" data-path="mox-rocks.html"><a href="mox-rocks.html#define-an-alias-to-run-unit-tests"><i class="fa fa-check"></i><b>17.6</b> Define an alias to run unit tests</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="functional-elixir.html"><a href="functional-elixir.html"><i class="fa fa-check"></i><b>18</b> Functional Elixir</a>
<ul>
<li class="chapter" data-level="18.1" data-path="functional-elixir.html"><a href="functional-elixir.html#objectives-17"><i class="fa fa-check"></i><b>18.1</b> Objectives</a></li>
<li class="chapter" data-level="18.2" data-path="functional-elixir.html"><a href="functional-elixir.html#the-reasoning-behind-the-functional-approach"><i class="fa fa-check"></i><b>18.2</b> The reasoning behind the functional approach</a></li>
<li class="chapter" data-level="18.3" data-path="functional-elixir.html"><a href="functional-elixir.html#simplifying-by-splitting"><i class="fa fa-check"></i><b>18.3</b> Simplifying by splitting</a></li>
<li class="chapter" data-level="18.4" data-path="functional-elixir.html"><a href="functional-elixir.html#abstracting-the-pure-logic"><i class="fa fa-check"></i><b>18.4</b> Abstracting the “pure” logic</a>
<ul>
<li class="chapter" data-level="18.4.1" data-path="functional-elixir.html"><a href="functional-elixir.html#place-a-buy-order-rules"><i class="fa fa-check"></i><b>18.4.1</b> Place a buy order rules</a></li>
<li class="chapter" data-level="18.4.2" data-path="functional-elixir.html"><a href="functional-elixir.html#race-condition-rules"><i class="fa fa-check"></i><b>18.4.2</b> Race condition rules</a></li>
<li class="chapter" data-level="18.4.3" data-path="functional-elixir.html"><a href="functional-elixir.html#fetch-the-buy-order-rules"><i class="fa fa-check"></i><b>18.4.3</b> Fetch the buy order rules</a></li>
<li class="chapter" data-level="18.4.4" data-path="functional-elixir.html"><a href="functional-elixir.html#place-a-sell-order-rules"><i class="fa fa-check"></i><b>18.4.4</b> Place a sell order rules</a></li>
<li class="chapter" data-level="18.4.5" data-path="functional-elixir.html"><a href="functional-elixir.html#terminate-trader-rules"><i class="fa fa-check"></i><b>18.4.5</b> Terminate trader rules</a></li>
<li class="chapter" data-level="18.4.6" data-path="functional-elixir.html"><a href="functional-elixir.html#fetch-the-sell-order-rules"><i class="fa fa-check"></i><b>18.4.6</b> Fetch the sell order rules</a></li>
<li class="chapter" data-level="18.4.7" data-path="functional-elixir.html"><a href="functional-elixir.html#trigger-rebuy-rules"><i class="fa fa-check"></i><b>18.4.7</b> Trigger rebuy rules</a></li>
<li class="chapter" data-level="18.4.8" data-path="functional-elixir.html"><a href="functional-elixir.html#the-final-clause-rules"><i class="fa fa-check"></i><b>18.4.8</b> The final clause rules</a></li>
<li class="chapter" data-level="18.4.9" data-path="functional-elixir.html"><a href="functional-elixir.html#changes-to-the-naive.trader-module"><i class="fa fa-check"></i><b>18.4.9</b> Changes to the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="18.4.10" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---place-buy-order"><i class="fa fa-check"></i><b>18.4.10</b> <code>Naive.Trader</code> - place buy order</a></li>
<li class="chapter" data-level="18.4.11" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---race-condition-clause"><i class="fa fa-check"></i><b>18.4.11</b> <code>Naive.Trader</code> - Race condition clause</a></li>
<li class="chapter" data-level="18.4.12" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---place-a-sell-order"><i class="fa fa-check"></i><b>18.4.12</b> <code>Naive.Trader</code> - Place a sell order</a></li>
<li class="chapter" data-level="18.4.13" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---fetch-the-buy-order"><i class="fa fa-check"></i><b>18.4.13</b> <code>Naive.Trader</code> - Fetch the buy order</a></li>
<li class="chapter" data-level="18.4.14" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---terminate-the-trader"><i class="fa fa-check"></i><b>18.4.14</b> <code>Naive.Trader</code> - Terminate the trader</a></li>
<li class="chapter" data-level="18.4.15" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---fetch-the-sell-order"><i class="fa fa-check"></i><b>18.4.15</b> <code>Naive.Trader</code> - Fetch the sell order</a></li>
<li class="chapter" data-level="18.4.16" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---triggering-rebuy"><i class="fa fa-check"></i><b>18.4.16</b> <code>Naive.Trader</code> - Triggering rebuy</a></li>
<li class="chapter" data-level="18.4.17" data-path="functional-elixir.html"><a href="functional-elixir.html#naive.trader---the-final-ignore-clause"><i class="fa fa-check"></i><b>18.4.17</b> <code>Naive.Trader</code> - The final ignore clause</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="functional-elixir.html"><a href="functional-elixir.html#dealing-with-dirty-code"><i class="fa fa-check"></i><b>18.5</b> Dealing with dirty code</a></li>
<li class="chapter" data-level="18.6" data-path="functional-elixir.html"><a href="functional-elixir.html#making-dirty-code-testable"><i class="fa fa-check"></i><b>18.6</b> Making dirty code testable</a>
<ul>
<li class="chapter" data-level="18.6.1" data-path="functional-elixir.html"><a href="functional-elixir.html#passing-functions-arguments"><i class="fa fa-check"></i><b>18.6.1</b> Passing functions arguments</a></li>
<li class="chapter" data-level="18.6.2" data-path="functional-elixir.html"><a href="functional-elixir.html#passing-grouped-functions-as-a-context"><i class="fa fa-check"></i><b>18.6.2</b> Passing grouped functions as a context</a></li>
<li class="chapter" data-level="18.6.3" data-path="functional-elixir.html"><a href="functional-elixir.html#passing-grouped-modules-as-a-context"><i class="fa fa-check"></i><b>18.6.3</b> Passing grouped modules as a context</a></li>
<li class="chapter" data-level="18.6.4" data-path="functional-elixir.html"><a href="functional-elixir.html#injecting-modules-to-modules-attributes-based-on-the-configuration"><i class="fa fa-check"></i><b>18.6.4</b> Injecting modules to module’s attributes based on the configuration</a></li>
</ul></li>
<li class="chapter" data-level="18.7" data-path="functional-elixir.html"><a href="functional-elixir.html#the-power-with-in"><i class="fa fa-check"></i><b>18.7</b> The power <code>with</code>-in</a>
<ul>
<li class="chapter" data-level="18.7.1" data-path="functional-elixir.html"><a href="functional-elixir.html#idiomatic-error-handling"><i class="fa fa-check"></i><b>18.7.1</b> Idiomatic error handling</a></li>
</ul></li>
<li class="chapter" data-level="18.8" data-path="functional-elixir.html"><a href="functional-elixir.html#do-or-not-to-do"><i class="fa fa-check"></i><b>18.8</b> Do or not to do</a></li>
<li class="chapter" data-level="18.9" data-path="functional-elixir.html"><a href="functional-elixir.html#final-thoughts"><i class="fa fa-check"></i><b>18.9</b> Final thoughts</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html"><i class="fa fa-check"></i><b>19</b> Idiomatic OTP</a>
<ul>
<li class="chapter" data-level="19.1" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#objectives-18"><i class="fa fa-check"></i><b>19.1</b> Objectives</a></li>
<li class="chapter" data-level="19.2" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#the-concept"><i class="fa fa-check"></i><b>19.2</b> The concept</a></li>
<li class="chapter" data-level="19.3" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#initial-implementation"><i class="fa fa-check"></i><b>19.3</b> Initial implementation</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#maybe-functions"><i class="fa fa-check"></i><b>19.3.1</b> Maybe functions</a></li>
<li class="chapter" data-level="19.3.2" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#testing"><i class="fa fa-check"></i><b>19.3.2</b> Testing</a></li>
<li class="chapter" data-level="19.3.3" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#supervision"><i class="fa fa-check"></i><b>19.3.3</b> Supervision</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="idiomatic-otp.html"><a href="idiomatic-otp.html#idiomatic-solution"><i class="fa fa-check"></i><b>19.4</b> Idiomatic solution</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html"><i class="fa fa-check"></i><b>20</b> Idiomatic trading strategy</a>
<ul>
<li class="chapter" data-level="20.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#objectives-19"><i class="fa fa-check"></i><b>20.1</b> Objectives</a></li>
<li class="chapter" data-level="20.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#following-the-ohlc-footsteps"><i class="fa fa-check"></i><b>20.2</b> Following the OHLC footsteps</a></li>
<li class="chapter" data-level="20.3" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#simplifying-the-naive-supervision-tree"><i class="fa fa-check"></i><b>20.3</b> Simplifying the Naive supervision tree</a>
<ul>
<li class="chapter" data-level="20.3.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive.dynamictradersupervisor-module"><i class="fa fa-check"></i><b>20.3.1</b> The <code>Naive.DynamicTraderSupervisor</code> module</a></li>
<li class="chapter" data-level="20.3.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive-module"><i class="fa fa-check"></i><b>20.3.2</b> The <code>Naive</code> module</a></li>
<li class="chapter" data-level="20.3.3" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive.supervisor-module"><i class="fa fa-check"></i><b>20.3.3</b> The <code>Naive.Supervisor</code> module</a></li>
<li class="chapter" data-level="20.3.4" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#the-naive.trader-module"><i class="fa fa-check"></i><b>20.3.4</b> The <code>Naive.Trader</code> module</a></li>
</ul></li>
<li class="chapter" data-level="20.4" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#supporting-multiple-positions"><i class="fa fa-check"></i><b>20.4</b> Supporting multiple positions</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#initialization"><i class="fa fa-check"></i><b>20.4.1</b> Initialization</a></li>
<li class="chapter" data-level="20.4.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#parallelising-the-strategy"><i class="fa fa-check"></i><b>20.4.2</b> Parallelising the strategy</a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#retrofitting-the-shutdown-functionality"><i class="fa fa-check"></i><b>20.5</b> Retrofitting the “shutdown” functionality</a>
<ul>
<li class="chapter" data-level="20.5.1" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#handling-updated-settings"><i class="fa fa-check"></i><b>20.5.1</b> Handling updated settings</a></li>
<li class="chapter" data-level="20.5.2" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#updating-the-naive.strategy-to-honour-the-shutdown-state"><i class="fa fa-check"></i><b>20.5.2</b> Updating the <code>Naive.Strategy</code> to honour the “shutdown” state</a></li>
</ul></li>
<li class="chapter" data-level="20.6" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#updating-the-strategy-to-handle-rebuys"><i class="fa fa-check"></i><b>20.6</b> Updating the Strategy to handle rebuys</a></li>
<li class="chapter" data-level="20.7" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#fetching-active-positions"><i class="fa fa-check"></i><b>20.7</b> Fetching active positions</a></li>
<li class="chapter" data-level="20.8" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#tidying-up"><i class="fa fa-check"></i><b>20.8</b> Tidying up</a></li>
<li class="chapter" data-level="20.9" data-path="idiomatic-trading-strategy.html"><a href="idiomatic-trading-strategy.html#final-thoughts-1"><i class="fa fa-check"></i><b>20.9</b> Final thoughts</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html"><i class="fa fa-check"></i><b>21</b> Layers of abstraction</a>
<ul>
<li class="chapter" data-level="21.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#objectives-20"><i class="fa fa-check"></i><b>21.1</b> Objectives</a></li>
<li class="chapter" data-level="21.2" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#admitting-the-simplification"><i class="fa fa-check"></i><b>21.2</b> Admitting the simplification</a></li>
<li class="chapter" data-level="21.3" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#abstracting-the-exchange"><i class="fa fa-check"></i><b>21.3</b> Abstracting the exchange</a>
<ul>
<li class="chapter" data-level="21.3.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#defining-the-core.exchange-behaviour"><i class="fa fa-check"></i><b>21.3.1</b> Defining the <code>Core.Exchange</code> behaviour</a></li>
<li class="chapter" data-level="21.3.2" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#implementation-of-the-core.exchange.binance-module"><i class="fa fa-check"></i><b>21.3.2</b> Implementation of the <code>Core.Exchange.Binance</code> module</a></li>
<li class="chapter" data-level="21.3.3" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-binancemock-module-to-implement-the-core.exchange-behaviour"><i class="fa fa-check"></i><b>21.3.3</b> Updating the <code>BinanceMock</code> module to implement the <code>Core.Exchange</code> behaviour</a></li>
<li class="chapter" data-level="21.3.4" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-naive.strategy"><i class="fa fa-check"></i><b>21.3.4</b> Updating the <code>Naive.Strategy</code></a></li>
<li class="chapter" data-level="21.3.5" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-seed-scripts"><i class="fa fa-check"></i><b>21.3.5</b> Updating the seed scripts</a></li>
<li class="chapter" data-level="21.3.6" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#manual-testing-after-the-refactoring"><i class="fa fa-check"></i><b>21.3.6</b> Manual testing after the refactoring</a></li>
<li class="chapter" data-level="21.3.7" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#storing-the-data"><i class="fa fa-check"></i><b>21.3.7</b> Storing the data</a></li>
<li class="chapter" data-level="21.3.8" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#the-mox-approach-summary"><i class="fa fa-check"></i><b>21.3.8</b> The <code>Mox</code> approach summary</a></li>
</ul></li>
<li class="chapter" data-level="21.4" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#mimicking-the-reality"><i class="fa fa-check"></i><b>21.4</b> Mimicking the reality</a>
<ul>
<li class="chapter" data-level="21.4.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#updating-the-naive.strategy-1"><i class="fa fa-check"></i><b>21.4.1</b> Updating the <code>Naive.Strategy</code></a></li>
<li class="chapter" data-level="21.4.2" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#testing-the-naive.strategy"><i class="fa fa-check"></i><b>21.4.2</b> Testing the <code>Naive.Strategy</code></a></li>
<li class="chapter" data-level="21.4.3" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#logging-elephant-in-the-room"><i class="fa fa-check"></i><b>21.4.3</b> Logging elephant in the room</a></li>
</ul></li>
<li class="chapter" data-level="21.5" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#swapping-back-to-attributes"><i class="fa fa-check"></i><b>21.5</b> Swapping back to attributes</a>
<ul>
<li class="chapter" data-level="21.5.1" data-path="layers-of-abstraction.html"><a href="layers-of-abstraction.html#config-files"><i class="fa fa-check"></i><b>21.5.1</b> Config files</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="win-with-pure-logic.html"><a href="win-with-pure-logic.html"><i class="fa fa-check"></i><b>22</b> 80/20 win with pure logic</a>
<ul>
<li class="chapter" data-level="22.1" data-path="win-with-pure-logic.html"><a href="win-with-pure-logic.html#objectives-21"><i class="fa fa-check"></i><b>22.1</b> Objectives</a></li>
<li class="chapter" data-level="22.2" data-path="win-with-pure-logic.html"><a href="win-with-pure-logic.html#testing-the-pure-logic"><i class="fa fa-check"></i><b>22.2</b> Testing the pure logic</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html"><i class="fa fa-check"></i><b>23</b> Back to the Monolith</a>
<ul>
<li class="chapter" data-level="23.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#objectives-22"><i class="fa fa-check"></i><b>23.1</b> Objectives</a></li>
<li class="chapter" data-level="23.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reverting-the-course-to-the-monolith"><i class="fa fa-check"></i><b>23.2</b> Reverting the course to the monolith</a></li>
<li class="chapter" data-level="23.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#creating-a-new-phoenix-app"><i class="fa fa-check"></i><b>23.3</b> Creating a new Phoenix app</a></li>
<li class="chapter" data-level="23.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-core-app"><i class="fa fa-check"></i><b>23.4</b> Reintegrating the <code>core</code> app</a></li>
<li class="chapter" data-level="23.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-binance_mock-app"><i class="fa fa-check"></i><b>23.5</b> Reintegrating the <code>binance_mock</code> app</a></li>
<li class="chapter" data-level="23.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-streamer-app"><i class="fa fa-check"></i><b>23.6</b> Reintegrating the <code>streamer</code> app</a>
<ul>
<li class="chapter" data-level="23.6.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervisor"><i class="fa fa-check"></i><b>23.6.1</b> Supervisor</a></li>
<li class="chapter" data-level="23.6.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#worker"><i class="fa fa-check"></i><b>23.6.2</b> Worker</a></li>
<li class="chapter" data-level="23.6.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dynamicstreamersupervisor"><i class="fa fa-check"></i><b>23.6.3</b> DynamicStreamerSupervisor</a></li>
<li class="chapter" data-level="23.6.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#schemasettings.ex-and-schemastreaming_status_enum.ex"><i class="fa fa-check"></i><b>23.6.4</b> schema/settings.ex and schema/streaming_status_enum.ex</a></li>
<li class="chapter" data-level="23.6.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#application"><i class="fa fa-check"></i><b>23.6.5</b> application</a></li>
<li class="chapter" data-level="23.6.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#db-migrations-and-seeding"><i class="fa fa-check"></i><b>23.6.6</b> DB migrations and seeding</a></li>
<li class="chapter" data-level="23.6.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#config"><i class="fa fa-check"></i><b>23.6.7</b> Config</a></li>
<li class="chapter" data-level="23.6.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#deps"><i class="fa fa-check"></i><b>23.6.8</b> Deps</a></li>
</ul></li>
<li class="chapter" data-level="23.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-naive-app"><i class="fa fa-check"></i><b>23.7</b> Reintegrating the <code>naive</code> app</a>
<ul>
<li class="chapter" data-level="23.7.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#naive.ex"><i class="fa fa-check"></i><b>23.7.1</b> naive.ex</a></li>
<li class="chapter" data-level="23.7.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#strategy.ex---formula.ex"><i class="fa fa-check"></i><b>23.7.2</b> strategy.ex -&gt; formula.ex</a></li>
<li class="chapter" data-level="23.7.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#trader.ex"><i class="fa fa-check"></i><b>23.7.3</b> <code>trader.ex</code></a></li>
<li class="chapter" data-level="23.7.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervisor.ex"><i class="fa fa-check"></i><b>23.7.4</b> <code>supervisor.ex</code></a></li>
<li class="chapter" data-level="23.7.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dynamic_trader_supervisor.ex"><i class="fa fa-check"></i><b>23.7.5</b> <code>dynamic_trader_supervisor.ex</code></a></li>
<li class="chapter" data-level="23.7.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#repo-and-schema-files"><i class="fa fa-check"></i><b>23.7.6</b> Repo and <code>schema</code> files</a></li>
<li class="chapter" data-level="23.7.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#application.ex"><i class="fa fa-check"></i><b>23.7.7</b> <code>application.ex</code></a></li>
<li class="chapter" data-level="23.7.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#migration-and-seeding"><i class="fa fa-check"></i><b>23.7.8</b> Migration and seeding</a></li>
<li class="chapter" data-level="23.7.9" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#configuration"><i class="fa fa-check"></i><b>23.7.9</b> Configuration</a></li>
<li class="chapter" data-level="23.7.10" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#tests"><i class="fa fa-check"></i><b>23.7.10</b> Tests</a></li>
<li class="chapter" data-level="23.7.11" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dependencies"><i class="fa fa-check"></i><b>23.7.11</b> Dependencies</a></li>
</ul></li>
<li class="chapter" data-level="23.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-data_warehouse-app"><i class="fa fa-check"></i><b>23.8</b> Reintegrating the <code>data_warehouse</code> app</a>
<ul>
<li class="chapter" data-level="23.8.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#exchangeorder.ex"><i class="fa fa-check"></i><b>23.8.1</b> <code>exchange/order.ex</code></a></li>
<li class="chapter" data-level="23.8.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#exchangetrade_event.ex"><i class="fa fa-check"></i><b>23.8.2</b> <code>exchange/trade_event.ex</code></a></li>
<li class="chapter" data-level="23.8.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datapublisher.ex"><i class="fa fa-check"></i><b>23.8.3</b> <code>data/publisher.ex</code></a></li>
<li class="chapter" data-level="23.8.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollector.ex"><i class="fa fa-check"></i><b>23.8.4</b> <code>data/collector.ex</code></a></li>
<li class="chapter" data-level="23.8.5" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorcollector_supervisor.ex"><i class="fa fa-check"></i><b>23.8.5</b> <code>data/collector/collector_supervisor.ex</code></a></li>
<li class="chapter" data-level="23.8.6" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectordynamic_worker_supervisor.ex"><i class="fa fa-check"></i><b>23.8.6</b> <code>/data/collector/dynamic_worker_supervisor.ex</code></a></li>
<li class="chapter" data-level="23.8.7" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorsettings_status_enum.ex"><i class="fa fa-check"></i><b>23.8.7</b> <code>/data/collector/settings_status_enum.ex</code></a></li>
<li class="chapter" data-level="23.8.8" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorsettings.ex"><i class="fa fa-check"></i><b>23.8.8</b> <code>/data/collector/settings.ex</code></a></li>
<li class="chapter" data-level="23.8.9" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#datacollectorworker.ex"><i class="fa fa-check"></i><b>23.8.9</b> <code>/data/collector/worker.ex</code></a></li>
<li class="chapter" data-level="23.8.10" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervision-tree"><i class="fa fa-check"></i><b>23.8.10</b> Supervision tree</a></li>
<li class="chapter" data-level="23.8.11" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#migrations"><i class="fa fa-check"></i><b>23.8.11</b> Migrations</a></li>
</ul></li>
<li class="chapter" data-level="23.9" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#reintegrating-the-indicator-app"><i class="fa fa-check"></i><b>23.9</b> Reintegrating the <code>indicator</code> app</a>
<ul>
<li class="chapter" data-level="23.9.1" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dataaggregator.ex"><i class="fa fa-check"></i><b>23.9.1</b> /data/aggregator.ex</a></li>
<li class="chapter" data-level="23.9.2" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dataaggregatorohlc.ex"><i class="fa fa-check"></i><b>23.9.2</b> /data/aggregator/ohlc.ex</a></li>
<li class="chapter" data-level="23.9.3" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#dataaggregatorohlcworker.ex"><i class="fa fa-check"></i><b>23.9.3</b> /data/aggregator/ohlc/worker.ex</a></li>
<li class="chapter" data-level="23.9.4" data-path="back-to-the-monolith.html"><a href="back-to-the-monolith.html#supervision-tree-1"><i class="fa fa-check"></i><b>23.9.4</b> Supervision tree</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.bookdown.org/" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Hands-on Elixir &amp; OTP: Cryptocurrency trading bot</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="back-to-the-monolith" class="section level1 hasAnchor" number="23">
<h1><span class="header-section-number">Chapter 23</span> Back to the Monolith<a href="back-to-the-monolith.html#back-to-the-monolith" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="objectives-22" class="section level2 hasAnchor" number="23.1">
<h2><span class="header-section-number">23.1</span> Objectives<a href="back-to-the-monolith.html#objectives-22" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ul>
<li>reverting the course to the monolith</li>
<li>creating a new Phoenix app</li>
<li>reintegrating the <code>core</code> app</li>
<li>reintegrating the <code>binance_mock</code> app</li>
<li>reintegrating the <code>streamer</code> app</li>
<li>reintegrating the <code>naive</code> app</li>
<li>reintegrating the <code>data_warehouse</code> app</li>
<li>reintegrating the <code>indicator</code> app</li>
</ul>
</div>
<div id="reverting-the-course-to-the-monolith" class="section level2 hasAnchor" number="23.2">
<h2><span class="header-section-number">23.2</span> Reverting the course to the monolith<a href="back-to-the-monolith.html#reverting-the-course-to-the-monolith" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We started our journey with the idea that we would use an umbrella to “future-proof” our project in case we would migrate to microservices architecture.</p>
<p>As we delved deeper into our project(which also included me gaining more knowledge and experience over three years of writing this book), we began to see that the umbrella approach was, at best, an example of overengineering.</p>
<p>Looking back, the umbrella approach introduced significant complexity, a factor that became increasingly difficult to justify as our understanding of the project evolved.</p>
<p>For example, each umbrella app has its configuration, which resulted in using multiple databases and duplicated settings for things like the Binance client, making our deployment unnecessarily expensive and complex.</p>
<p>In this chapter, we will simplify the whole project by ditching the umbrella and migrating to Phoenix, which will be instrumental in our next steps, including deployment and clustering.</p>
</div>
<div id="creating-a-new-phoenix-app" class="section level2 hasAnchor" number="23.3">
<h2><span class="header-section-number">23.3</span> Creating a new Phoenix app<a href="back-to-the-monolith.html#creating-a-new-phoenix-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Instead of improving the existing structure, we will start from scratch. We will create a new Phoenix project side-by-side next to the current umbrella app, and then we will reintegrate each nested app one after another.</p>
<p>First, let’s make sure that we have the latest version of the Phoenix application generator installed:</p>
<pre><code>$ mix archive.install hex phx_new</code></pre>
<p>Note: At the time of writing this chapter, the current version of the Phoenix framework is 1.7.12.</p>
<p>With this taken care of, we can progress with the creation of a new Phoenix application and a database:</p>
<pre><code>$ mix phx.new hedgehog
...
$ cd hedgehog
$ mix ecto.create</code></pre>
<p>With the Phoenix app skeleton in place, we can move on to reintegrating the umbrella apps’ contents into it.</p>
</div>
<div id="reintegrating-the-core-app" class="section level2 hasAnchor" number="23.4">
<h2><span class="header-section-number">23.4</span> Reintegrating the <code>core</code> app<a href="back-to-the-monolith.html#reintegrating-the-core-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will start with the <code>core</code> app, as it is used/referenced by other apps in the umbrella.</p>
<p>It contains just a single module called <code>Core.Struct.TradeEvent</code> (inside the <code>apps/core/lib/core/struct/trade_event.ex</code> file) which we will rename to <code>Hedgehog.Exchange.TradeEvent</code> inside the newly created Phoenix app (we need to create a new <code>exchange</code> directory inside the <code>/lib/hedgehog</code> and paste the updated <code>trade_event.ex</code> file inside).</p>
<p>Besides the <code>TradeEvent</code> module, the <code>core</code> application supervises the <code>PubSub</code> supervision tree. After a quick check inside the <code>/lib/hedgehog/application.ex</code> file, we can confirm that Phoenix already uses PubSub:</p>
<div class="sourceCode" id="cb549"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb549-1"><a href="back-to-the-monolith.html#cb549-1" tabindex="-1"></a>  <span class="co"># /lib/hedgehog/application.ex</span></span>
<span id="cb549-2"><a href="back-to-the-monolith.html#cb549-2" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb549-3"><a href="back-to-the-monolith.html#cb549-3" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb549-4"><a href="back-to-the-monolith.html#cb549-4" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span>, <span class="va">name:</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span><span class="fu">}</span>,</span>
<span id="cb549-5"><a href="back-to-the-monolith.html#cb549-5" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>Furthermore, the <code>phoenix_pubsub</code> dependency is already included in the <code>mix.lock</code> file, and its default backend is now <code>Phoenix.PubSub.PG2</code>(the adapter we have been explicitly specifying before).</p>
<p>The above change finishes merging the <code>core</code> app into our new Phoenix app. We should be able to run our app:</p>
<pre><code>$ iex -S mix phx.server
...
[info] Running HedgehogWeb.Endpoint with Bandit 1.4.2 at 127.0.0.1:4000 (http)
...
iex(1)&gt; alias Hedgehog.Exchange.TradeEvent
...
iex(2)&gt; %TradeEvent{}
%Hedgehog.Exchange.TradeEvent{
...
}</code></pre>
</div>
<div id="reintegrating-the-binance_mock-app" class="section level2 hasAnchor" number="23.5">
<h2><span class="header-section-number">23.5</span> Reintegrating the <code>binance_mock</code> app<a href="back-to-the-monolith.html#reintegrating-the-binance_mock-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>binance_mock</code> app is used by both the <code>naive</code> and <code>streamer</code> apps, so we will need to focus on it next.</p>
<p>First, we will find a new home for the cached exchange info file which was previously based in</p>
<p><code>/apps/binance_mock/test/assets/exchange_info.json</code>. We will create a new directory called <code>/priv/cache</code> where we will paste the <code>exchange_info.json</code> file.</p>
<p>Next, we will take care of configuration that was deciding should we use the cached exchange info file mentioned above - inside the new application it will look as follows:</p>
<div class="sourceCode" id="cb551"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb551-1"><a href="back-to-the-monolith.html#cb551-1" tabindex="-1"></a>  <span class="co"># /config/config.exs</span></span>
<span id="cb551-2"><a href="back-to-the-monolith.html#cb551-2" tabindex="-1"></a>config <span class="va">:hedgehog</span>,</span>
<span id="cb551-3"><a href="back-to-the-monolith.html#cb551-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb551-4"><a href="back-to-the-monolith.html#cb551-4" tabindex="-1"></a>  <span class="va">exchanges:</span> <span class="ot">[</span> <span class="co"># &lt;= added</span></span>
<span id="cb551-5"><a href="back-to-the-monolith.html#cb551-5" tabindex="-1"></a>    <span class="va">binance_mock:</span> <span class="ot">[</span> </span>
<span id="cb551-6"><a href="back-to-the-monolith.html#cb551-6" tabindex="-1"></a>      <span class="va">use_cached_exchange_info:</span> <span class="cn">true</span></span>
<span id="cb551-7"><a href="back-to-the-monolith.html#cb551-7" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb551-8"><a href="back-to-the-monolith.html#cb551-8" tabindex="-1"></a>  <span class="ot">]</span></span></code></pre></div>
<p>Moving on to the main file of interest - <code>apps/binance_mock/lib/binance_mock.ex</code>, which we will move to the <code>/lib/hedgehog/exchange</code> directory.</p>
<p>Inside the module, we need to apply the following changes:</p>
<ul>
<li>change the module name to <code>Hedgehog.Exchange.BinanceMock</code></li>
<li>update the alias to the <code>Core.Struct.TradeEvent</code> struct to be <code>Hedgehog.Exchange.TradeEvent</code></li>
<li>update references to the <code>Core.PubSub</code> with <code>Hedgehog.PubSub</code></li>
<li>extract to boolean config flag to a module’s attribute and use it inside the <code>get_exchange_info/0</code> function:</li>
</ul>
<div class="sourceCode" id="cb552"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb552-1"><a href="back-to-the-monolith.html#cb552-1" tabindex="-1"></a>  <span class="co"># /lib/hedgehog/exchange/binance_mock.ex</span></span>
<span id="cb552-2"><a href="back-to-the-monolith.html#cb552-2" tabindex="-1"></a>  <span class="ot">@use_cached_exchange_info</span> <span class="cn">Application</span><span class="op">.</span>compile_env!<span class="fu">(</span><span class="va">:hedgehog</span>, <span class="ot">[</span></span>
<span id="cb552-3"><a href="back-to-the-monolith.html#cb552-3" tabindex="-1"></a>                              <span class="va">:exchanges</span>,</span>
<span id="cb552-4"><a href="back-to-the-monolith.html#cb552-4" tabindex="-1"></a>                              <span class="va">:binance_mock</span>,</span>
<span id="cb552-5"><a href="back-to-the-monolith.html#cb552-5" tabindex="-1"></a>                              <span class="va">:use_cached_exchange_info</span></span>
<span id="cb552-6"><a href="back-to-the-monolith.html#cb552-6" tabindex="-1"></a>                            <span class="ot">]</span><span class="fu">)</span></span>
<span id="cb552-7"><a href="back-to-the-monolith.html#cb552-7" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb552-8"><a href="back-to-the-monolith.html#cb552-8" tabindex="-1"></a>  <span class="kw">def</span> get_exchange_info<span class="fu">()</span> <span class="kw">do</span></span>
<span id="cb552-9"><a href="back-to-the-monolith.html#cb552-9" tabindex="-1"></a>    <span class="kw">case</span> <span class="ot">@use_cached_exchange_info</span> <span class="kw">do</span></span>
<span id="cb552-10"><a href="back-to-the-monolith.html#cb552-10" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<ul>
<li>Update the <code>get_cached_exchange_info/0</code> function to point to the new location of the <code>exchange_info.json</code> file:</li>
</ul>
<div class="sourceCode" id="cb553"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb553-1"><a href="back-to-the-monolith.html#cb553-1" tabindex="-1"></a>  <span class="co"># /lib/hedgehog/exchange/binance_mock.ex    </span></span>
<span id="cb553-2"><a href="back-to-the-monolith.html#cb553-2" tabindex="-1"></a>  <span class="kw">defp</span> get_cached_exchange_info <span class="kw">do</span></span>
<span id="cb553-3"><a href="back-to-the-monolith.html#cb553-3" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:ok</span>, data<span class="fu">}</span> <span class="op">=</span></span>
<span id="cb553-4"><a href="back-to-the-monolith.html#cb553-4" tabindex="-1"></a>      <span class="cn">File</span><span class="op">.</span>cwd!<span class="fu">()</span></span>
<span id="cb553-5"><a href="back-to-the-monolith.html#cb553-5" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Path</span><span class="op">.</span>split<span class="fu">()</span></span>
<span id="cb553-6"><a href="back-to-the-monolith.html#cb553-6" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Kernel</span><span class="op">.++</span><span class="fu">(</span><span class="ot">[</span></span>
<span id="cb553-7"><a href="back-to-the-monolith.html#cb553-7" tabindex="-1"></a>        <span class="st">&quot;priv&quot;</span>,</span>
<span id="cb553-8"><a href="back-to-the-monolith.html#cb553-8" tabindex="-1"></a>        <span class="st">&quot;cache&quot;</span>,</span>
<span id="cb553-9"><a href="back-to-the-monolith.html#cb553-9" tabindex="-1"></a>        <span class="st">&quot;exchange_info.json&quot;</span></span>
<span id="cb553-10"><a href="back-to-the-monolith.html#cb553-10" tabindex="-1"></a>      <span class="ot">]</span><span class="fu">)</span></span>
<span id="cb553-11"><a href="back-to-the-monolith.html#cb553-11" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">Path</span><span class="op">.</span>join<span class="fu">()</span></span>
<span id="cb553-12"><a href="back-to-the-monolith.html#cb553-12" tabindex="-1"></a>      <span class="op">|&gt;</span> <span class="cn">File</span><span class="op">.</span>read<span class="fu">()</span></span>
<span id="cb553-13"><a href="back-to-the-monolith.html#cb553-13" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>That finishes our changes to the <code>Hedgehog.Exchange.BinanceMock</code> module which we need to add supervision tree of our application:</p>
<div class="sourceCode" id="cb554"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb554-1"><a href="back-to-the-monolith.html#cb554-1" tabindex="-1"></a>  <span class="co"># /lib/hedgehog/application.ex</span></span>
<span id="cb554-2"><a href="back-to-the-monolith.html#cb554-2" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>_type, _args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb554-3"><a href="back-to-the-monolith.html#cb554-3" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb554-4"><a href="back-to-the-monolith.html#cb554-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb554-5"><a href="back-to-the-monolith.html#cb554-5" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">BinanceMock</span></span>
<span id="cb554-6"><a href="back-to-the-monolith.html#cb554-6" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>The <code>Hedgehog.Exchange.BinanceMock</code> module depends on a few packages that we need to add to the <code>mix.exs</code> dependencies:</p>
<div class="sourceCode" id="cb555"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb555-1"><a href="back-to-the-monolith.html#cb555-1" tabindex="-1"></a>  <span class="co"># /mix.exs</span></span>
<span id="cb555-2"><a href="back-to-the-monolith.html#cb555-2" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb555-3"><a href="back-to-the-monolith.html#cb555-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb555-4"><a href="back-to-the-monolith.html#cb555-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb555-5"><a href="back-to-the-monolith.html#cb555-5" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:binance</span>, <span class="st">&quot;~&gt; 1.0&quot;</span><span class="fu">}</span>,</span>
<span id="cb555-6"><a href="back-to-the-monolith.html#cb555-6" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:decimal</span>, <span class="st">&quot;~&gt; 2.0&quot;</span><span class="fu">}</span>,</span>
<span id="cb555-7"><a href="back-to-the-monolith.html#cb555-7" tabindex="-1"></a>      <span class="op">...</span></span></code></pre></div>
<p>Please remember to run the <code>mix deps.get</code> before trying out our changes:</p>
<pre><code>$ iex -S mix phx.server
...
iex(1)&gt; alias Hedgehog.Exchange.BinanceMock
iex(2)&gt; Process.whereis(BinanceMock)
#PID&lt;...&gt;
iex(3)&gt; |&gt; Process.alive?()
true
iex(4)&gt; BinanceMock.get_exchange_info()
%{
  ...
}</code></pre>
<p>The above confirms that we now have a <code>BinanceMock</code> process running in the background and we are able to fetch exchange info.</p>
</div>
<div id="reintegrating-the-streamer-app" class="section level2 hasAnchor" number="23.6">
<h2><span class="header-section-number">23.6</span> Reintegrating the <code>streamer</code> app<a href="back-to-the-monolith.html#reintegrating-the-streamer-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In the case of the <code>streamer</code> app, there are multiple files to move, so we will first create a new <code>/lib/hedgehog/streamer</code>(inside the new Phoenix app) directory and then copy both the <code>/apps/streamer/lib/streamer</code> directory and the <code>/apps/streamer/lib/streamer.ex</code> file into that new directory.</p>
<p>As we will be updating/renaming all of those files, we will use this opportunity to place all of them inside the <code>Binance</code> namespace.</p>
<p>We now need to modify each file starting with renaming <code>/lib/hedgehog/streamer/streamer.ex</code> to <code>/lib/hedgehog/streamer/binance.ex</code> and updating the module name and alias:</p>
<div class="sourceCode" id="cb557"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb557-1"><a href="back-to-the-monolith.html#cb557-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/binance.ex</span></span>
<span id="cb557-2"><a href="back-to-the-monolith.html#cb557-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span> <span class="kw">do</span></span>
<span id="cb557-3"><a href="back-to-the-monolith.html#cb557-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb557-4"><a href="back-to-the-monolith.html#cb557-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">DynamicStreamerSupervisor</span></span></code></pre></div>
<p>The next step will be to update the <code>/lib/hedgehog/streamer/streamer</code> directory to</p>
<p><code>/lib/hedgehog/streamer/binance</code>. We will now move on to the files inside this directory.</p>
<div id="supervisor" class="section level3 hasAnchor" number="23.6.1">
<h3><span class="header-section-number">23.6.1</span> Supervisor<a href="back-to-the-monolith.html#supervisor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Starting with the <code>supervisor.ex</code> file, we need to update the module’s name and alias:</p>
<div class="sourceCode" id="cb558"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb558-1"><a href="back-to-the-monolith.html#cb558-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/binance/supervisor.ex</span></span>
<span id="cb558-2"><a href="back-to-the-monolith.html#cb558-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">Supervisor</span> <span class="kw">do</span></span>
<span id="cb558-3"><a href="back-to-the-monolith.html#cb558-3" tabindex="-1"></a>   <span class="op">...</span></span>
<span id="cb558-4"><a href="back-to-the-monolith.html#cb558-4" tabindex="-1"></a>   <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">DynamicStreamerSupervisor</span></span></code></pre></div>
<p>Moving forward, we can remove the <code>repo.ex</code> file as we will use the <code>Hedgehog.Repo</code> module to work with the database.</p>
</div>
<div id="worker" class="section level3 hasAnchor" number="23.6.2">
<h3><span class="header-section-number">23.6.2</span> Worker<a href="back-to-the-monolith.html#worker" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we will rename the <code>/lib/hedgehog/streamer/binance/binance.ex</code> to</p>
<p><code>/lib/hedgehog/streamer/binance/worker.ex</code> - mainly to avoid “binance/binance” name after we added the namespace. Following the filename change, we need to update the module’s name and a couple of references to the <code>Core</code> module:</p>
<div class="sourceCode" id="cb559"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb559-1"><a href="back-to-the-monolith.html#cb559-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/binance/worker.ex</span></span>
<span id="cb559-2"><a href="back-to-the-monolith.html#cb559-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">Worker</span> <span class="kw">do</span></span>
<span id="cb559-3"><a href="back-to-the-monolith.html#cb559-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb559-4"><a href="back-to-the-monolith.html#cb559-4" tabindex="-1"></a>  <span class="kw">defp</span> process_event<span class="fu">(</span>%<span class="fu">{</span><span class="st">&quot;e&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;trade&quot;</span><span class="fu">}</span> <span class="op">=</span> event<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb559-5"><a href="back-to-the-monolith.html#cb559-5" tabindex="-1"></a>    trade_event <span class="op">=</span> %<span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span><span class="fu">{</span></span>
<span id="cb559-6"><a href="back-to-the-monolith.html#cb559-6" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb559-7"><a href="back-to-the-monolith.html#cb559-7" tabindex="-1"></a>    <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>broadcast<span class="fu">(</span></span>
<span id="cb559-8"><a href="back-to-the-monolith.html#cb559-8" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb559-9"><a href="back-to-the-monolith.html#cb559-9" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
</div>
<div id="dynamicstreamersupervisor" class="section level3 hasAnchor" number="23.6.3">
<h3><span class="header-section-number">23.6.3</span> DynamicStreamerSupervisor<a href="back-to-the-monolith.html#dynamicstreamersupervisor" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we will update the <code>dynamic_streamer_supervisor.ex</code>, where we will update the module’s name and all the aliases:</p>
<div class="sourceCode" id="cb560"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb560-1"><a href="back-to-the-monolith.html#cb560-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/binance/dynamic_streamer_supervisor.ex</span></span>
<span id="cb560-2"><a href="back-to-the-monolith.html#cb560-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">DynamicStreamerSupervisor</span> <span class="kw">do</span></span>
<span id="cb560-3"><a href="back-to-the-monolith.html#cb560-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb560-4"><a href="back-to-the-monolith.html#cb560-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb560-5"><a href="back-to-the-monolith.html#cb560-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">Worker</span></span>
<span id="cb560-6"><a href="back-to-the-monolith.html#cb560-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Settings</span></span>
<span id="cb560-7"><a href="back-to-the-monolith.html#cb560-7" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb560-8"><a href="back-to-the-monolith.html#cb560-8" tabindex="-1"></a>  <span class="kw">defp</span> start_child<span class="fu">(</span>args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb560-9"><a href="back-to-the-monolith.html#cb560-9" tabindex="-1"></a>    <span class="cn">DynamicSupervisor</span><span class="op">.</span>start_child<span class="fu">(</span></span>
<span id="cb560-10"><a href="back-to-the-monolith.html#cb560-10" tabindex="-1"></a>      <span class="cn">__MODULE__</span>,</span>
<span id="cb560-11"><a href="back-to-the-monolith.html#cb560-11" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">Worker</span>, args<span class="fu">}</span></span>
<span id="cb560-12"><a href="back-to-the-monolith.html#cb560-12" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
</div>
<div id="schemasettings.ex-and-schemastreaming_status_enum.ex" class="section level3 hasAnchor" number="23.6.4">
<h3><span class="header-section-number">23.6.4</span> schema/settings.ex and schema/streaming_status_enum.ex<a href="back-to-the-monolith.html#schemasettings.ex-and-schemastreaming_status_enum.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will move the <code>/lib/hedgehog/streamer/binance/schema/settings.ex</code> file to</p>
<p><code>/lib/hedgehog/streamer/settings.ex</code> and the</p>
<p><code>/lib/hedgehog/streamer/binance/schema/streaming_status_enum.ex</code> file to</p>
<p><code>/lib/hedgehog/streamer/settings_status_enum.ex</code>(file renamed). We can now remove the empty</p>
<p><code>/lib/hedgehog/streamer/binance/schema</code> directory. Both of those modules need their modules’ names and references updated:</p>
<div class="sourceCode" id="cb561"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb561-1"><a href="back-to-the-monolith.html#cb561-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/settings.ex</span></span>
<span id="cb561-2"><a href="back-to-the-monolith.html#cb561-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Settings</span> <span class="kw">do</span></span>
<span id="cb561-3"><a href="back-to-the-monolith.html#cb561-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb561-4"><a href="back-to-the-monolith.html#cb561-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span></span>
<span id="cb561-5"><a href="back-to-the-monolith.html#cb561-5" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb561-6"><a href="back-to-the-monolith.html#cb561-6" tabindex="-1"></a>  schema <span class="st">&quot;streamer_settings&quot;</span> <span class="kw">do</span></span>
<span id="cb561-7"><a href="back-to-the-monolith.html#cb561-7" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb561-8"><a href="back-to-the-monolith.html#cb561-8" tabindex="-1"></a>    field<span class="fu">(</span><span class="va">:status</span>, <span class="cn">SettingsStatusEnum</span><span class="fu">)</span></span>
<span id="cb561-9"><a href="back-to-the-monolith.html#cb561-9" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<p>and:</p>
<div class="sourceCode" id="cb562"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb562-1"><a href="back-to-the-monolith.html#cb562-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/settings_status_enum.ex</span></span>
<span id="cb562-2"><a href="back-to-the-monolith.html#cb562-2" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb562-3"><a href="back-to-the-monolith.html#cb562-3" tabindex="-1"></a>defenum<span class="fu">(</span><span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span>, <span class="va">:status</span>, <span class="ot">[</span><span class="va">:on</span>, <span class="va">:off</span><span class="ot">]</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="application" class="section level3 hasAnchor" number="23.6.5">
<h3><span class="header-section-number">23.6.5</span> application<a href="back-to-the-monolith.html#application" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final file that we need to look into is <code>/lib/hedgehog/streamer/binance/application.ex</code>, where we will look into children who were supervised by the <code>streamer</code> app:</p>
<div class="sourceCode" id="cb563"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb563-1"><a href="back-to-the-monolith.html#cb563-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/streamer/binance/application.ex</span></span>
<span id="cb563-2"><a href="back-to-the-monolith.html#cb563-2" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb563-3"><a href="back-to-the-monolith.html#cb563-3" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Repo</span>, <span class="ot">[]</span><span class="fu">}</span>,</span>
<span id="cb563-4"><a href="back-to-the-monolith.html#cb563-4" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Supervisor</span>, <span class="ot">[]</span><span class="fu">}</span></span>
<span id="cb563-5"><a href="back-to-the-monolith.html#cb563-5" tabindex="-1"></a>    <span class="ot">]</span></span></code></pre></div>
<p>We don’t need to worry about the <code>Streamer.Repo</code> as we will use the <code>Hedgehog.Repo</code>. On the other hand, the <code>Streamer.Supervisor</code> which we renamed to <code>Hedgehog.Streamer.Binance.Supervisor</code> needs to be added to the main <code>Hedgehog.Application</code> module:</p>
<div class="sourceCode" id="cb564"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb564-1"><a href="back-to-the-monolith.html#cb564-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/application.ex</span></span>
<span id="cb564-2"><a href="back-to-the-monolith.html#cb564-2" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb564-3"><a href="back-to-the-monolith.html#cb564-3" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb564-4"><a href="back-to-the-monolith.html#cb564-4" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">Supervisor</span></span>
<span id="cb564-5"><a href="back-to-the-monolith.html#cb564-5" tabindex="-1"></a>    <span class="ot">]</span></span></code></pre></div>
<p>We can now remove <code>/lib/hedgehog/streamer/binance/application.ex</code> as it is no longer required.</p>
</div>
<div id="db-migrations-and-seeding" class="section level3 hasAnchor" number="23.6.6">
<h3><span class="header-section-number">23.6.6</span> DB migrations and seeding<a href="back-to-the-monolith.html#db-migrations-and-seeding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Streaming depends on the database tables and settings(seed data). We will start by copying</p>
<p><code>apps/streamer/priv/repo/migrations/20210203184805_create_settings.exs</code> migration to</p>
<p><code>/priv/repo/migrations</code>(and renaming the file to <code>20210203184805_create_streamer_settings.exs</code>) directory and update the most of the code inside:</p>
<div class="sourceCode" id="cb565"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb565-1"><a href="back-to-the-monolith.html#cb565-1" tabindex="-1"></a><span class="co"># /priv/repo/migrations/20210203184805_create_streamer_settings.exs</span></span>
<span id="cb565-2"><a href="back-to-the-monolith.html#cb565-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">CreateStreamerSettings</span> <span class="kw">do</span></span>
<span id="cb565-3"><a href="back-to-the-monolith.html#cb565-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb565-4"><a href="back-to-the-monolith.html#cb565-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span></span>
<span id="cb565-5"><a href="back-to-the-monolith.html#cb565-5" tabindex="-1"></a></span>
<span id="cb565-6"><a href="back-to-the-monolith.html#cb565-6" tabindex="-1"></a>  <span class="kw">def</span> change <span class="kw">do</span></span>
<span id="cb565-7"><a href="back-to-the-monolith.html#cb565-7" tabindex="-1"></a>    <span class="cn">SettingsStatusEnum</span><span class="op">.</span>create_type<span class="fu">()</span></span>
<span id="cb565-8"><a href="back-to-the-monolith.html#cb565-8" tabindex="-1"></a></span>
<span id="cb565-9"><a href="back-to-the-monolith.html#cb565-9" tabindex="-1"></a>    create table<span class="fu">(</span><span class="va">:streamer_settings</span>, <span class="va">primary_key:</span> <span class="cn">false</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb565-10"><a href="back-to-the-monolith.html#cb565-10" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb565-11"><a href="back-to-the-monolith.html#cb565-11" tabindex="-1"></a>      add<span class="fu">(</span><span class="va">:status</span>, <span class="cn">SettingsStatusEnum</span><span class="op">.</span>type<span class="fu">()</span>, <span class="va">default:</span> <span class="st">&quot;off&quot;</span>, <span class="va">null:</span> <span class="cn">false</span><span class="fu">)</span></span>
<span id="cb565-12"><a href="back-to-the-monolith.html#cb565-12" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb565-13"><a href="back-to-the-monolith.html#cb565-13" tabindex="-1"></a>    create<span class="fu">(</span>unique_index<span class="fu">(</span><span class="va">:streamer_settings</span>, <span class="ot">[</span><span class="va">:symbol</span><span class="ot">]</span><span class="fu">))</span></span>
<span id="cb565-14"><a href="back-to-the-monolith.html#cb565-14" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>Next, we will copy the seeding script’s code from <code>/apps/streamer/priv/seed_settings.exs</code> to</p>
<p><code>/priv/repo/seeds.exs</code> and make the following updates:</p>
<div class="sourceCode" id="cb566"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb566-1"><a href="back-to-the-monolith.html#cb566-1" tabindex="-1"></a><span class="co"># /priv/repo/seeds.exs</span></span>
<span id="cb566-2"><a href="back-to-the-monolith.html#cb566-2" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb566-3"><a href="back-to-the-monolith.html#cb566-3" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Settings</span></span>
<span id="cb566-4"><a href="back-to-the-monolith.html#cb566-4" tabindex="-1"></a></span>
<span id="cb566-5"><a href="back-to-the-monolith.html#cb566-5" tabindex="-1"></a>binance_client <span class="op">=</span> <span class="cn">Application</span><span class="op">.</span>compile_env<span class="fu">(</span><span class="va">:hedgehog</span>, <span class="va">:binance_client</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="config" class="section level3 hasAnchor" number="23.6.7">
<h3><span class="header-section-number">23.6.7</span> Config<a href="back-to-the-monolith.html#config" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inside the script above, we were reading the application’s configuration expecting the <code>binance_client</code> to be there - let’s append the required settings to the configuration:</p>
<div class="sourceCode" id="cb567"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb567-1"><a href="back-to-the-monolith.html#cb567-1" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb567-2"><a href="back-to-the-monolith.html#cb567-2" tabindex="-1"></a>config <span class="va">:hedgehog</span>,</span>
<span id="cb567-3"><a href="back-to-the-monolith.html#cb567-3" tabindex="-1"></a>  <span class="va">binance_client:</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">BinanceMock</span>, <span class="co"># &lt;= added</span></span>
<span id="cb567-4"><a href="back-to-the-monolith.html#cb567-4" tabindex="-1"></a>  <span class="va">ecto_repos:</span> <span class="ot">[</span><span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="ot">]</span>,</span>
<span id="cb567-5"><a href="back-to-the-monolith.html#cb567-5" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
</div>
<div id="deps" class="section level3 hasAnchor" number="23.6.8">
<h3><span class="header-section-number">23.6.8</span> Deps<a href="back-to-the-monolith.html#deps" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We need to add a couple of new dependencies that the streaming code is using:</p>
<div class="sourceCode" id="cb568"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb568-1"><a href="back-to-the-monolith.html#cb568-1" tabindex="-1"></a><span class="co"># /mix.exs</span></span>
<span id="cb568-2"><a href="back-to-the-monolith.html#cb568-2" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb568-3"><a href="back-to-the-monolith.html#cb568-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb568-4"><a href="back-to-the-monolith.html#cb568-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb568-5"><a href="back-to-the-monolith.html#cb568-5" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:ecto_enum</span>, <span class="st">&quot;~&gt; 1.4&quot;</span><span class="fu">}</span>,</span>
<span id="cb568-6"><a href="back-to-the-monolith.html#cb568-6" tabindex="-1"></a>      <span class="fu">{</span><span class="va">:websockex</span>, <span class="st">&quot;~&gt; 0.4.2&quot;</span><span class="fu">}</span></span></code></pre></div>
<p>With the above changes, the reintegration of the <code>Streamer</code> app is finished. We need to remember about getting new deps, running migrations, seeding database and we can test that everything works up to this point:</p>
<pre><code>$ mix deps.get
...
$ mix setup
...
$ iex -S mix phx.server
...
iex(1)&gt; Hedgehog.Streamer.Binance.start_streaming(&quot;XRPUSDT&quot;)
...
[info] Binance streamer is connecting to websocket stream for XRPUSDT trade events
{:ok, #PID&lt;0.801.0&gt;}
[debug] Trade event received XRPUSDT@0.55080000
BREAK: (a)bort (A)bort with dump (c)ontinue (p)roc info (i)nfo
       (l)oaded (v)ersion (k)ill (D)b-tables (d)istribution
^C
$ iex -S mix phx.server
...
[info] Binance streamer is connecting to websocket stream for XRPUSDT trade events
[debug] Trade event received XRPUSDT@0.55240000
iex(1)&gt; Hedgehog.Streamer.Binance.stop_streaming(&quot;XRPUSDT&quot;)
[info] Stopping streaming XRPUSDT trade events
...</code></pre>
<p>The above confirms that we can start and stop streaming, and upon startup, streaming starts on its own when enabled in the database.</p>
</div>
</div>
<div id="reintegrating-the-naive-app" class="section level2 hasAnchor" number="23.7">
<h2><span class="header-section-number">23.7</span> Reintegrating the <code>naive</code> app<a href="back-to-the-monolith.html#reintegrating-the-naive-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We will kick off the <code>naive</code> application reintegration by creating a new directory called <code>strategy</code> inside the <code>/lib/hedgehog/</code>, where we will place both the <code>naive.ex</code> file and the <code>naive</code> directory(both originally located inside the <code>/apps/naive/lib/</code>).</p>
<div id="naive.ex" class="section level3 hasAnchor" number="23.7.1">
<h3><span class="header-section-number">23.7.1</span> naive.ex<a href="back-to-the-monolith.html#naive.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We can update the module name and aliases inside the <code>naive.ex</code> file:</p>
<div class="sourceCode" id="cb570"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb570-1"><a href="back-to-the-monolith.html#cb570-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive.ex</span></span>
<span id="cb570-2"><a href="back-to-the-monolith.html#cb570-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span> <span class="kw">do</span></span>
<span id="cb570-3"><a href="back-to-the-monolith.html#cb570-3" tabindex="-1"></a>  <span class="op">..</span></span>
<span id="cb570-4"><a href="back-to-the-monolith.html#cb570-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">DynamicTraderSupervisor</span></span>
<span id="cb570-5"><a href="back-to-the-monolith.html#cb570-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Trader</span></span></code></pre></div>
</div>
<div id="strategy.ex---formula.ex" class="section level3 hasAnchor" number="23.7.2">
<h3><span class="header-section-number">23.7.2</span> strategy.ex -&gt; formula.ex<a href="back-to-the-monolith.html#strategy.ex---formula.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Moving on to the <code>naive</code> directory, first, we will rename the <code>strategy.ex</code> file to <code>formula.ex</code> and update the references inside:</p>
<div class="sourceCode" id="cb571"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb571-1"><a href="back-to-the-monolith.html#cb571-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive/formula.ex</span></span>
<span id="cb571-2"><a href="back-to-the-monolith.html#cb571-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Formula</span> <span class="kw">do</span></span>
<span id="cb571-3"><a href="back-to-the-monolith.html#cb571-3" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span></span>
<span id="cb571-4"><a href="back-to-the-monolith.html#cb571-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb571-5"><a href="back-to-the-monolith.html#cb571-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Settings</span></span>
<span id="cb571-6"><a href="back-to-the-monolith.html#cb571-6" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb571-7"><a href="back-to-the-monolith.html#cb571-7" tabindex="-1"></a></span>
<span id="cb571-8"><a href="back-to-the-monolith.html#cb571-8" tabindex="-1"></a>  <span class="ot">@binance_client</span> <span class="cn">Application</span><span class="op">.</span>compile_env<span class="fu">(</span><span class="va">:hedgehog</span>, <span class="va">:binance_client</span><span class="fu">)</span></span>
<span id="cb571-9"><a href="back-to-the-monolith.html#cb571-9" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb571-10"><a href="back-to-the-monolith.html#cb571-10" tabindex="-1"></a>  <span class="kw">defp</span> broadcast_order<span class="fu">(</span>%<span class="cn">Binance</span><span class="op">.</span><span class="cn">Order</span><span class="fu">{}</span> <span class="op">=</span> order<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb571-11"><a href="back-to-the-monolith.html#cb571-11" tabindex="-1"></a>    <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>broadcast<span class="fu">(</span></span>
<span id="cb571-12"><a href="back-to-the-monolith.html#cb571-12" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb571-13"><a href="back-to-the-monolith.html#cb571-13" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
</div>
<div id="trader.ex" class="section level3 hasAnchor" number="23.7.3">
<h3><span class="header-section-number">23.7.3</span> <code>trader.ex</code><a href="back-to-the-monolith.html#trader.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Next, we will update the <code>trader.ex</code>:</p>
<div class="sourceCode" id="cb572"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb572-1"><a href="back-to-the-monolith.html#cb572-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive/trader.ex</span></span>
<span id="cb572-2"><a href="back-to-the-monolith.html#cb572-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Trader</span> <span class="kw">do</span></span>
<span id="cb572-3"><a href="back-to-the-monolith.html#cb572-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb572-4"><a href="back-to-the-monolith.html#cb572-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span></span>
<span id="cb572-5"><a href="back-to-the-monolith.html#cb572-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Formula</span></span></code></pre></div>
<p>as well as all update all references to:</p>
<ul>
<li><code>Naive.Strategy</code> or <code>Strategy</code> to <code>Formula</code></li>
<li><code>Core.PubSub</code> to <code>Hedgehog.PubSub</code></li>
</ul>
</div>
<div id="supervisor.ex" class="section level3 hasAnchor" number="23.7.4">
<h3><span class="header-section-number">23.7.4</span> <code>supervisor.ex</code><a href="back-to-the-monolith.html#supervisor.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Similarly, for the <code>supervisor.ex</code> file, we need to update the module name and alias:</p>
<div class="sourceCode" id="cb573"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb573-1"><a href="back-to-the-monolith.html#cb573-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive/supervisor.ex</span></span>
<span id="cb573-2"><a href="back-to-the-monolith.html#cb573-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Supervisor</span> <span class="kw">do</span></span>
<span id="cb573-3"><a href="back-to-the-monolith.html#cb573-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb573-4"><a href="back-to-the-monolith.html#cb573-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">DynamicTraderSupervisor</span></span></code></pre></div>
</div>
<div id="dynamic_trader_supervisor.ex" class="section level3 hasAnchor" number="23.7.5">
<h3><span class="header-section-number">23.7.5</span> <code>dynamic_trader_supervisor.ex</code><a href="back-to-the-monolith.html#dynamic_trader_supervisor.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the <code>dynamic_trader_supervisor.ex</code> file, we need to update the module name, aliases and all the references to the <code>Strategy</code> module:</p>
<div class="sourceCode" id="cb574"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb574-1"><a href="back-to-the-monolith.html#cb574-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive/dynamic_trader_supervisor.ex</span></span>
<span id="cb574-2"><a href="back-to-the-monolith.html#cb574-2" tabindex="-1"></a>defmodule <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">DynamicTraderSupervisor</span> <span class="kw">do</span></span>
<span id="cb574-3"><a href="back-to-the-monolith.html#cb574-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb574-4"><a href="back-to-the-monolith.html#cb574-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb574-5"><a href="back-to-the-monolith.html#cb574-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Settings</span></span>
<span id="cb574-6"><a href="back-to-the-monolith.html#cb574-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Formula</span></span>
<span id="cb574-7"><a href="back-to-the-monolith.html#cb574-7" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Trader</span></span>
<span id="cb574-8"><a href="back-to-the-monolith.html#cb574-8" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb574-9"><a href="back-to-the-monolith.html#cb574-9" tabindex="-1"></a>  <span class="co"># three occurrences of `Strategy.update_status/2` call</span></span>
<span id="cb574-10"><a href="back-to-the-monolith.html#cb574-10" tabindex="-1"></a>  <span class="cn">Strategy</span><span class="op">.</span>update_status<span class="fu">(</span><span class="op">...</span><span class="fu">)</span> <span class="op">-&gt;</span> <span class="cn">Formula</span><span class="op">.</span>update_status<span class="fu">(</span><span class="op">...</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="repo-and-schema-files" class="section level3 hasAnchor" number="23.7.6">
<h3><span class="header-section-number">23.7.6</span> Repo and <code>schema</code> files<a href="back-to-the-monolith.html#repo-and-schema-files" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As we will use <code>Hedgehog.Repo</code>, we can remove the <code>/lib/hedgehog/strategy/naive/repo.ex</code> file.</p>
<p>We will move both the <code>schema/settings.ex</code> and the <code>schema/trading_status_enum.ex</code> out of the <code>schema</code> directory into the main Naive’s strategy directory(<code>/lib/hedgehog/strategy/naive</code>). We can now remove the empty <code>schema</code> directory.</p>
<div style="page-break-after: always;"></div>
<p>In line with the other Enum modules’ changes, we will update the file name from</p>
<p><code>/lib/hedgehog/strategy/naive/trading_status_enum.ex</code> to</p>
<p><code>/lib/hedgehog/strategy/naive/settings_status_enum.ex</code>.</p>
<p>Inside the file, we will update the module name inside the <code>defenum</code>:</p>
<div class="sourceCode" id="cb575"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb575-1"><a href="back-to-the-monolith.html#cb575-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive/settings_status_enum.ex</span></span>
<span id="cb575-2"><a href="back-to-the-monolith.html#cb575-2" tabindex="-1"></a>defenum<span class="fu">(</span></span>
<span id="cb575-3"><a href="back-to-the-monolith.html#cb575-3" tabindex="-1"></a>  <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span>,</span>
<span id="cb575-4"><a href="back-to-the-monolith.html#cb575-4" tabindex="-1"></a>  <span class="va">:naive_trading_status</span>,</span>
<span id="cb575-5"><a href="back-to-the-monolith.html#cb575-5" tabindex="-1"></a>  <span class="ot">[</span><span class="va">:on</span>, <span class="va">:off</span>, <span class="va">:shutdown</span><span class="ot">]</span></span>
<span id="cb575-6"><a href="back-to-the-monolith.html#cb575-6" tabindex="-1"></a><span class="fu">)</span></span></code></pre></div>
<p>Moving on to the <code>settings.ex</code> file, where we need to update the module name, alias as well as table name and status enum module:</p>
<div class="sourceCode" id="cb576"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb576-1"><a href="back-to-the-monolith.html#cb576-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/strategy/naive/settings_status_enum.ex</span></span>
<span id="cb576-2"><a href="back-to-the-monolith.html#cb576-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Settings</span> <span class="kw">do</span></span>
<span id="cb576-3"><a href="back-to-the-monolith.html#cb576-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb576-4"><a href="back-to-the-monolith.html#cb576-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span></span>
<span id="cb576-5"><a href="back-to-the-monolith.html#cb576-5" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb576-6"><a href="back-to-the-monolith.html#cb576-6" tabindex="-1"></a>  schema <span class="st">&quot;naive_strategy_settings&quot;</span> <span class="kw">do</span></span>
<span id="cb576-7"><a href="back-to-the-monolith.html#cb576-7" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb576-8"><a href="back-to-the-monolith.html#cb576-8" tabindex="-1"></a>    field<span class="fu">(</span><span class="va">:status</span>, <span class="cn">SettingsStatusEnum</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="application.ex" class="section level3 hasAnchor" number="23.7.7">
<h3><span class="header-section-number">23.7.7</span> <code>application.ex</code><a href="back-to-the-monolith.html#application.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final file that we copied across from the <code>naive</code> umbrella app is <code>application.ex</code>, where we will look into the supervised <code>children</code> list. It was supervising the <code>Naive.Repo</code>, which we don’t need any more and <code>Naive.Supervisor</code>, which we renamed and need to put into our new main <code>application.ex</code> file:</p>
<div class="sourceCode" id="cb577"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb577-1"><a href="back-to-the-monolith.html#cb577-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/application.ex</span></span>
<span id="cb577-2"><a href="back-to-the-monolith.html#cb577-2" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>_type, _args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb577-3"><a href="back-to-the-monolith.html#cb577-3" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb577-4"><a href="back-to-the-monolith.html#cb577-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb577-5"><a href="back-to-the-monolith.html#cb577-5" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Supervisor</span></span></code></pre></div>
<p>After the above addition, we can remove the <code>/lib/hedgehog/strategy/naive/application.ex</code> file.</p>
</div>
<div id="migration-and-seeding" class="section level3 hasAnchor" number="23.7.8">
<h3><span class="header-section-number">23.7.8</span> Migration and seeding<a href="back-to-the-monolith.html#migration-and-seeding" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, we will move two migration files from the <code>/apps/naive/priv/repo/migrations/</code> to <code>/priv/repo/migrations</code>. We will rename the <code>20210202223209_create_settings.exs</code> to</p>
<p><code>20210202223209_create_naive_strategy_settings.exs</code> where we will update the module name and all references to modules and table name:</p>
<div class="sourceCode" id="cb578"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb578-1"><a href="back-to-the-monolith.html#cb578-1" tabindex="-1"></a><span class="co"># /priv/repo/migrations/20210202223209_create_naive_strategy_settings.exs</span></span>
<span id="cb578-2"><a href="back-to-the-monolith.html#cb578-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">CreateNaiveStrategySettings</span> <span class="kw">do</span></span>
<span id="cb578-3"><a href="back-to-the-monolith.html#cb578-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb578-4"><a href="back-to-the-monolith.html#cb578-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span></span>
<span id="cb578-5"><a href="back-to-the-monolith.html#cb578-5" tabindex="-1"></a></span>
<span id="cb578-6"><a href="back-to-the-monolith.html#cb578-6" tabindex="-1"></a>  <span class="kw">def</span> change <span class="kw">do</span></span>
<span id="cb578-7"><a href="back-to-the-monolith.html#cb578-7" tabindex="-1"></a>    <span class="cn">SettingsStatusEnum</span><span class="op">.</span>create_type<span class="fu">()</span></span>
<span id="cb578-8"><a href="back-to-the-monolith.html#cb578-8" tabindex="-1"></a></span>
<span id="cb578-9"><a href="back-to-the-monolith.html#cb578-9" tabindex="-1"></a>    create table<span class="fu">(</span><span class="va">:naive_strategy_settings</span>, <span class="va">primary_key:</span> <span class="cn">false</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb578-10"><a href="back-to-the-monolith.html#cb578-10" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb578-11"><a href="back-to-the-monolith.html#cb578-11" tabindex="-1"></a>      add<span class="fu">(</span><span class="va">:status</span>, <span class="cn">SettingsStatusEnum</span><span class="op">.</span>type<span class="fu">()</span>, <span class="va">default:</span> <span class="st">&quot;off&quot;</span>, <span class="va">null:</span> <span class="cn">false</span><span class="fu">)</span></span>
<span id="cb578-12"><a href="back-to-the-monolith.html#cb578-12" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb578-13"><a href="back-to-the-monolith.html#cb578-13" tabindex="-1"></a></span>
<span id="cb578-14"><a href="back-to-the-monolith.html#cb578-14" tabindex="-1"></a>    create<span class="fu">(</span>unique_index<span class="fu">(</span><span class="va">:naive_strategy_settings</span>, <span class="ot">[</span><span class="va">:symbol</span><span class="ot">]</span><span class="fu">))</span></span></code></pre></div>
<p>Next, we will rename the <code>20210205232303_update_trading_status.exs</code> to</p>
<p><code>20210205232303_update_naive_strategy_settings_status.exs</code> where we will update the module name and all references to modules:</p>
<div class="sourceCode" id="cb579"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb579-1"><a href="back-to-the-monolith.html#cb579-1" tabindex="-1"></a><span class="co"># /priv/repo/migrations/20210205232303_update_naive_strategy_settings_status.exs</span></span>
<span id="cb579-2"><a href="back-to-the-monolith.html#cb579-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">UpdateNaiveStrategySettingsStatus</span> <span class="kw">do</span></span>
<span id="cb579-3"><a href="back-to-the-monolith.html#cb579-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb579-4"><a href="back-to-the-monolith.html#cb579-4" tabindex="-1"></a>  <span class="kw">def</span> change <span class="kw">do</span></span>
<span id="cb579-5"><a href="back-to-the-monolith.html#cb579-5" tabindex="-1"></a>    <span class="cn">Ecto</span><span class="op">.</span><span class="cn">Migration</span><span class="op">.</span>execute<span class="fu">(</span></span>
<span id="cb579-6"><a href="back-to-the-monolith.html#cb579-6" tabindex="-1"></a>      <span class="st">&quot;ALTER TYPE naive_trading_status ADD VALUE IF NOT EXISTS &#39;shutdown&#39;&quot;</span></span>
<span id="cb579-7"><a href="back-to-the-monolith.html#cb579-7" tabindex="-1"></a>    <span class="fu">)</span></span></code></pre></div>
<p>Finally, we need to merge the code that seeds the naive’s strategy settings into the <code>/priv/repo/seeds.exs</code> file:</p>
<div class="sourceCode" id="cb580"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb580-1"><a href="back-to-the-monolith.html#cb580-1" tabindex="-1"></a><span class="co"># /priv/repo/seeds.exs</span></span>
<span id="cb580-2"><a href="back-to-the-monolith.html#cb580-2" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Streamer</span><span class="op">.</span><span class="cn">Settings</span>, <span class="va">as:</span> <span class="cn">StreamerSettings</span> <span class="co"># &lt;= updated</span></span>
<span id="cb580-3"><a href="back-to-the-monolith.html#cb580-3" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Settings</span>, <span class="va">as:</span> <span class="cn">NaiveStrategySettings</span> <span class="co"># &lt;= added</span></span>
<span id="cb580-4"><a href="back-to-the-monolith.html#cb580-4" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb580-5"><a href="back-to-the-monolith.html#cb580-5" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info<span class="fu">(</span><span class="st">&quot;Inserting default streamer settings for symbols&quot;</span><span class="fu">)</span></span>
<span id="cb580-6"><a href="back-to-the-monolith.html#cb580-6" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb580-7"><a href="back-to-the-monolith.html#cb580-7" tabindex="-1"></a><span class="co"># updated, `on_conflict` added</span></span>
<span id="cb580-8"><a href="back-to-the-monolith.html#cb580-8" tabindex="-1"></a><span class="fu">{</span>count, <span class="cn">nil</span><span class="fu">}</span> <span class="op">=</span> <span class="cn">Repo</span><span class="op">.</span>insert_all<span class="fu">(</span><span class="cn">StreamerSettings</span>, maps, <span class="va">on_conflict:</span> <span class="va">:nothing</span><span class="fu">)</span></span>
<span id="cb580-9"><a href="back-to-the-monolith.html#cb580-9" tabindex="-1"></a></span>
<span id="cb580-10"><a href="back-to-the-monolith.html#cb580-10" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info<span class="fu">(</span><span class="st">&quot;Inserted streamer settings for </span><span class="ot">#{</span>count<span class="ot">}</span><span class="st"> symbols&quot;</span><span class="fu">)</span></span>
<span id="cb580-11"><a href="back-to-the-monolith.html#cb580-11" tabindex="-1"></a></span>
<span id="cb580-12"><a href="back-to-the-monolith.html#cb580-12" tabindex="-1"></a><span class="co"># below added at the end</span></span>
<span id="cb580-13"><a href="back-to-the-monolith.html#cb580-13" tabindex="-1"></a>%<span class="fu">{</span></span>
<span id="cb580-14"><a href="back-to-the-monolith.html#cb580-14" tabindex="-1"></a>  <span class="va">chunks:</span> chunks,</span>
<span id="cb580-15"><a href="back-to-the-monolith.html#cb580-15" tabindex="-1"></a>  <span class="va">budget:</span> budget,</span>
<span id="cb580-16"><a href="back-to-the-monolith.html#cb580-16" tabindex="-1"></a>  <span class="va">buy_down_interval:</span> buy_down_interval,</span>
<span id="cb580-17"><a href="back-to-the-monolith.html#cb580-17" tabindex="-1"></a>  <span class="va">profit_interval:</span> profit_interval,</span>
<span id="cb580-18"><a href="back-to-the-monolith.html#cb580-18" tabindex="-1"></a>  <span class="va">rebuy_interval:</span> rebuy_interval</span>
<span id="cb580-19"><a href="back-to-the-monolith.html#cb580-19" tabindex="-1"></a><span class="fu">}</span> <span class="op">=</span> <span class="cn">Application</span><span class="op">.</span>compile_env<span class="fu">(</span><span class="va">:hedgehog</span>, <span class="ot">[</span><span class="va">:strategy</span>, <span class="va">:naive</span>, <span class="va">:defaults</span><span class="ot">]</span><span class="fu">)</span></span>
<span id="cb580-20"><a href="back-to-the-monolith.html#cb580-20" tabindex="-1"></a></span>
<span id="cb580-21"><a href="back-to-the-monolith.html#cb580-21" tabindex="-1"></a>base_settings <span class="op">=</span> %<span class="fu">{</span></span>
<span id="cb580-22"><a href="back-to-the-monolith.html#cb580-22" tabindex="-1"></a>  <span class="va">symbol:</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb580-23"><a href="back-to-the-monolith.html#cb580-23" tabindex="-1"></a>  <span class="va">chunks:</span> chunks,</span>
<span id="cb580-24"><a href="back-to-the-monolith.html#cb580-24" tabindex="-1"></a>  <span class="va">budget:</span> <span class="cn">Decimal</span><span class="op">.</span>new<span class="fu">(</span>budget<span class="fu">)</span>,</span>
<span id="cb580-25"><a href="back-to-the-monolith.html#cb580-25" tabindex="-1"></a>  <span class="va">buy_down_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>new<span class="fu">(</span>buy_down_interval<span class="fu">)</span>,</span>
<span id="cb580-26"><a href="back-to-the-monolith.html#cb580-26" tabindex="-1"></a>  <span class="va">profit_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>new<span class="fu">(</span>profit_interval<span class="fu">)</span>,</span>
<span id="cb580-27"><a href="back-to-the-monolith.html#cb580-27" tabindex="-1"></a>  <span class="va">rebuy_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>new<span class="fu">(</span>rebuy_interval<span class="fu">)</span>,</span>
<span id="cb580-28"><a href="back-to-the-monolith.html#cb580-28" tabindex="-1"></a>  <span class="va">status:</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb580-29"><a href="back-to-the-monolith.html#cb580-29" tabindex="-1"></a>  <span class="va">inserted_at:</span> timestamp,</span>
<span id="cb580-30"><a href="back-to-the-monolith.html#cb580-30" tabindex="-1"></a>  <span class="va">updated_at:</span> timestamp</span>
<span id="cb580-31"><a href="back-to-the-monolith.html#cb580-31" tabindex="-1"></a><span class="fu">}</span></span>
<span id="cb580-32"><a href="back-to-the-monolith.html#cb580-32" tabindex="-1"></a></span>
<span id="cb580-33"><a href="back-to-the-monolith.html#cb580-33" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info<span class="fu">(</span><span class="st">&quot;Inserting default naive strategy settings for symbols&quot;</span><span class="fu">)</span></span>
<span id="cb580-34"><a href="back-to-the-monolith.html#cb580-34" tabindex="-1"></a></span>
<span id="cb580-35"><a href="back-to-the-monolith.html#cb580-35" tabindex="-1"></a>maps <span class="op">=</span> symbols</span>
<span id="cb580-36"><a href="back-to-the-monolith.html#cb580-36" tabindex="-1"></a>  <span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>map<span class="fu">(</span><span class="op">&amp;</span><span class="fu">(</span>%<span class="fu">{</span>base_settings <span class="op">|</span> <span class="va">symbol:</span> <span class="op">&amp;</span><span class="dv">1</span><span class="ot">[</span><span class="st">&quot;symbol&quot;</span><span class="ot">]</span><span class="fu">}))</span></span>
<span id="cb580-37"><a href="back-to-the-monolith.html#cb580-37" tabindex="-1"></a></span>
<span id="cb580-38"><a href="back-to-the-monolith.html#cb580-38" tabindex="-1"></a><span class="fu">{</span>count, <span class="cn">nil</span><span class="fu">}</span> <span class="op">=</span> <span class="cn">Repo</span><span class="op">.</span>insert_all<span class="fu">(</span><span class="cn">NaiveStrategySettings</span>, maps, <span class="va">on_conflict:</span> <span class="va">:nothing</span><span class="fu">)</span></span>
<span id="cb580-39"><a href="back-to-the-monolith.html#cb580-39" tabindex="-1"></a></span>
<span id="cb580-40"><a href="back-to-the-monolith.html#cb580-40" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info<span class="fu">(</span><span class="st">&quot;Inserted naive strategy settings for </span><span class="ot">#{</span>count<span class="ot">}</span><span class="st"> symbols&quot;</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="configuration" class="section level3 hasAnchor" number="23.7.9">
<h3><span class="header-section-number">23.7.9</span> Configuration<a href="back-to-the-monolith.html#configuration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The seeding script above requires additional configuration that we will add now to the <code>/config/config.exs</code> file:</p>
<div class="sourceCode" id="cb581"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb581-1"><a href="back-to-the-monolith.html#cb581-1" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb581-2"><a href="back-to-the-monolith.html#cb581-2" tabindex="-1"></a>config <span class="va">:hedgehog</span>,</span>
<span id="cb581-3"><a href="back-to-the-monolith.html#cb581-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb581-4"><a href="back-to-the-monolith.html#cb581-4" tabindex="-1"></a>  <span class="va">strategy:</span> <span class="ot">[</span></span>
<span id="cb581-5"><a href="back-to-the-monolith.html#cb581-5" tabindex="-1"></a>    <span class="va">naive:</span> <span class="ot">[</span></span>
<span id="cb581-6"><a href="back-to-the-monolith.html#cb581-6" tabindex="-1"></a>      <span class="va">defaults:</span> %<span class="fu">{</span></span>
<span id="cb581-7"><a href="back-to-the-monolith.html#cb581-7" tabindex="-1"></a>        <span class="va">chunks:</span> <span class="dv">5</span>,</span>
<span id="cb581-8"><a href="back-to-the-monolith.html#cb581-8" tabindex="-1"></a>        <span class="va">budget:</span> <span class="dv">1000</span>,</span>
<span id="cb581-9"><a href="back-to-the-monolith.html#cb581-9" tabindex="-1"></a>        <span class="va">buy_down_interval:</span> <span class="st">&quot;0.0001&quot;</span>,</span>
<span id="cb581-10"><a href="back-to-the-monolith.html#cb581-10" tabindex="-1"></a>        <span class="va">profit_interval:</span> <span class="st">&quot;-0.0012&quot;</span>,</span>
<span id="cb581-11"><a href="back-to-the-monolith.html#cb581-11" tabindex="-1"></a>        <span class="va">rebuy_interval:</span> <span class="st">&quot;0.001&quot;</span></span>
<span id="cb581-12"><a href="back-to-the-monolith.html#cb581-12" tabindex="-1"></a>      <span class="fu">}</span></span>
<span id="cb581-13"><a href="back-to-the-monolith.html#cb581-13" tabindex="-1"></a>    <span class="ot">]</span></span>
<span id="cb581-14"><a href="back-to-the-monolith.html#cb581-14" tabindex="-1"></a>  <span class="ot">]</span></span></code></pre></div>
</div>
<div id="tests" class="section level3 hasAnchor" number="23.7.10">
<h3><span class="header-section-number">23.7.10</span> Tests<a href="back-to-the-monolith.html#tests" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final part of the <code>naive</code> application that we need to copy across are tests located in <code>/apps/naive/test</code>. We will create new directories <code>/test/hedgehog/strategy</code> and paste there the <code>/apps/naive/test/naive_test.exs</code> file and <code>/apps/naive/test/naive</code> directory.</p>
<p>First, we will update the <code>naive_test.exs</code> by updating its module name and aliases:</p>
<div class="sourceCode" id="cb582"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb582-1"><a href="back-to-the-monolith.html#cb582-1" tabindex="-1"></a><span class="co"># /test/hedgehog/strategy/naive_test.exs</span></span>
<span id="cb582-2"><a href="back-to-the-monolith.html#cb582-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">NaiveTest</span> <span class="kw">do</span></span>
<span id="cb582-3"><a href="back-to-the-monolith.html#cb582-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb582-4"><a href="back-to-the-monolith.html#cb582-4" tabindex="-1"></a>  doctest <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span></span>
<span id="cb582-5"><a href="back-to-the-monolith.html#cb582-5" tabindex="-1"></a></span>
<span id="cb582-6"><a href="back-to-the-monolith.html#cb582-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">Order</span> <span class="co"># &lt;= to be migrated...</span></span>
<span id="cb582-7"><a href="back-to-the-monolith.html#cb582-7" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Settings</span>, <span class="va">as:</span> <span class="cn">TradingSettings</span></span>
<span id="cb582-8"><a href="back-to-the-monolith.html#cb582-8" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span></span></code></pre></div>
<p>Next, we will rename the <code>/test/hedgehog/strategy/naive/strategy_test.exs</code> to</p>
<p><code>/test/hedgehog/strategy/naive/formula_test.exs</code> and update its module name and aliases:</p>
<div class="sourceCode" id="cb583"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb583-1"><a href="back-to-the-monolith.html#cb583-1" tabindex="-1"></a><span class="co"># /test/hedgehog/strategy/naive/formula_test.exs</span></span>
<span id="cb583-2"><a href="back-to-the-monolith.html#cb583-2" tabindex="-1"></a>defmodule <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">FormulaTest</span> <span class="kw">do</span></span>
<span id="cb583-3"><a href="back-to-the-monolith.html#cb583-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb583-4"><a href="back-to-the-monolith.html#cb583-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">BinanceMock</span>    <span class="co"># &lt;= added</span></span>
<span id="cb583-5"><a href="back-to-the-monolith.html#cb583-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span></span>
<span id="cb583-6"><a href="back-to-the-monolith.html#cb583-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Strategy</span><span class="op">.</span><span class="cn">Naive</span><span class="op">.</span><span class="cn">Formula</span></span>
<span id="cb583-7"><a href="back-to-the-monolith.html#cb583-7" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb583-8"><a href="back-to-the-monolith.html#cb583-8" tabindex="-1"></a>  <span class="co"># update all references to `Strategy` with `Formula`</span></span></code></pre></div>
<p>Finally, we will overwrite the <code>test_helper.exs</code> based on the one from the <code>naive</code> app:</p>
<div class="sourceCode" id="cb584"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb584-1"><a href="back-to-the-monolith.html#cb584-1" tabindex="-1"></a><span class="co"># /test/test_helper.exs</span></span>
<span id="cb584-2"><a href="back-to-the-monolith.html#cb584-2" tabindex="-1"></a><span class="cn">ExUnit</span><span class="op">.</span>start<span class="fu">(</span><span class="va">capture_log:</span> <span class="cn">true</span><span class="fu">)</span></span>
<span id="cb584-3"><a href="back-to-the-monolith.html#cb584-3" tabindex="-1"></a></span>
<span id="cb584-4"><a href="back-to-the-monolith.html#cb584-4" tabindex="-1"></a><span class="cn">Application</span><span class="op">.</span>ensure_all_started<span class="fu">(</span><span class="va">:mimic</span><span class="fu">)</span></span>
<span id="cb584-5"><a href="back-to-the-monolith.html#cb584-5" tabindex="-1"></a></span>
<span id="cb584-6"><a href="back-to-the-monolith.html#cb584-6" tabindex="-1"></a><span class="cn">Mimic</span><span class="op">.</span>copy<span class="fu">(</span><span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">BinanceMock</span><span class="fu">)</span></span>
<span id="cb584-7"><a href="back-to-the-monolith.html#cb584-7" tabindex="-1"></a><span class="cn">Mimic</span><span class="op">.</span>copy<span class="fu">(</span><span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="dependencies" class="section level3 hasAnchor" number="23.7.11">
<h3><span class="header-section-number">23.7.11</span> Dependencies<a href="back-to-the-monolith.html#dependencies" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final part of the integration will be to move dependencies to the <code>mix.exs</code> file:</p>
<div class="sourceCode" id="cb585"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb585-1"><a href="back-to-the-monolith.html#cb585-1" tabindex="-1"></a><span class="co"># /mix.exs</span></span>
<span id="cb585-2"><a href="back-to-the-monolith.html#cb585-2" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb585-3"><a href="back-to-the-monolith.html#cb585-3" tabindex="-1"></a>    <span class="ot">[</span></span>
<span id="cb585-4"><a href="back-to-the-monolith.html#cb585-4" tabindex="-1"></a>       <span class="op">...</span></span>
<span id="cb585-5"><a href="back-to-the-monolith.html#cb585-5" tabindex="-1"></a>       <span class="fu">{</span><span class="va">:mimic</span>, <span class="st">&quot;~&gt; 1.7&quot;</span>, <span class="va">only:</span> <span class="ot">[</span><span class="va">:test</span>, <span class="va">:integration</span><span class="ot">]</span><span class="fu">}</span></span></code></pre></div>
<p>The final test will be to fetch the required deps and run the unit tests:</p>
<pre><code>$ mix deps.get
...
$ mix setup
...
$ mix test --only unit --no-start
...
......
Finished in 0.1 seconds (0.1s async, 0.00s sync)
17 tests, 0 failures, 6 excluded</code></pre>
<p>We will see a lot of warnings as we haven’t yet migrated the <code>DataWarehouse</code> application. Either way, we received the confirmation that unit tests ran successfully. We are also able to run the application to see that it can go through the trading cycle:</p>
<pre><code>$ iex -S mix phx.server
...
iex(1)&gt; alias Hedgehog.Strategy.Naive
...
iex(2)&gt; alias Hedgehog.Streamer.Binance
...
iex(3)&gt; Binance.start_streaming(&quot;XRPUSDT&quot;)
...
iex(4)&gt; Naive.start_trading(&quot;XRPUSDT&quot;)
...
[info] Position (XRPUSDT/1715703392316): Placing a BUY order @ 0.50650000,
quantity: 394.86000000
[info] Position (XRPUSDT/1715704251578): The BUY order is now partially filled
[info] Position (XRPUSDT/1715704251578): The BUY order is now filled. Placing a
SELL order @ 0.50690000, quantity: 394.86000000
[info] Position (XRPUSDT/1715704251578): The SELL order is now partially filled
[info] Position (XRPUSDT/1715704251578): Trade cycle finished
[info] Position (XRPUSDT/1715704342038): Placing a BUY order @ 0.50680000,
quantity: 394.63000000</code></pre>
<p>The above confirms that our trading strategy works - we have successfully integrated the <code>naive</code> app. Things will be easier from now on.</p>
</div>
</div>
<div id="reintegrating-the-data_warehouse-app" class="section level2 hasAnchor" number="23.8">
<h2><span class="header-section-number">23.8</span> Reintegrating the <code>data_warehouse</code> app<a href="back-to-the-monolith.html#reintegrating-the-data_warehouse-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Inside the new Phoenix application, we will reintegrate the previously named <code>data_warehoure</code> app into <code>data/collector</code> and <code>data/publisher</code> “namespaces”.</p>
<p>We will start by creating a new directory called <code>data</code> inside the <code>lib/headgehog</code> directory. Inside the <code>data</code> directory, we will create a <code>collector</code> directory. We will update all the <code>subscriber_*</code> modules to <code>collector_*</code>.</p>
<p>We will kick off the transition by copying files from the <code>/apps/data_warehouse/lib/data_warehouse/</code> directory to <code>/lib/hedgehog/</code> and renaming them as follows:</p>
<ul>
<li><code>subscriber_supervisor.ex</code> -&gt; <code>data/collector/collector_supervisor.ex</code></li>
<li><code>subscriber/dynamic_supervisor.ex</code> -&gt; <code>data/collector/dynamic_worker_supervisor.ex</code></li>
<li><code>subscriber/worker.ex</code> -&gt; <code>data/collector/worker.ex</code></li>
<li><code>publisher.ex</code> -&gt; <code>data/publisher.ex</code></li>
<li><code>schema/order.ex</code> -&gt; <code>exchange/order.ex</code></li>
<li><code>schema/trade_event.ex</code> -&gt; <code>exchange/trade_event.ex</code> (overwrite)</li>
<li><code>schema/subscriber_settings.ex</code> -&gt; <code>data/collector/settings.ex</code></li>
<li><code>schema/subscriber_status_enum.ex</code> -&gt; <code>data/collector/settings_status_enum.ex</code></li>
<li><code>../data_warehouse.ex</code> -&gt; <code>data/collector.ex</code></li>
</ul>
<p>Now, we will update the new(copied/renamed) files one by one.</p>
<div id="exchangeorder.ex" class="section level3 hasAnchor" number="23.8.1">
<h3><span class="header-section-number">23.8.1</span> <code>exchange/order.ex</code><a href="back-to-the-monolith.html#exchangeorder.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will start with <code>exchange/order.ex</code>, where we will update the module name:</p>
<div class="sourceCode" id="cb588"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb588-1"><a href="back-to-the-monolith.html#cb588-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/exchange/order.ex</span></span>
<span id="cb588-2"><a href="back-to-the-monolith.html#cb588-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">Order</span> <span class="kw">do</span></span></code></pre></div>
</div>
<div id="exchangetrade_event.ex" class="section level3 hasAnchor" number="23.8.2">
<h3><span class="header-section-number">23.8.2</span> <code>exchange/trade_event.ex</code><a href="back-to-the-monolith.html#exchangetrade_event.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This file got overwritten by the contents from the <code>data_warehoure</code> app - we just need to update the module name:</p>
<div class="sourceCode" id="cb589"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb589-1"><a href="back-to-the-monolith.html#cb589-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/exchange/trade_event.ex</span></span>
<span id="cb589-2"><a href="back-to-the-monolith.html#cb589-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span> <span class="kw">do</span></span></code></pre></div>
</div>
<div id="datapublisher.ex" class="section level3 hasAnchor" number="23.8.3">
<h3><span class="header-section-number">23.8.3</span> <code>data/publisher.ex</code><a href="back-to-the-monolith.html#datapublisher.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This module uses tons of other modules, including <code>Repo</code> - we need to update all of these:</p>
<div class="sourceCode" id="cb590"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb590-1"><a href="back-to-the-monolith.html#cb590-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/publisher.ex</span></span>
<span id="cb590-2"><a href="back-to-the-monolith.html#cb590-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Publisher</span> <span class="kw">do</span></span>
<span id="cb590-3"><a href="back-to-the-monolith.html#cb590-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb590-4"><a href="back-to-the-monolith.html#cb590-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span>                 <span class="co"># &lt;= added</span></span>
<span id="cb590-5"><a href="back-to-the-monolith.html#cb590-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span>  <span class="co"># &lt;= added</span></span>
<span id="cb590-6"><a href="back-to-the-monolith.html#cb590-6" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb590-7"><a href="back-to-the-monolith.html#cb590-7" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>arg<span class="fu">)</span> <span class="kw">do</span> <span class="co"># &lt;= renamed the `start_link/1` function </span></span>
<span id="cb590-8"><a href="back-to-the-monolith.html#cb590-8" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb590-9"><a href="back-to-the-monolith.html#cb590-9" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb590-10"><a href="back-to-the-monolith.html#cb590-10" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb590-11"><a href="back-to-the-monolith.html#cb590-11" tabindex="-1"></a>  <span class="kw">def</span> run<span class="fu">(</span>%<span class="fu">{</span></span>
<span id="cb590-12"><a href="back-to-the-monolith.html#cb590-12" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb590-13"><a href="back-to-the-monolith.html#cb590-13" tabindex="-1"></a> <span class="fu">})</span> <span class="kw">do</span></span>
<span id="cb590-14"><a href="back-to-the-monolith.html#cb590-14" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb590-15"><a href="back-to-the-monolith.html#cb590-15" tabindex="-1"></a>    <span class="cn">Repo</span><span class="op">.</span>transaction<span class="fu">(</span></span>
<span id="cb590-16"><a href="back-to-the-monolith.html#cb590-16" tabindex="-1"></a>      <span class="kw">fn</span> <span class="op">-&gt;</span></span>
<span id="cb590-17"><a href="back-to-the-monolith.html#cb590-17" tabindex="-1"></a>        from<span class="fu">(</span>te <span class="kw">in</span> <span class="cn">TradeEvent</span>,</span>
<span id="cb590-18"><a href="back-to-the-monolith.html#cb590-18" tabindex="-1"></a>          <span class="op">...</span></span>
<span id="cb590-19"><a href="back-to-the-monolith.html#cb590-19" tabindex="-1"></a>        <span class="fu">)</span></span>
<span id="cb590-20"><a href="back-to-the-monolith.html#cb590-20" tabindex="-1"></a>        <span class="op">|&gt;</span> <span class="cn">Repo</span><span class="op">.</span>stream<span class="fu">()</span></span>
<span id="cb590-21"><a href="back-to-the-monolith.html#cb590-21" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb590-22"><a href="back-to-the-monolith.html#cb590-22" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb590-23"><a href="back-to-the-monolith.html#cb590-23" tabindex="-1"></a></span>
<span id="cb590-24"><a href="back-to-the-monolith.html#cb590-24" tabindex="-1"></a>  <span class="kw">defp</span> publish_trade_event<span class="fu">(</span>%<span class="cn">TradeEvent</span><span class="fu">{}</span> <span class="op">=</span> trade_event<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb590-25"><a href="back-to-the-monolith.html#cb590-25" tabindex="-1"></a>    new_trade_event <span class="op">=</span></span>
<span id="cb590-26"><a href="back-to-the-monolith.html#cb590-26" tabindex="-1"></a>      struct<span class="fu">(</span></span>
<span id="cb590-27"><a href="back-to-the-monolith.html#cb590-27" tabindex="-1"></a>        <span class="cn">TradeEvent</span>,</span>
<span id="cb590-28"><a href="back-to-the-monolith.html#cb590-28" tabindex="-1"></a>        <span class="op">...</span></span>
<span id="cb590-29"><a href="back-to-the-monolith.html#cb590-29" tabindex="-1"></a>      <span class="fu">)</span></span>
<span id="cb590-30"><a href="back-to-the-monolith.html#cb590-30" tabindex="-1"></a></span>
<span id="cb590-31"><a href="back-to-the-monolith.html#cb590-31" tabindex="-1"></a>    <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>broadcast<span class="fu">(</span></span>
<span id="cb590-32"><a href="back-to-the-monolith.html#cb590-32" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb590-33"><a href="back-to-the-monolith.html#cb590-33" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb590-34"><a href="back-to-the-monolith.html#cb590-34" tabindex="-1"></a>    <span class="fu">)</span></span>
<span id="cb590-35"><a href="back-to-the-monolith.html#cb590-35" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
</div>
<div id="datacollector.ex" class="section level3 hasAnchor" number="23.8.4">
<h3><span class="header-section-number">23.8.4</span> <code>data/collector.ex</code><a href="back-to-the-monolith.html#datacollector.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This module was an interface for both collectors and publishers. From now on, it will only cater for collectors:</p>
<div class="sourceCode" id="cb591"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb591-1"><a href="back-to-the-monolith.html#cb591-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/collector.ex</span></span>
<span id="cb591-2"><a href="back-to-the-monolith.html#cb591-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span> <span class="kw">do</span></span>
<span id="cb591-3"><a href="back-to-the-monolith.html#cb591-3" tabindex="-1"></a>  <span class="ot">@moduledoc &quot;&quot;&quot;</span></span>
<span id="cb591-4"><a href="back-to-the-monolith.html#cb591-4" tabindex="-1"></a><span class="co"> Documentation for </span><span class="in">`Hedgehog.Data.Collector`</span><span class="co">.</span></span>
<span id="cb591-5"><a href="back-to-the-monolith.html#cb591-5" tabindex="-1"></a><span class="co"> </span><span class="ot">&quot;&quot;&quot;</span></span>
<span id="cb591-6"><a href="back-to-the-monolith.html#cb591-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">DynamicWorkerSupervisor</span></span>
<span id="cb591-7"><a href="back-to-the-monolith.html#cb591-7" tabindex="-1"></a></span>
<span id="cb591-8"><a href="back-to-the-monolith.html#cb591-8" tabindex="-1"></a>  <span class="kw">def</span> start_storing<span class="fu">(</span>stream, symbol<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb591-9"><a href="back-to-the-monolith.html#cb591-9" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb591-10"><a href="back-to-the-monolith.html#cb591-10" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">DynamicWorkerSupervisor</span><span class="op">.</span>start_worker<span class="fu">()</span></span>
<span id="cb591-11"><a href="back-to-the-monolith.html#cb591-11" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb591-12"><a href="back-to-the-monolith.html#cb591-12" tabindex="-1"></a></span>
<span id="cb591-13"><a href="back-to-the-monolith.html#cb591-13" tabindex="-1"></a>  <span class="kw">def</span> stop_storing<span class="fu">(</span>stream, symbol<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb591-14"><a href="back-to-the-monolith.html#cb591-14" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb591-15"><a href="back-to-the-monolith.html#cb591-15" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">DynamicWorkerSupervisor</span><span class="op">.</span>stop_worker<span class="fu">()</span></span>
<span id="cb591-16"><a href="back-to-the-monolith.html#cb591-16" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb591-17"><a href="back-to-the-monolith.html#cb591-17" tabindex="-1"></a></span>
<span id="cb591-18"><a href="back-to-the-monolith.html#cb591-18" tabindex="-1"></a>  <span class="co"># remove `publish_data/1`</span></span></code></pre></div>
</div>
<div id="datacollectorcollector_supervisor.ex" class="section level3 hasAnchor" number="23.8.5">
<h3><span class="header-section-number">23.8.5</span> <code>data/collector/collector_supervisor.ex</code><a href="back-to-the-monolith.html#datacollectorcollector_supervisor.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the case of the main collector supervisor, we need to update the aliases:</p>
<div class="sourceCode" id="cb592"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb592-1"><a href="back-to-the-monolith.html#cb592-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/collector/collector_supervisor.ex</span></span>
<span id="cb592-2"><a href="back-to-the-monolith.html#cb592-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">CollectorSupervisor</span> <span class="kw">do</span></span>
<span id="cb592-3"><a href="back-to-the-monolith.html#cb592-3" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb592-4"><a href="back-to-the-monolith.html#cb592-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">DynamicWorkerSupervisor</span></span>
<span id="cb592-5"><a href="back-to-the-monolith.html#cb592-5" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb592-6"><a href="back-to-the-monolith.html#cb592-6" tabindex="-1"></a>  <span class="ot">@registry</span> <span class="va">:collector_workers</span></span>
<span id="cb592-7"><a href="back-to-the-monolith.html#cb592-7" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb592-8"><a href="back-to-the-monolith.html#cb592-8" tabindex="-1"></a>  <span class="kw">def</span> init<span class="fu">(</span>_args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb592-9"><a href="back-to-the-monolith.html#cb592-9" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb592-10"><a href="back-to-the-monolith.html#cb592-10" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb592-11"><a href="back-to-the-monolith.html#cb592-11" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">DynamicWorkerSupervisor</span>, <span class="ot">[]</span><span class="fu">}</span>,</span>
<span id="cb592-12"><a href="back-to-the-monolith.html#cb592-12" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">Task</span>,</span>
<span id="cb592-13"><a href="back-to-the-monolith.html#cb592-13" tabindex="-1"></a>        <span class="kw">fn</span> <span class="op">-&gt;</span></span>
<span id="cb592-14"><a href="back-to-the-monolith.html#cb592-14" tabindex="-1"></a>          <span class="cn">DynamicWorkerSupervisor</span><span class="op">.</span>autostart_workers<span class="fu">()</span></span>
<span id="cb592-15"><a href="back-to-the-monolith.html#cb592-15" tabindex="-1"></a>        <span class="kw">end</span><span class="fu">}</span></span>
<span id="cb592-16"><a href="back-to-the-monolith.html#cb592-16" tabindex="-1"></a>     <span class="ot">]</span></span>
<span id="cb592-17"><a href="back-to-the-monolith.html#cb592-17" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
</div>
<div id="datacollectordynamic_worker_supervisor.ex" class="section level3 hasAnchor" number="23.8.6">
<h3><span class="header-section-number">23.8.6</span> <code>/data/collector/dynamic_worker_supervisor.ex</code><a href="back-to-the-monolith.html#datacollectordynamic_worker_supervisor.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In the case of the dynamic worker supervisor that we renamed, we need to update the module name:</p>
<div class="sourceCode" id="cb593"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb593-1"><a href="back-to-the-monolith.html#cb593-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/collector/dynamic_worker_supervisor.ex</span></span>
<span id="cb593-2"><a href="back-to-the-monolith.html#cb593-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">DynamicWorkerSupervisor</span> <span class="kw">do</span></span>
<span id="cb593-3"><a href="back-to-the-monolith.html#cb593-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb593-4"><a href="back-to-the-monolith.html#cb593-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb593-5"><a href="back-to-the-monolith.html#cb593-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">Settings</span></span>
<span id="cb593-6"><a href="back-to-the-monolith.html#cb593-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">Worker</span></span>
<span id="cb593-7"><a href="back-to-the-monolith.html#cb593-7" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb593-8"><a href="back-to-the-monolith.html#cb593-8" tabindex="-1"></a>  <span class="ot">@registry</span> <span class="va">:collector_workers</span></span>
<span id="cb593-9"><a href="back-to-the-monolith.html#cb593-9" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb593-10"><a href="back-to-the-monolith.html#cb593-10" tabindex="-1"></a>  <span class="kw">def</span> autostart_workers <span class="kw">do</span></span>
<span id="cb593-11"><a href="back-to-the-monolith.html#cb593-11" tabindex="-1"></a>    <span class="cn">Repo</span><span class="op">.</span>all<span class="fu">(</span></span>
<span id="cb593-12"><a href="back-to-the-monolith.html#cb593-12" tabindex="-1"></a>      from<span class="fu">(</span>s <span class="kw">in</span> <span class="cn">Settings</span>,</span>
<span id="cb593-13"><a href="back-to-the-monolith.html#cb593-13" tabindex="-1"></a>   <span class="op">...</span></span>
<span id="cb593-14"><a href="back-to-the-monolith.html#cb593-14" tabindex="-1"></a>  <span class="kw">defp</span> update_status<span class="fu">(</span>topic, status<span class="fu">)</span></span>
<span id="cb593-15"><a href="back-to-the-monolith.html#cb593-15" tabindex="-1"></a>       <span class="kw">when</span> is_binary<span class="fu">(</span>topic<span class="fu">)</span> <span class="kw">and</span> is_binary<span class="fu">(</span>status<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb593-16"><a href="back-to-the-monolith.html#cb593-16" tabindex="-1"></a> %<span class="cn">Settings</span><span class="fu">{</span></span>
<span id="cb593-17"><a href="back-to-the-monolith.html#cb593-17" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
</div>
<div id="datacollectorsettings_status_enum.ex" class="section level3 hasAnchor" number="23.8.7">
<h3><span class="header-section-number">23.8.7</span> <code>/data/collector/settings_status_enum.ex</code><a href="back-to-the-monolith.html#datacollectorsettings_status_enum.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>As in the case of other settings’ status enums - we need to update the module name and field name:</p>
<div class="sourceCode" id="cb594"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb594-1"><a href="back-to-the-monolith.html#cb594-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/collector/settings_status_enum.ex</span></span>
<span id="cb594-2"><a href="back-to-the-monolith.html#cb594-2" tabindex="-1"></a><span class="im">import</span> <span class="cn">EctoEnum</span></span>
<span id="cb594-3"><a href="back-to-the-monolith.html#cb594-3" tabindex="-1"></a></span>
<span id="cb594-4"><a href="back-to-the-monolith.html#cb594-4" tabindex="-1"></a>defenum<span class="fu">(</span><span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span>, <span class="va">:collector_status</span>, <span class="ot">[</span><span class="va">:on</span>, <span class="va">:off</span><span class="ot">]</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="datacollectorsettings.ex" class="section level3 hasAnchor" number="23.8.8">
<h3><span class="header-section-number">23.8.8</span> <code>/data/collector/settings.ex</code><a href="back-to-the-monolith.html#datacollectorsettings.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For the settings schema, we need to update module name, aliases, and table name:</p>
<div class="sourceCode" id="cb595"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb595-1"><a href="back-to-the-monolith.html#cb595-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/collector/settings.ex</span></span>
<span id="cb595-2"><a href="back-to-the-monolith.html#cb595-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">Settings</span> <span class="kw">do</span></span>
<span id="cb595-3"><a href="back-to-the-monolith.html#cb595-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb595-4"><a href="back-to-the-monolith.html#cb595-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span></span>
<span id="cb595-5"><a href="back-to-the-monolith.html#cb595-5" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb595-6"><a href="back-to-the-monolith.html#cb595-6" tabindex="-1"></a>  schema <span class="st">&quot;collector_settings&quot;</span> <span class="kw">do</span></span>
<span id="cb595-7"><a href="back-to-the-monolith.html#cb595-7" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb595-8"><a href="back-to-the-monolith.html#cb595-8" tabindex="-1"></a>    field<span class="fu">(</span><span class="va">:status</span>, <span class="cn">SettingsStatusEnum</span><span class="fu">)</span></span></code></pre></div>
</div>
<div id="datacollectorworker.ex" class="section level3 hasAnchor" number="23.8.9">
<h3><span class="header-section-number">23.8.9</span> <code>/data/collector/worker.ex</code><a href="back-to-the-monolith.html#datacollectorworker.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final module from the <code>data_warehouse</code> app is a collector worker, where we will update the module name and a few references:</p>
<div class="sourceCode" id="cb596"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb596-1"><a href="back-to-the-monolith.html#cb596-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/collector/worker.ex</span></span>
<span id="cb596-2"><a href="back-to-the-monolith.html#cb596-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">Worker</span> <span class="kw">do</span></span>
<span id="cb596-3"><a href="back-to-the-monolith.html#cb596-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb596-4"><a href="back-to-the-monolith.html#cb596-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">Order</span>      <span class="co"># &lt;= added</span></span>
<span id="cb596-5"><a href="back-to-the-monolith.html#cb596-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span> <span class="co"># &lt;= added</span></span>
<span id="cb596-6"><a href="back-to-the-monolith.html#cb596-6" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span>                <span class="co"># &lt;= added</span></span>
<span id="cb596-7"><a href="back-to-the-monolith.html#cb596-7" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb596-8"><a href="back-to-the-monolith.html#cb596-8" tabindex="-1"></a>  <span class="kw">def</span> init<span class="fu">(</span>topic<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb596-9"><a href="back-to-the-monolith.html#cb596-9" tabindex="-1"></a>    <span class="cn">Logger</span><span class="op">.</span>info<span class="fu">(</span><span class="st">&quot;Collector worker is subscribing to </span><span class="ot">#{</span>topic<span class="ot">}</span><span class="st">&quot;</span><span class="fu">)</span></span>
<span id="cb596-10"><a href="back-to-the-monolith.html#cb596-10" tabindex="-1"></a></span>
<span id="cb596-11"><a href="back-to-the-monolith.html#cb596-11" tabindex="-1"></a>    <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>subscribe<span class="fu">(</span></span>
<span id="cb596-12"><a href="back-to-the-monolith.html#cb596-12" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb596-13"><a href="back-to-the-monolith.html#cb596-13" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb596-14"><a href="back-to-the-monolith.html#cb596-14" tabindex="-1"></a>     <span class="fu">)</span></span>
<span id="cb596-15"><a href="back-to-the-monolith.html#cb596-15" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb596-16"><a href="back-to-the-monolith.html#cb596-16" tabindex="-1"></a>  <span class="kw">def</span> handle_info<span class="fu">(</span>%<span class="cn">TradeEvent</span><span class="fu">{}</span> <span class="op">=</span> trade_event, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb596-17"><a href="back-to-the-monolith.html#cb596-17" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb596-18"><a href="back-to-the-monolith.html#cb596-18" tabindex="-1"></a></span>
<span id="cb596-19"><a href="back-to-the-monolith.html#cb596-19" tabindex="-1"></a>    struct!<span class="fu">(</span><span class="cn">TradeEvent</span>, opts<span class="fu">)</span></span>
<span id="cb596-20"><a href="back-to-the-monolith.html#cb596-20" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">Repo</span><span class="op">.</span>insert<span class="fu">()</span></span>
<span id="cb596-21"><a href="back-to-the-monolith.html#cb596-21" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb596-22"><a href="back-to-the-monolith.html#cb596-22" tabindex="-1"></a>  <span class="kw">def</span> handle_info<span class="fu">(</span>%<span class="cn">Binance</span><span class="op">.</span><span class="cn">Order</span><span class="fu">{}</span> <span class="op">=</span> order, state<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb596-23"><a href="back-to-the-monolith.html#cb596-23" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb596-24"><a href="back-to-the-monolith.html#cb596-24" tabindex="-1"></a></span>
<span id="cb596-25"><a href="back-to-the-monolith.html#cb596-25" tabindex="-1"></a>    struct<span class="fu">(</span><span class="cn">Order</span>, data<span class="fu">)</span></span>
<span id="cb596-26"><a href="back-to-the-monolith.html#cb596-26" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">Map</span><span class="op">.</span>merge<span class="fu">(</span>%<span class="fu">{</span></span>
<span id="cb596-27"><a href="back-to-the-monolith.html#cb596-27" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb596-28"><a href="back-to-the-monolith.html#cb596-28" tabindex="-1"></a>    <span class="fu">})</span></span>
<span id="cb596-29"><a href="back-to-the-monolith.html#cb596-29" tabindex="-1"></a>    <span class="op">|&gt;</span> <span class="cn">Repo</span><span class="op">.</span>insert<span class="fu">(</span></span>
<span id="cb596-30"><a href="back-to-the-monolith.html#cb596-30" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb596-31"><a href="back-to-the-monolith.html#cb596-31" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb596-32"><a href="back-to-the-monolith.html#cb596-32" tabindex="-1"></a>  <span class="kw">defp</span> via_tuple<span class="fu">(</span>topic<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb596-33"><a href="back-to-the-monolith.html#cb596-33" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:via</span>, <span class="cn">Registry</span>, <span class="fu">{</span><span class="va">:collector_workers</span>, topic<span class="fu">}}</span></span></code></pre></div>
<p>This finishes the module updates. We can move on to the other files from the <code>data_warehouse</code> application.</p>
</div>
<div id="supervision-tree" class="section level3 hasAnchor" number="23.8.10">
<h3><span class="header-section-number">23.8.10</span> Supervision tree<a href="back-to-the-monolith.html#supervision-tree" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>When we were copying the modules from the <code>data_warehouse</code> app, we skipped over its <code>application.ex</code> module. Looking inside, we can see that it was supervising the <code>DataWarehouse.SubscriberSupervisor</code> (currently renamed to <code>Hedgehog.Data.Collector.CollectorSupervisor</code>) - we need to add it to the main supervision tree of our new application:</p>
<div class="sourceCode" id="cb597"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb597-1"><a href="back-to-the-monolith.html#cb597-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/application.ex</span></span>
<span id="cb597-2"><a href="back-to-the-monolith.html#cb597-2" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>_type, _args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb597-3"><a href="back-to-the-monolith.html#cb597-3" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb597-4"><a href="back-to-the-monolith.html#cb597-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb597-5"><a href="back-to-the-monolith.html#cb597-5" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">CollectorSupervisor</span></span></code></pre></div>
</div>
<div id="migrations" class="section level3 hasAnchor" number="23.8.11">
<h3><span class="header-section-number">23.8.11</span> Migrations<a href="back-to-the-monolith.html#migrations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will copy three migration files across from the <code>data_warehouse</code> app (the</p>
<p><code>/apps/data_warehouse/priv/repo/migrations/</code> directory) to the new Phoenix application (the</p>
<p><code>priv/repo/migrations/</code> directory).</p>
<p>In the case of the <code>20210227230123_create_subscriber_settings.exs</code>, we need to rename it to</p>
<p><code>20210227230123_create_collector_settings.exs</code>.</p>
<p>For all three of the migration files, we need to update module names:</p>
<div class="sourceCode" id="cb598"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb598-1"><a href="back-to-the-monolith.html#cb598-1" tabindex="-1"></a><span class="co"># /priv/repo/migrations/20210222224514_create_trade_events.exs</span></span>
<span id="cb598-2"><a href="back-to-the-monolith.html#cb598-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">CreateTradeEvents</span> <span class="kw">do</span></span></code></pre></div>
<div class="sourceCode" id="cb599"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb599-1"><a href="back-to-the-monolith.html#cb599-1" tabindex="-1"></a><span class="co"># /priv/repo/migrations/20210222224522_create_orders.exs</span></span>
<span id="cb599-2"><a href="back-to-the-monolith.html#cb599-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">CreateOrders</span> <span class="kw">do</span></span></code></pre></div>
<div style="page-break-after: always;"></div>
<p>for the final file we will also change alias and table name:</p>
<div class="sourceCode" id="cb600"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb600-1"><a href="back-to-the-monolith.html#cb600-1" tabindex="-1"></a><span class="co"># /priv/repo/migrations/20210227230123_create_collector_settings.exs</span></span>
<span id="cb600-2"><a href="back-to-the-monolith.html#cb600-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">CreateSubscriberSettings</span> <span class="kw">do</span></span>
<span id="cb600-3"><a href="back-to-the-monolith.html#cb600-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb600-4"><a href="back-to-the-monolith.html#cb600-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Collector</span><span class="op">.</span><span class="cn">SettingsStatusEnum</span></span>
<span id="cb600-5"><a href="back-to-the-monolith.html#cb600-5" tabindex="-1"></a></span>
<span id="cb600-6"><a href="back-to-the-monolith.html#cb600-6" tabindex="-1"></a>  <span class="kw">def</span> change <span class="kw">do</span></span>
<span id="cb600-7"><a href="back-to-the-monolith.html#cb600-7" tabindex="-1"></a>    <span class="cn">SettingsStatusEnum</span><span class="op">.</span>create_type<span class="fu">()</span></span>
<span id="cb600-8"><a href="back-to-the-monolith.html#cb600-8" tabindex="-1"></a></span>
<span id="cb600-9"><a href="back-to-the-monolith.html#cb600-9" tabindex="-1"></a>    create table<span class="fu">(</span><span class="va">:collector_settings</span>, <span class="va">primary_key:</span> <span class="cn">false</span><span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb600-10"><a href="back-to-the-monolith.html#cb600-10" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb600-11"><a href="back-to-the-monolith.html#cb600-11" tabindex="-1"></a>      add<span class="fu">(</span><span class="va">:status</span>, <span class="cn">SettingsStatusEnum</span><span class="op">.</span>type<span class="fu">()</span>, <span class="va">default:</span> <span class="st">&quot;off&quot;</span>, <span class="va">null:</span> <span class="cn">false</span><span class="fu">)</span></span>
<span id="cb600-12"><a href="back-to-the-monolith.html#cb600-12" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb600-13"><a href="back-to-the-monolith.html#cb600-13" tabindex="-1"></a>    create<span class="fu">(</span>unique_index<span class="fu">(</span><span class="va">:collector_settings</span>, <span class="ot">[</span><span class="va">:topic</span><span class="ot">]</span><span class="fu">))</span></span></code></pre></div>
<p>The above changes finish the integration of the <code>data_warehouse</code> application. We can go ahead and drop the database, set the application again, and confirm that it still works:</p>
<pre><code>$ mix ecto.drop
...
$ mix setup
...
$ mix test --only unit --no-start
...
..........
Finished in 0.1 seconds (0.1s async, 0.00s sync)
17 tests, 0 failures, 6 excluded
$ iex -S mix phx.server
...
iex(1)&gt; alias Hedgehog.Strategy.Naive
...
iex(2)&gt; alias Hedgehog.Streamer.Binance
...
iex(3)&gt; alias Hedgehog.Data.Collector
...
iex(4)&gt; Collector.start_storing(&quot;TRADE_EVENTS&quot;, &quot;XRPUSDT&quot;)
...
iex(5)&gt; Collector.start_storing(&quot;ORDERS&quot;, &quot;XRPUSDT&quot;)
...
iex(6)&gt; Binance.start_streaming(&quot;XRPUSDT&quot;)
...
iex(7)&gt; Naive.start_trading(&quot;XRPUSDT&quot;)
...
[debug] QUERY OK source=&quot;trade_events&quot; ...
INSERT INTO &quot;trade_events&quot;
...
[debug] QUERY OK source=&quot;orders&quot; ...
INSERT INTO &quot;orders&quot;</code></pre>
<p>The above log messages confirm that we are streaming trade events from Binance, placing orders, and storing both in the database.</p>
<p>This finishes the integration of the <code>data_warehouse</code> application.</p>
</div>
</div>
<div id="reintegrating-the-indicator-app" class="section level2 hasAnchor" number="23.9">
<h2><span class="header-section-number">23.9</span> Reintegrating the <code>indicator</code> app<a href="back-to-the-monolith.html#reintegrating-the-indicator-app" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The final application that we will integrate into our new Phoenix app is <code>indicator</code>, which luckily has only three files that we will move across.</p>
<p>We will use this opportunity to rename the <code>indicators</code> to <code>aggregators</code>.</p>
<p>Let’s start by creating a new directory called <code>aggregator</code> inside the <code>/lib/hedgehog/data/</code> directory.</p>
<p>We will copy the <code>/apps/indicator/lib/indicator/ohlc</code> directory and the</p>
<p><code>/apps/indicator/lib/indicator/ohlc.ex</code> file into it.</p>
<p>We will also copy the <code>/apps/indicator/lib/indicator.ex</code> to the <code>/lib/hedgehog/data</code> directory and rename it to <code>aggregator.ex</code>.</p>
<p>Now, we can update each file to fit the new naming convention.</p>
<div id="dataaggregator.ex" class="section level3 hasAnchor" number="23.9.1">
<h3><span class="header-section-number">23.9.1</span> /data/aggregator.ex<a href="back-to-the-monolith.html#dataaggregator.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Here, we need to update the module name a reference to the worker module:</p>
<div class="sourceCode" id="cb602"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb602-1"><a href="back-to-the-monolith.html#cb602-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/aggregator.ex</span></span>
<span id="cb602-2"><a href="back-to-the-monolith.html#cb602-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span> <span class="kw">do</span></span>
<span id="cb602-3"><a href="back-to-the-monolith.html#cb602-3" tabindex="-1"></a>  <span class="ot">@moduledoc &quot;&quot;&quot;</span></span>
<span id="cb602-4"><a href="back-to-the-monolith.html#cb602-4" tabindex="-1"></a><span class="co"> Documentation for </span><span class="in">`Hedgehog.Data.Aggregator`</span><span class="co">.</span></span>
<span id="cb602-5"><a href="back-to-the-monolith.html#cb602-5" tabindex="-1"></a><span class="co"> </span><span class="ot">&quot;&quot;&quot;</span></span>
<span id="cb602-6"><a href="back-to-the-monolith.html#cb602-6" tabindex="-1"></a></span>
<span id="cb602-7"><a href="back-to-the-monolith.html#cb602-7" tabindex="-1"></a>  <span class="kw">def</span> aggregate_ohlcs<span class="fu">(</span>symbol<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb602-8"><a href="back-to-the-monolith.html#cb602-8" tabindex="-1"></a>    <span class="cn">DynamicSupervisor</span><span class="op">.</span>start_child<span class="fu">(</span></span>
<span id="cb602-9"><a href="back-to-the-monolith.html#cb602-9" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span><span class="op">.</span><span class="cn">DynamicWorkerSupervisor</span>,</span>
<span id="cb602-10"><a href="back-to-the-monolith.html#cb602-10" tabindex="-1"></a> <span class="fu">{</span><span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span><span class="op">.</span><span class="cn">Ohlc</span><span class="op">.</span><span class="cn">Worker</span>, symbol<span class="fu">}</span></span></code></pre></div>
</div>
<div id="dataaggregatorohlc.ex" class="section level3 hasAnchor" number="23.9.2">
<h3><span class="header-section-number">23.9.2</span> /data/aggregator/ohlc.ex<a href="back-to-the-monolith.html#dataaggregatorohlc.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Inside the ohlc module we need to update the reference to the trade event and pubsub:</p>
<div class="sourceCode" id="cb603"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb603-1"><a href="back-to-the-monolith.html#cb603-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/aggregator/ohlc.ex</span></span>
<span id="cb603-2"><a href="back-to-the-monolith.html#cb603-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span><span class="op">.</span><span class="cn">Ohlc</span> <span class="kw">do</span></span>
<span id="cb603-3"><a href="back-to-the-monolith.html#cb603-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb603-4"><a href="back-to-the-monolith.html#cb603-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span></span>
<span id="cb603-5"><a href="back-to-the-monolith.html#cb603-5" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb603-6"><a href="back-to-the-monolith.html#cb603-6" tabindex="-1"></a>  <span class="kw">defp</span> maybe_broadcast<span class="fu">(</span>%<span class="cn">__MODULE__</span><span class="fu">{}</span> <span class="op">=</span> ohlc<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb603-7"><a href="back-to-the-monolith.html#cb603-7" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb603-8"><a href="back-to-the-monolith.html#cb603-8" tabindex="-1"></a>    <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>broadcast<span class="fu">(</span></span>
<span id="cb603-9"><a href="back-to-the-monolith.html#cb603-9" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb603-10"><a href="back-to-the-monolith.html#cb603-10" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
</div>
<div id="dataaggregatorohlcworker.ex" class="section level3 hasAnchor" number="23.9.3">
<h3><span class="header-section-number">23.9.3</span> /data/aggregator/ohlc/worker.ex<a href="back-to-the-monolith.html#dataaggregatorohlcworker.ex" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The final file to update will be the worker module, where we need to update the references to pubsub and the ohlc module:</p>
<div class="sourceCode" id="cb604"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb604-1"><a href="back-to-the-monolith.html#cb604-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/data/aggregator/ohlc/worker.ex</span></span>
<span id="cb604-2"><a href="back-to-the-monolith.html#cb604-2" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span><span class="op">.</span><span class="cn">Ohlc</span><span class="op">.</span><span class="cn">Worker</span> <span class="kw">do</span></span>
<span id="cb604-3"><a href="back-to-the-monolith.html#cb604-3" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb604-4"><a href="back-to-the-monolith.html#cb604-4" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span><span class="op">.</span><span class="cn">Ohlc</span> <span class="co"># &lt;= added</span></span>
<span id="cb604-5"><a href="back-to-the-monolith.html#cb604-5" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Exchange</span><span class="op">.</span><span class="cn">TradeEvent</span></span>
<span id="cb604-6"><a href="back-to-the-monolith.html#cb604-6" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb604-7"><a href="back-to-the-monolith.html#cb604-7" tabindex="-1"></a>  <span class="kw">def</span> init<span class="fu">(</span>symbol<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb604-8"><a href="back-to-the-monolith.html#cb604-8" tabindex="-1"></a>    <span class="op">...</span></span>
<span id="cb604-9"><a href="back-to-the-monolith.html#cb604-9" tabindex="-1"></a>    <span class="cn">Phoenix</span><span class="op">.</span><span class="cn">PubSub</span><span class="op">.</span>subscribe<span class="fu">(</span></span>
<span id="cb604-10"><a href="back-to-the-monolith.html#cb604-10" tabindex="-1"></a>      <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">PubSub</span>,</span>
<span id="cb604-11"><a href="back-to-the-monolith.html#cb604-11" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb604-12"><a href="back-to-the-monolith.html#cb604-12" tabindex="-1"></a>  <span class="kw">def</span> handle_info<span class="fu">(</span>%<span class="cn">TradeEvent</span><span class="fu">{}</span> <span class="op">=</span> trade_event, ohlc<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb604-13"><a href="back-to-the-monolith.html#cb604-13" tabindex="-1"></a>    <span class="fu">{</span><span class="va">:noreply</span>, <span class="cn">Ohlc</span><span class="op">.</span>process<span class="fu">(</span>ohlc, trade_event<span class="fu">)}</span></span>
<span id="cb604-14"><a href="back-to-the-monolith.html#cb604-14" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
</div>
<div id="supervision-tree-1" class="section level3 hasAnchor" number="23.9.4">
<h3><span class="header-section-number">23.9.4</span> Supervision tree<a href="back-to-the-monolith.html#supervision-tree-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A quick look at the <code>application.ex</code> module of the <code>indicator</code> app will tell us that we need to add a dynamic supervisor to the supervision tree of the new app (we referred to it already as</p>
<p><code>Hedgehog.Data.Aggregator.DynamicWorkerSupervisor</code> inside the <code>Hedgehog.Data.Aggregator</code> as we were updating it):</p>
<div class="sourceCode" id="cb605"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb605-1"><a href="back-to-the-monolith.html#cb605-1" tabindex="-1"></a><span class="co"># /lib/hedgehog/application.ex</span></span>
<span id="cb605-2"><a href="back-to-the-monolith.html#cb605-2" tabindex="-1"></a>  <span class="kw">def</span> start<span class="fu">(</span>_type, _args<span class="fu">)</span> <span class="kw">do</span></span>
<span id="cb605-3"><a href="back-to-the-monolith.html#cb605-3" tabindex="-1"></a>    children <span class="op">=</span> <span class="ot">[</span></span>
<span id="cb605-4"><a href="back-to-the-monolith.html#cb605-4" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb605-5"><a href="back-to-the-monolith.html#cb605-5" tabindex="-1"></a>      <span class="fu">{</span><span class="cn">DynamicSupervisor</span>,</span>
<span id="cb605-6"><a href="back-to-the-monolith.html#cb605-6" tabindex="-1"></a>       <span class="va">strategy:</span> <span class="va">:one_for_one</span>, <span class="va">name:</span> <span class="cn">Hedgehog</span><span class="op">.</span><span class="cn">Data</span><span class="op">.</span><span class="cn">Aggregator</span><span class="op">.</span><span class="cn">DynamicWorkerSupervisor</span><span class="fu">}</span></span>
<span id="cb605-7"><a href="back-to-the-monolith.html#cb605-7" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>The above change finishes integrating the <code>indicator</code> app and the changes in this chapter, as it was the last application to be merged in.</p>
<p>We can make the last check that everything works by starting the streaming and aggregating:</p>
<pre><code>$ mix ecto.drop
...
$ mix setup
...
$ iex -S mix phx.server
...
iex(1)&gt; alias Hedgehog.Streamer.Binance
...
iex(2)&gt; alias Hedgehog.Data.Aggregator
...
iex(3)&gt; Aggregator.aggregate_ohlcs(&quot;XRPUSDT&quot;)
...
iex(4)&gt; Binance.start_streaming(&quot;XRPUSDT&quot;)
...
[debug] Broadcasting OHLC: %Hedgehog.Data.Aggregator.Ohlc{symbol: &quot;XRPUSDT&quot;,
start_time: 1717173780, duration: 1, open: &quot;0.51350000&quot;, high: &quot;0.51380000&quot;,
low: &quot;0.51350000&quot;, close: &quot;0.51370000&quot;}</code></pre>
<p>The above log confirms that we have a fully working aggregation that gets broadcasted and could be stored in the database or used inside the strategy.</p>
<p>It was a lot of repetitive copy/moving/renaming - thank you for sticking with me through this. After our migration to Phoenix application we will have a great start into potential deploying, which we will focus on in the upcoming chapter!</p>
<p>[Note] Please remember to run the <code>mix format</code> to keep things nice and tidy.</p>
<p>The source code for this chapter can be found on <a href="https://github.com/Cinderella-Man/hands-on-elixir-and-otp-cryptocurrency-trading-bot-source-code/tree/chapter_23">GitHub</a></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="win-with-pure-logic.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/Cinderella-Man/hands-on-elixir-and-otp-cryptocurrency-trading-bot/edit/main/23-back-to-the-monolith.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
