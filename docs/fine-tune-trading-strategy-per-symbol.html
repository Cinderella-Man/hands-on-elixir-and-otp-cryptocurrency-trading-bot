<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 10 Fine-tune trading strategy per symbol | Create a cryptocurrency trading bot in Elixir</title>
  <meta name="description" content="Chapter 10 Fine-tune trading strategy per symbol | Create a cryptocurrency trading bot in Elixir" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 10 Fine-tune trading strategy per symbol | Create a cryptocurrency trading bot in Elixir" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  
  <meta name="github-repo" content="frathon/create-a-cryptocurrency-trading-bot-in-elixir" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 10 Fine-tune trading strategy per symbol | Create a cryptocurrency trading bot in Elixir" />
  
  
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Kamil Skowron" />


<meta name="date" content="2021-04-21" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="run-multiple-traders-in-parallel.html"/>
<link rel="next" href="supervise-and-autostart-streaming.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-52FKGBX2B8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-52FKGBX2B8');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Create a cryptocurrency trading bot in Elixir</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome üëã</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#limit-of-liabilitydisclaimer-of-warranty"><i class="fa fa-check"></i>Limit of Liability/Disclaimer of Warranty</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributing-errata"><i class="fa fa-check"></i>Contributing / Errata</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-this-book-covers"><i class="fa fa-check"></i>What this book covers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#source-code"><i class="fa fa-check"></i>Source code</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html"><i class="fa fa-check"></i><b>1</b> Stream live crypto prices from Binance WSS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#create-an-umbrella-app"><i class="fa fa-check"></i><b>1.2</b> Create an umbrella app</a></li>
<li class="chapter" data-level="1.3" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#create-a-supervised-application-inside-an-umbrella"><i class="fa fa-check"></i><b>1.3</b> Create a supervised application inside an umbrella</a></li>
<li class="chapter" data-level="1.4" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#connect-to-binances-websocket-stream-using-the-websockex-module"><i class="fa fa-check"></i><b>1.4</b> Connect to Binance‚Äôs WebSocket Stream using the WebSockex module</a></li>
<li class="chapter" data-level="1.5" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#decode-incoming-events-using-the-jason-module"><i class="fa fa-check"></i><b>1.5</b> Decode incoming events using the Jason module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><i class="fa fa-check"></i><b>2</b> Create a naive trading strategy - a single trader process without supervision</a>
<ul>
<li class="chapter" data-level="2.1" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#initializiation"><i class="fa fa-check"></i><b>2.2</b> Initializiation</a></li>
<li class="chapter" data-level="2.3" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#how-trading-strategy-will-work"><i class="fa fa-check"></i><b>2.3</b> How trading strategy will work?</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-of-the-first-scenario"><i class="fa fa-check"></i><b>2.3.1</b> Implementation of the first scenario</a></li>
<li class="chapter" data-level="2.3.2" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-of-the-second-scenario"><i class="fa fa-check"></i><b>2.3.2</b> Implementation of the second scenario</a></li>
<li class="chapter" data-level="2.3.3" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-of-the-third-scenario"><i class="fa fa-check"></i><b>2.3.3</b> Implementation of the third scenario</a></li>
<li class="chapter" data-level="2.3.4" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-fallback-scenario"><i class="fa fa-check"></i><b>2.3.4</b> Implementation fallback scenario</a></li>
<li class="chapter" data-level="2.3.5" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#updating-the-naive-interface"><i class="fa fa-check"></i><b>2.3.5</b> Updating the Naive interface</a></li>
<li class="chapter" data-level="2.3.6" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#updating-streamer-app"><i class="fa fa-check"></i><b>2.3.6</b> Updating streamer app</a></li>
<li class="chapter" data-level="2.3.7" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#access-details-to-binance"><i class="fa fa-check"></i><b>2.3.7</b> Access details to Binance</a></li>
<li class="chapter" data-level="2.3.8" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#test-run"><i class="fa fa-check"></i><b>2.3.8</b> Test run</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html"><i class="fa fa-check"></i><b>3</b> Introduce PubSub as a communication method</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#design"><i class="fa fa-check"></i><b>3.2</b> Design</a></li>
<li class="chapter" data-level="3.3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#implementation"><i class="fa fa-check"></i><b>3.3</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html"><i class="fa fa-check"></i><b>4</b> Mock the Binance API</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#design-1"><i class="fa fa-check"></i><b>4.2</b> Design</a></li>
<li class="chapter" data-level="4.3" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#create-binancemock-app"><i class="fa fa-check"></i><b>4.3</b> Create ‚ÄúBinanceMock‚Äù app</a></li>
<li class="chapter" data-level="4.4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-getting-exchange-info"><i class="fa fa-check"></i><b>4.4</b> Implement getting exchange info</a></li>
<li class="chapter" data-level="4.5" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-placing-buy-and-sell-orders"><i class="fa fa-check"></i><b>4.5</b> Implement placing buy and sell orders</a></li>
<li class="chapter" data-level="4.6" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-order-retrival"><i class="fa fa-check"></i><b>4.6</b> Implement order retrival</a></li>
<li class="chapter" data-level="4.7" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-callback-for-incoming-trade-events"><i class="fa fa-check"></i><b>4.7</b> Implement callback for incoming trade events</a></li>
<li class="chapter" data-level="4.8" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#upgrade-trader-and-config"><i class="fa fa-check"></i><b>4.8</b> Upgrade trader and config</a></li>
<li class="chapter" data-level="4.9" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#test-the-implementation"><i class="fa fa-check"></i><b>4.9</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html"><i class="fa fa-check"></i><b>5</b> Enable parallel trading on multiple symbols</a>
<ul>
<li class="chapter" data-level="5.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#introduction---architectural-design"><i class="fa fa-check"></i><b>5.2</b> Introduction - architectural design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#update-application-supervisor"><i class="fa fa-check"></i><b>5.2.1</b> Update application supervisor</a></li>
<li class="chapter" data-level="5.2.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#add-interface-method"><i class="fa fa-check"></i><b>5.2.2</b> Add interface method</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.symbolsupervisor"><i class="fa fa-check"></i><b>5.3</b> Implement <code>Naive.SymbolSupervisor</code></a></li>
<li class="chapter" data-level="5.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.leader"><i class="fa fa-check"></i><b>5.4</b> Implement <code>Naive.Leader</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-leader-module"><i class="fa fa-check"></i><b>5.4.1</b> Updating the <code>leader</code> module</a></li>
<li class="chapter" data-level="5.4.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-naive.trader-module"><i class="fa fa-check"></i><b>5.4.2</b> Updating the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="5.4.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#finalizing-naive.leader-implementation"><i class="fa fa-check"></i><b>5.4.3</b> Finalizing <code>Naive.Leader</code> implementation</a></li>
<li class="chapter" data-level="5.4.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#iex-testing"><i class="fa fa-check"></i><b>5.4.4</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><i class="fa fa-check"></i><b>6</b> # Chapter 6 - Introduce a <code>buy_down_interval</code> to make a single trader more profitable</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#why-we-need-to-buy-below-the-current-price-feature-overview"><i class="fa fa-check"></i><b>6.2</b> Why we need to buy below the current price? Feature overview</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#naive.trader-implementation"><i class="fa fa-check"></i><b>6.3</b> <code>Naive.Trader</code> implementation</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#naive.leader-implementation"><i class="fa fa-check"></i><b>6.4</b> <code>Naive.Leader</code> implementation</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#iex-testing-1"><i class="fa fa-check"></i><b>6.4.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html"><i class="fa fa-check"></i><b>7</b> Introduce a trader budget and calculating the quantity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#objectives-6"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#fetch-step_size"><i class="fa fa-check"></i><b>7.2</b> Fetch <code>step_size</code></a></li>
<li class="chapter" data-level="7.3" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state-inside-the-leader"><i class="fa fa-check"></i><b>7.3</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>‚Äôs state inside the <code>Leader</code></a></li>
<li class="chapter" data-level="7.4" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state"><i class="fa fa-check"></i><b>7.4</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>‚Äôs state</a></li>
<li class="chapter" data-level="7.5" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#calculate-quantity"><i class="fa fa-check"></i><b>7.5</b> Calculate quantity</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#iex-testing-2"><i class="fa fa-check"></i><b>7.5.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html"><i class="fa fa-check"></i><b>8</b> Add support for multiple transactions per order</a>
<ul>
<li class="chapter" data-level="8.1" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#objectives-7"><i class="fa fa-check"></i><b>8.1</b> Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#issue-with-the-current-implementation"><i class="fa fa-check"></i><b>8.2</b> Issue with the current implementation</a></li>
<li class="chapter" data-level="8.3" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.3</b> Improve buy order filled callback</a></li>
<li class="chapter" data-level="8.4" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#implement-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.4</b> Implement buy order ‚Äúfilled‚Äù callback</a></li>
<li class="chapter" data-level="8.5" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-sell-order-callback"><i class="fa fa-check"></i><b>8.5</b> Improve sell order callback</a></li>
<li class="chapter" data-level="8.6" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#test-the-implementation-1"><i class="fa fa-check"></i><b>8.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html"><i class="fa fa-check"></i><b>9</b> Run multiple traders in parallel</a>
<ul>
<li class="chapter" data-level="9.1" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#objectives-8"><i class="fa fa-check"></i><b>9.1</b> Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#describe-and-design-the-required-functionality"><i class="fa fa-check"></i><b>9.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="9.3" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-inside-naive.trader"><i class="fa fa-check"></i><b>9.3</b> Implement rebuy inside <code>Naive.Trader</code></a></li>
<li class="chapter" data-level="9.4" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-in-the-naive.leader"><i class="fa fa-check"></i><b>9.4</b> Implement rebuy in the <code>Naive.Leader</code></a></li>
<li class="chapter" data-level="9.5" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#improve-logs-by-assigning-ids-to-traders"><i class="fa fa-check"></i><b>9.5</b> Improve logs by assigning ids to traders</a></li>
<li class="chapter" data-level="9.6" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#test-the-implementation-2"><i class="fa fa-check"></i><b>9.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html"><i class="fa fa-check"></i><b>10</b> Fine-tune trading strategy per symbol</a>
<ul>
<li class="chapter" data-level="10.1" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#objectives-9"><i class="fa fa-check"></i><b>10.1</b> Objectives</a></li>
<li class="chapter" data-level="10.2" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#describe-and-design-the-required-functionality-1"><i class="fa fa-check"></i><b>10.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="10.3" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#add-docker-to-project"><i class="fa fa-check"></i><b>10.3</b> Add docker to project</a></li>
<li class="chapter" data-level="10.4" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#set-up-ecto-inside-the-naive-app"><i class="fa fa-check"></i><b>10.4</b> Set up <code>ecto</code> inside the <code>naive</code> app</a></li>
<li class="chapter" data-level="10.5" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#create-and-migrate-the-db"><i class="fa fa-check"></i><b>10.5</b> Create and migrate the DB</a></li>
<li class="chapter" data-level="10.6" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#seed-symbols-settings"><i class="fa fa-check"></i><b>10.6</b> Seed symbols‚Äô settings</a></li>
<li class="chapter" data-level="10.7" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#update-the-naive.leader-to-fetch-settings"><i class="fa fa-check"></i><b>10.7</b> Update the <code>Naive.Leader</code> to fetch settings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html"><i class="fa fa-check"></i><b>11</b> Supervise and autostart streaming</a>
<ul>
<li class="chapter" data-level="11.1" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#objectives-10"><i class="fa fa-check"></i><b>11.1</b> Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#describe-and-design-the-required-functionality-2"><i class="fa fa-check"></i><b>11.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="11.3" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#register-the-streamer.binance-processes-with-names"><i class="fa fa-check"></i><b>11.3</b> Register the <code>Streamer.Binance</code> processes with names</a></li>
<li class="chapter" data-level="11.4" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#set-up-ecto-inside-the-streamer-app"><i class="fa fa-check"></i><b>11.4</b> Set up <code>ecto</code> inside the <code>streamer</code> app</a></li>
<li class="chapter" data-level="11.5" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#create-and-migrate-the-db-1"><i class="fa fa-check"></i><b>11.5</b> Create and migrate the db</a></li>
<li class="chapter" data-level="11.6" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#seed-default-settings"><i class="fa fa-check"></i><b>11.6</b> Seed default settings</a></li>
<li class="chapter" data-level="11.7" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-supervision-tree-and-start-streaming-functionality"><i class="fa fa-check"></i><b>11.7</b> Implement the supervision tree and start streaming functionality</a></li>
<li class="chapter" data-level="11.8" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-stop-functionality"><i class="fa fa-check"></i><b>11.8</b> Implement the stop functionality</a></li>
<li class="chapter" data-level="11.9" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-autostart-streaming-functionality"><i class="fa fa-check"></i><b>11.9</b> Implement the autostart streaming functionality</a></li>
<li class="chapter" data-level="11.10" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#test-the-implementation-3"><i class="fa fa-check"></i><b>11.10</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html"><i class="fa fa-check"></i><b>12</b> Start, stop, shutdown and autostart trading</a>
<ul>
<li class="chapter" data-level="12.1" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#objectives-11"><i class="fa fa-check"></i><b>12.1</b> Objectives</a></li>
<li class="chapter" data-level="12.2" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#describe-and-design-the-required-functionality-3"><i class="fa fa-check"></i><b>12.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="12.3" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#re-implement-the-start-trading-functionality"><i class="fa fa-check"></i><b>12.3</b> (Re-)Implement the start trading functionality</a></li>
<li class="chapter" data-level="12.4" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-stop-trading-functionality"><i class="fa fa-check"></i><b>12.4</b> Implement the stop trading functionality</a></li>
<li class="chapter" data-level="12.5" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-autostart-trading-functionality"><i class="fa fa-check"></i><b>12.5</b> Implement the autostart trading functionality</a></li>
<li class="chapter" data-level="12.6" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-shutdown-trading-functionality"><i class="fa fa-check"></i><b>12.6</b> Implement the shutdown trading functionality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html"><i class="fa fa-check"></i><b>13</b> Abstract duplicated supervision code</a>
<ul>
<li class="chapter" data-level="13.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#objectives-12"><i class="fa fa-check"></i><b>13.1</b> Objectives</a></li>
<li class="chapter" data-level="13.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#overview-of-requirements"><i class="fa fa-check"></i><b>13.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="13.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#pseudo-generalize-core.servicesupervisor-module"><i class="fa fa-check"></i><b>13.3</b> Pseudo generalize Core.ServiceSupervisor module</a></li>
<li class="chapter" data-level="13.4" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#utilize-pseudo-generalized-code-inside-the-naive.dynamicsymbolsupervisor"><i class="fa fa-check"></i><b>13.4</b> Utilize pseudo generalized code inside the <code>Naive.DynamicSymbolSupervisor</code></a></li>
<li class="chapter" data-level="13.5" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#implement-a-truly-generic-core.servicesupervisor"><i class="fa fa-check"></i><b>13.5</b> Implement a truly generic <code>Core.ServiceSupervisor</code></a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#first-path-starting-with-the-fetch_symbols_to_start0-function"><i class="fa fa-check"></i><b>13.5.1</b> First path starting with the <code>fetch_symbols_to_start/0</code> function</a></li>
<li class="chapter" data-level="13.5.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#second-path-starting-with-the-update_status2"><i class="fa fa-check"></i><b>13.5.2</b> Second path starting with the <code>update_status/2</code></a></li>
<li class="chapter" data-level="13.5.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#third-path-starting-with-the-get_pid1-function"><i class="fa fa-check"></i><b>13.5.3</b> Third path starting with the <code>get_pid/1</code> function</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#remove-boilerplate-using-use-macro"><i class="fa fa-check"></i><b>13.6</b> Remove boilerplate using <code>use</code> macro</a></li>
<li class="chapter" data-level="13.7" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#use-the-core.servicesupervisor-module-inside-the-streamer-application"><i class="fa fa-check"></i><b>13.7</b> Use the <code>Core.ServiceSupervisor</code> module inside the <code>streamer</code> application</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html"><i class="fa fa-check"></i><b>14</b> Store trade events and orders inside the database</a>
<ul>
<li class="chapter" data-level="14.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#objectives-13"><i class="fa fa-check"></i><b>14.1</b> Objectives</a></li>
<li class="chapter" data-level="14.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#overview-of-requirements-1"><i class="fa fa-check"></i><b>14.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="14.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-data_warehouse-application-in-the-umbrella"><i class="fa fa-check"></i><b>14.3</b> Create a new <code>data_warehouse</code> application in the umbrella</a></li>
<li class="chapter" data-level="14.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#connect-to-the-database-using-ecto"><i class="fa fa-check"></i><b>14.4</b> Connect to the database using Ecto</a></li>
<li class="chapter" data-level="14.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-trade-events-data"><i class="fa fa-check"></i><b>14.5</b> Store trade events‚Äô data</a></li>
<li class="chapter" data-level="14.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-orders-data"><i class="fa fa-check"></i><b>14.6</b> Store orders‚Äô data</a></li>
<li class="chapter" data-level="14.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#implement-supervision"><i class="fa fa-check"></i><b>14.7</b> Implement supervision</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-subscriber_settings-table"><i class="fa fa-check"></i><b>14.7.1</b> Create <code>subscriber_settings</code> table</a></li>
<li class="chapter" data-level="14.7.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#redesign-supervision-using-registry"><i class="fa fa-check"></i><b>14.7.2</b> Redesign supervision using Registry</a></li>
<li class="chapter" data-level="14.7.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-the-datawarehouse.subscriber.dynamicsupervisor-module"><i class="fa fa-check"></i><b>14.7.3</b> Create the <code>DataWarehouse.Subscriber.DynamicSupervisor</code> module</a></li>
<li class="chapter" data-level="14.7.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#register-worker-processes-using-via"><i class="fa fa-check"></i><b>14.7.4</b> Register Worker processes using :via</a></li>
<li class="chapter" data-level="14.7.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-supervision-level-for-registry-task-and-the-dynamicsupervisor"><i class="fa fa-check"></i><b>14.7.5</b> Create a new supervision level for Registry, Task and the DynamicSupervisor</a></li>
<li class="chapter" data-level="14.7.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#link-the-subscribersupervisor-to-the-application"><i class="fa fa-check"></i><b>14.7.6</b> Link the <code>SubscriberSupervisor</code> to the <code>Application</code></a></li>
<li class="chapter" data-level="14.7.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#add-interface"><i class="fa fa-check"></i><b>14.7.7</b> Add interface</a></li>
<li class="chapter" data-level="14.7.8" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#test"><i class="fa fa-check"></i><b>14.7.8</b> Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html"><i class="fa fa-check"></i><b>15</b> Backtest trading strategy</a>
<ul>
<li class="chapter" data-level="15.1" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#objectives-14"><i class="fa fa-check"></i><b>15.1</b> Objectives</a></li>
<li class="chapter" data-level="15.2" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#overview-of-requirements-2"><i class="fa fa-check"></i><b>15.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="15.3" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#implement-the-storing-task"><i class="fa fa-check"></i><b>15.3</b> Implement the storing task</a></li>
<li class="chapter" data-level="15.4" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#test-the-backtesting"><i class="fa fa-check"></i><b>15.4</b> Test the backtesting</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.bookdown.org/" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Create a cryptocurrency trading bot in Elixir</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="fine-tune-trading-strategy-per-symbol" class="section level1" number="10">
<h1><span class="header-section-number">Chapter 10</span> Fine-tune trading strategy per symbol</h1>
<div id="objectives-9" class="section level2" number="10.1">
<h2><span class="header-section-number">10.1</span> Objectives</h2>
<ul>
<li>describe and design the required functionality</li>
<li>add docker to project</li>
<li>set up <code>ecto</code> inside the <code>naive</code> app</li>
<li>create and migrate the DB</li>
<li>seed symbols‚Äô settings</li>
<li>update the <code>Naive.Leader</code> to fetch settings</li>
</ul>
</div>
<div id="describe-and-design-the-required-functionality-1" class="section level2" number="10.2">
<h2><span class="header-section-number">10.2</span> Describe and design the required functionality</h2>
<p>At this moment the settings of our naive strategy are hardcoded inside the <code>Naive.Leader</code>:</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb125-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/naive/lib/naive/leader.ex</span></span>
<span id="cb125-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb125-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> fetch_symbol_settings(symbol) <span class="kw">do</span></span>
<span id="cb125-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-4" aria-hidden="true" tabindex="-1"></a>    symbol_filters <span class="op">=</span> fetch_symbol_filters(symbol)</span>
<span id="cb125-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb125-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Map</span><span class="op">.</span>merge(</span>
<span id="cb125-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-7" aria-hidden="true" tabindex="-1"></a>      %{</span>
<span id="cb125-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">symbol:</span> symbol,                           <span class="co"># &lt;=</span></span>
<span id="cb125-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-9" aria-hidden="true" tabindex="-1"></a>        <span class="va">chunks:</span> <span class="dv">5</span>,                                <span class="co"># &lt;=</span></span>
<span id="cb125-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-10" aria-hidden="true" tabindex="-1"></a>        <span class="va">budget:</span> <span class="cn">Decimal</span><span class="op">.</span>new(<span class="st">&quot;100&quot;</span>),               <span class="co"># &lt;=</span></span>
<span id="cb125-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">buy_down_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>new(<span class="st">&quot;0.0001&quot;</span>), <span class="co"># &lt;= all of those settings</span></span>
<span id="cb125-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-12" aria-hidden="true" tabindex="-1"></a>        <span class="co"># -0.12% for quick testing                # &lt;=</span></span>
<span id="cb125-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-13" aria-hidden="true" tabindex="-1"></a>        <span class="va">profit_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>new(<span class="st">&quot;-0.0012&quot;</span>),  <span class="co"># &lt;=</span></span>
<span id="cb125-14"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-14" aria-hidden="true" tabindex="-1"></a>        <span class="va">rebuy_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>new(<span class="st">&quot;0.001&quot;</span>)      <span class="co"># &lt;=</span></span>
<span id="cb125-15"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-15" aria-hidden="true" tabindex="-1"></a>      },</span>
<span id="cb125-16"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-16" aria-hidden="true" tabindex="-1"></a>      symbol_filters</span>
<span id="cb125-17"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-17" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb125-18"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-18" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb125-19"><a href="fine-tune-trading-strategy-per-symbol.html#cb125-19" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<p>The problem about those is that they are hardcoded and there‚Äôs no flexibility to define them per symbol at the moment.</p>
<p>In this chapter, we will move them out from this file into the Postgres database.</p>
</div>
<div id="add-docker-to-project" class="section level2" number="10.3">
<h2><span class="header-section-number">10.3</span> Add docker to project</h2>
<p>The requirements for this section are <code>docker</code> and <code>docker-compose</code> installed in your system.</p>
<p>Inside the main directory of our project create a new file called <code>docker-compose.yml</code> and fill it with below details:</p>
<pre><code># /docker-compose.yml
version: &quot;3.2&quot;
services:
  db:
    image: postgres:latest
    restart: always
    environment:
      POSTGRES_PASSWORD: &quot;postgres&quot;
    ports:
      - 5432:5432
    volumes:
      - ../postgres-data:/var/lib/postgresql/data</code></pre>
<p>If you are new to docker here‚Äôs the gist of what the above will do:
- it will start a single service called ‚Äúdb‚Äù
- ‚Äúdb‚Äù service will use the <code>latest</code> version of the <code>postgres</code> (image) inside the docker container (<code>latest</code> version as tagged per <a href="https://hub.docker.com/_/postgres/" class="uri">https://hub.docker.com/_/postgres/</a>)
- we map TCP port 5432 in the container to port 5432 on the Docker host(format container_port:hosts_port)
- we set up environmental variable inside the docker container that will be used by the Postgres app as a password for the default (<code>postgres</code>) user
- <code>volumes</code> option maps the directory from inside of the container to the host. This way we will keep the state of the database between restarts.</p>
<p>We can now start the service using <code>docker-compose</code>:</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb127-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker-compose up <span class="at">-d</span></span>
<span id="cb127-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb127-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Creating</span> hedgehog_db_1 ... done</span></code></pre></div>
<p>To validate that it works we can run:</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb128-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb128-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker ps <span class="at">-a</span></span>
<span id="cb128-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="ex">CONTAINER</span> ID   IMAGE             COMMAND                  CREATED         STATUS         PORTS                    NAMES</span>
<span id="cb128-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="ex">98558827b80b</span>   postgres:latest   <span class="st">&quot;docker-entrypoint.s√¢‚Ç¨¬¶&quot;</span>   4 seconds ago   Up 4 seconds   0.0.0.0:5432-<span class="op">&gt;</span>5432/tcp   hedgehog_db_1</span></code></pre></div>
</div>
<div id="set-up-ecto-inside-the-naive-app" class="section level2" number="10.4">
<h2><span class="header-section-number">10.4</span> Set up <code>ecto</code> inside the <code>naive</code> app</h2>
<p>Let‚Äôs start by adding database access to the <code>naive</code> application. The first step is to add the <a href="https://github.com/elixir-ecto/ecto">Ecto</a> module together with the <a href="https://github.com/elixir-ecto/postgrex">Postgrex</a> ecto‚Äôs driver package to the <code>deps</code> function inside the <code>mix.exs</code> file. As we are going to use Enums inside Postgres, we need to add the <a href="https://github.com/gjaldon/ecto_enum">EctoEnum</a> module as well:</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb129-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/naive/mix.exs</span></span>
<span id="cb129-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb129-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb129-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-4" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:binance</span>, <span class="st">&quot;~&gt; 0.7.1&quot;</span>},</span>
<span id="cb129-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-5" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:binance_mock</span>, <span class="va">in_umbrella:</span> <span class="cn">true</span>},</span>
<span id="cb129-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-6" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:decimal</span>, <span class="st">&quot;~&gt; 2.0&quot;</span>},</span>
<span id="cb129-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-7" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:ecto_sql</span>, <span class="st">&quot;~&gt; 3.0&quot;</span>},     <span class="co"># &lt;= New line</span></span>
<span id="cb129-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-8" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:ecto_enum</span>, <span class="st">&quot;~&gt; 1.4&quot;</span>},    <span class="co"># &lt;= New line</span></span>
<span id="cb129-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-9" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:phoenix_pubsub</span>, <span class="st">&quot;~&gt; 2.0&quot;</span>},</span>
<span id="cb129-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-10" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:postgrex</span>, <span class="st">&quot;&gt;= 0.0.0&quot;</span>},   <span class="co"># &lt;= New line</span></span>
<span id="cb129-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-11" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:streamer</span>, <span class="va">in_umbrella:</span> <span class="cn">true</span>}</span>
<span id="cb129-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-12" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb129-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb129-13" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>Remember about installing those deps using:</p>
<div class="sourceCode" id="cb130"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb130-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb130-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mix deps.get</span></code></pre></div>
<p>We can now use the ecto generator to add an the ecto repository to the Naive application:</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb131-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd apps/naive</span>
<span id="cb131-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mix ecto.gen.repo <span class="at">-r</span> Naive.Repo</span>
<span id="cb131-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-3" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> creating lib/naive</span>
<span id="cb131-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-4" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> creating lib/naive/repo.ex</span>
<span id="cb131-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-5" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> updating ../../config/config.exs</span>
<span id="cb131-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Don</span><span class="st">&#39;t forget to add your new repo to your supervision tree</span></span>
<span id="cb131-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-7" aria-hidden="true" tabindex="-1"></a><span class="st">(typically in lib/naive/application.ex):</span></span>
<span id="cb131-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-9" aria-hidden="true" tabindex="-1"></a><span class="st">    {Naive.Repo, []}</span></span>
<span id="cb131-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-11" aria-hidden="true" tabindex="-1"></a><span class="st">And to add it to the list of Ecto repositories in your</span></span>
<span id="cb131-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-12" aria-hidden="true" tabindex="-1"></a><span class="st">configuration files (so Ecto tasks work as expected):</span></span>
<span id="cb131-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb131-14"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-14" aria-hidden="true" tabindex="-1"></a><span class="st">    config :naive,</span></span>
<span id="cb131-15"><a href="fine-tune-trading-strategy-per-symbol.html#cb131-15" aria-hidden="true" tabindex="-1"></a><span class="st">      ecto_repos: [Naive.Repo]</span></span></code></pre></div>
<p>Back to the IDE, the generator updated our <code>config/config.exs</code> file with the default access details to the database, we need to modify them to point to our Postgres docker instance as well as add a list of ecto repositories for our naive app (as per instruction above):</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb132-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb132-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-2" aria-hidden="true" tabindex="-1"></a>config <span class="va">:naive</span>,                <span class="co"># &lt;= added line</span></span>
<span id="cb132-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">ecto_repos:</span> [<span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span>],   <span class="co"># &lt;= added line</span></span>
<span id="cb132-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">binance_client:</span> <span class="cn">BinanceMock</span> <span class="co"># &lt;= merged from existing config</span></span>
<span id="cb132-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb132-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-6" aria-hidden="true" tabindex="-1"></a>config <span class="va">:naive</span>, <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span>,</span>
<span id="cb132-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">database:</span> <span class="st">&quot;naive&quot;</span>,    <span class="co"># &lt;= updated</span></span>
<span id="cb132-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">username:</span> <span class="st">&quot;postgres&quot;</span>, <span class="co"># &lt;= updated</span></span>
<span id="cb132-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">password:</span> <span class="st">&quot;postgres&quot;</span>, <span class="co"># &lt;= updated</span></span>
<span id="cb132-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb132-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">hostname:</span> <span class="st">&quot;localhost&quot;</span></span></code></pre></div>
<p>Here we can use <code>localhost</code> as inside the <code>docker-compose.yml</code> file we defined port forwarding from the container to the host(Postgres is available at localhost:5432). We also merged the existing <code>binance_client</code> setting together with the new <code>ecto_repos</code> setting.</p>
<p>The last step to be able to communicate with the database using <code>Ecto</code> will be to add the <code>Naive.Repo</code> module(created by generator) to the children list of the <code>Naive.Application</code>:</p>
<div class="sourceCode" id="cb133"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb133-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/lib/naive/application.ex</span></span>
<span id="cb133-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb133-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start(_type, _args) <span class="kw">do</span></span>
<span id="cb133-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-4" aria-hidden="true" tabindex="-1"></a>    children <span class="op">=</span> [</span>
<span id="cb133-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-5" aria-hidden="true" tabindex="-1"></a>      {<span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span>, []}, <span class="co"># &lt;= added line</span></span>
<span id="cb133-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-6" aria-hidden="true" tabindex="-1"></a>      {</span>
<span id="cb133-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-7" aria-hidden="true" tabindex="-1"></a>        <span class="cn">DynamicSupervisor</span>,</span>
<span id="cb133-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-8" aria-hidden="true" tabindex="-1"></a>        <span class="va">strategy:</span> <span class="va">:one_for_one</span>, <span class="va">name:</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">DynamicSymbolSupervisor</span></span>
<span id="cb133-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-9" aria-hidden="true" tabindex="-1"></a>      }</span>
<span id="cb133-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-10" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb133-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb133-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
</div>
<div id="create-and-migrate-the-db" class="section level2" number="10.5">
<h2><span class="header-section-number">10.5</span> Create and migrate the DB</h2>
<p>We can now create a new naive database using the <code>mix</code> tool, after that we will be able to generate a migration file that will create the <code>settings</code> table:</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb134-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb134-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mix ecto.create <span class="at">-r</span> Naive.Repo</span>
<span id="cb134-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb134-2" aria-hidden="true" tabindex="-1"></a><span class="ex">The</span> database for Naive.Repo has been created</span>
<span id="cb134-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb134-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd apps/naive</span>
<span id="cb134-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb134-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mix ecto.gen.migration create_settings</span>
<span id="cb134-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb134-5" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> creating priv/repo/migrations</span>
<span id="cb134-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb134-6" aria-hidden="true" tabindex="-1"></a><span class="ex">*</span> creating priv/repo/migrations/20210202223209_create_settings.exs</span></code></pre></div>
<p>We can now copy the current hardcoded settings from the <code>Naive.Leader</code> module and use them as a column list of our new <code>settings</code> table. All of the below alterations needs to be done inside the <code>change</code> function of our migration file:</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb135-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/repo/migrations/20210202223209_create_settings.exs</span></span>
<span id="cb135-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb135-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> change <span class="kw">do</span></span>
<span id="cb135-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-4" aria-hidden="true" tabindex="-1"></a>    create table(<span class="va">:settings</span>) <span class="kw">do</span></span>
<span id="cb135-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-5" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:symbol</span>, <span class="va">:text</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb135-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-6" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:chunks</span>, <span class="va">:integer</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb135-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-7" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:budget</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb135-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-8" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:buy_down_interval</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb135-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-9" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:profit_interval</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb135-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-10" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:rebuy_interval</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb135-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-11" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb135-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb135-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>At this moment we just copied the settings and converted them to columns using the <code>add</code> function. We need now to take care of the <code>id</code> column. We need to pass <code>primary_key: false</code> to the <code>create table</code> macro to stop it from creating the default integer-based <code>id</code> column. Instead of that we will define the <code>id</code> column ourselves with <code>:uuid</code> type and pass a flag that will indicate that it‚Äôs the primary key of the <code>settings</code> table:</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb136-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb136-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/repo/migrations/20210202223209_create_settings.exs</span></span>
<span id="cb136-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb136-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb136-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb136-3" aria-hidden="true" tabindex="-1"></a>    create table(<span class="va">:settings</span>, <span class="va">primary_key:</span> <span class="cn">false</span>) <span class="kw">do</span></span>
<span id="cb136-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb136-4" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:id</span>, <span class="va">:uuid</span>, <span class="va">primary_key:</span> <span class="cn">true</span>)</span>
<span id="cb136-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb136-5" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span></code></pre></div>
<p>We will also add create and update timestamps that come as a bundle when using the <code>timestamps()</code> function inside the <code>create table</code> macro:</p>
<div class="sourceCode" id="cb137"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb137-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/repo/migrations/20210202223209_create_settings.exs</span></span>
<span id="cb137-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb137-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-3" aria-hidden="true" tabindex="-1"></a>    create table(<span class="op">...</span>) <span class="kw">do</span></span>
<span id="cb137-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb137-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb137-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-6" aria-hidden="true" tabindex="-1"></a>      timestamps() <span class="co"># &lt;= both create and update timestamps</span></span>
<span id="cb137-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-7" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb137-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb137-8" aria-hidden="true" tabindex="-1"></a>    <span class="op">...</span></span></code></pre></div>
<p>We will add a unique index on the symbol column to avoid any possible duplicates:</p>
<div class="sourceCode" id="cb138"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb138-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/repo/migrations/20210202223209_create_settings.exs</span></span>
<span id="cb138-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb138-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-3" aria-hidden="true" tabindex="-1"></a>    create table(<span class="op">...</span>) <span class="kw">do</span></span>
<span id="cb138-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-4" aria-hidden="true" tabindex="-1"></a>      <span class="op">...</span></span>
<span id="cb138-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-5" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb138-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb138-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-7" aria-hidden="true" tabindex="-1"></a>    create(unique_index(<span class="va">:settings</span>, [<span class="va">:symbol</span>]))</span>
<span id="cb138-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-8" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb138-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb138-9" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span></code></pre></div>
<p>We will now add the <code>status</code> field which will be an Enum. It will be defined inside a separate file and <code>alias</code>‚Äôed from our migration, this way we will be able to use it from within the migration and the inside the <code>lib</code> code. First, we will apply changes to our migration and then we will move on to creating the Enum module.
Here‚Äôs the full implementation of migration for reference:</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb139-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/repo/migrations/20210202223209_create_settings.exs</span></span>
<span id="cb139-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span><span class="op">.</span><span class="cn">Migrations</span><span class="op">.</span><span class="cn">CreateSettings</span> <span class="kw">do</span></span>
<span id="cb139-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">use</span> <span class="cn">Ecto</span><span class="op">.</span><span class="cn">Migration</span></span>
<span id="cb139-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">TradingStatusEnum</span></span>
<span id="cb139-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> change <span class="kw">do</span></span>
<span id="cb139-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">TradingStatusEnum</span><span class="op">.</span>create_type()</span>
<span id="cb139-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-10" aria-hidden="true" tabindex="-1"></a>    create table(<span class="va">:settings</span>, <span class="va">primary_key:</span> <span class="cn">false</span>) <span class="kw">do</span></span>
<span id="cb139-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-11" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:id</span>, <span class="va">:uuid</span>, <span class="va">primary_key:</span> <span class="cn">true</span>)</span>
<span id="cb139-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-12" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:symbol</span>, <span class="va">:text</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-13" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:chunks</span>, <span class="va">:integer</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-14"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-14" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:budget</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-15"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-15" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:buy_down_interval</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-16"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-16" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:profit_interval</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-17"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-17" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:rebuy_interval</span>, <span class="va">:decimal</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-18"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-18" aria-hidden="true" tabindex="-1"></a>      add(<span class="va">:status</span>, <span class="cn">TradingStatusEnum</span><span class="op">.</span>type(), <span class="va">default:</span> <span class="st">&quot;off&quot;</span>, <span class="va">null:</span> <span class="cn">false</span>)</span>
<span id="cb139-19"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-19" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb139-20"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-20" aria-hidden="true" tabindex="-1"></a>      timestamps()</span>
<span id="cb139-21"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-21" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb139-22"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb139-23"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-23" aria-hidden="true" tabindex="-1"></a>    create(unique_index(<span class="va">:settings</span>, [<span class="va">:symbol</span>]))</span>
<span id="cb139-24"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-24" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb139-25"><a href="fine-tune-trading-strategy-per-symbol.html#cb139-25" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>That finishes our work on the migration file. We will now focus on <code>TradingStatusEnum</code> implementation. First, we need to create a <code>schema</code> directory inside the <code>apps/naive/lib/naive</code> directory and file called <code>trading_status_enum.ex</code> and place below logic (defining the enum) in it:</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb140-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb140-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/lib/naive/schema/trading_status_enum.ex</span></span>
<span id="cb140-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb140-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="cn">EctoEnum</span></span>
<span id="cb140-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb140-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb140-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb140-4" aria-hidden="true" tabindex="-1"></a>defenum(<span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">TradingStatusEnum</span>, <span class="va">:trading_status</span>, [<span class="va">:on</span>, <span class="va">:off</span>])</span></code></pre></div>
<p>We used the <code>defenum</code> macro from the <code>ecto_enum</code> module to define our enum. It‚Äôs interesting to point out that we didn‚Äôt need to define a new module as <code>defenum</code> macro takes care of that for us.</p>
<p>Let‚Äôs run the migration to create the table, unique index, and the enum:</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb141-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mix ecto.migrate</span>
<span id="cb141-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb141-2" aria-hidden="true" tabindex="-1"></a><span class="ex">00:51:16.757</span> [info]  == Running 20210202223209 Naive.Repo.Migrations.CreateSettings.change/0 forward</span>
<span id="cb141-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb141-3" aria-hidden="true" tabindex="-1"></a><span class="ex">00:51:16.759</span> [info]  execute <span class="st">&quot;CREATE TYPE public.trading_status AS ENUM (&#39;on&#39;, &#39;off&#39;)&quot;</span></span>
<span id="cb141-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb141-4" aria-hidden="true" tabindex="-1"></a><span class="ex">00:51:16.760</span> [info]  create table settings</span>
<span id="cb141-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb141-5" aria-hidden="true" tabindex="-1"></a><span class="ex">00:51:16.820</span> [info]  create index settings_symbol_index</span>
<span id="cb141-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb141-6" aria-hidden="true" tabindex="-1"></a><span class="ex">00:51:16.829</span> [info]  == Migrated 20210202223209 in 0.0s</span></code></pre></div>
<p>We can now create a schema file for the <code>settings</code> table so inside the <code>/apps/naive/lib/naive/schema</code> create a file called <code>settings.ex</code>. We will start with a skeleton implementation of schema file together with the copied list of columns from the migration and convert to <code>ecto</code>‚Äôs types using it‚Äôs <a href="https://hexdocs.pm/ecto/Ecto.Schema.html#module-primitive-types">docs</a>:</p>
<div class="sourceCode" id="cb142"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb142-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/lib/naive/schema/settings.ex</span></span>
<span id="cb142-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">Settings</span> <span class="kw">do</span></span>
<span id="cb142-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">use</span> <span class="cn">Ecto</span><span class="op">.</span><span class="cn">Schema</span></span>
<span id="cb142-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-5" aria-hidden="true" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">TradingStatusEnum</span></span>
<span id="cb142-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-7" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@primary_key</span> {<span class="va">:id</span>, <span class="va">:binary_id</span>, <span class="va">autogenerate:</span> <span class="cn">true</span>}</span>
<span id="cb142-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-9" aria-hidden="true" tabindex="-1"></a>  schema <span class="st">&quot;settings&quot;</span> <span class="kw">do</span></span>
<span id="cb142-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-10" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:symbol</span>, <span class="va">:string</span>)</span>
<span id="cb142-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-11" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:chunks</span>, <span class="va">:integer</span>)</span>
<span id="cb142-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-12" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:budget</span>, <span class="va">:decimal</span>)</span>
<span id="cb142-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-13" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:buy_down_interval</span>, <span class="va">:decimal</span>)</span>
<span id="cb142-14"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-14" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:profit_interval</span>, <span class="va">:decimal</span>)</span>
<span id="cb142-15"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-15" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:rebuy_interval</span>, <span class="va">:decimal</span>)</span>
<span id="cb142-16"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-16" aria-hidden="true" tabindex="-1"></a>    field(<span class="va">:status</span>, <span class="cn">TradingStatusEnum</span>)</span>
<span id="cb142-17"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb142-18"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-18" aria-hidden="true" tabindex="-1"></a>    timestamps()</span>
<span id="cb142-19"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-19" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb142-20"><a href="fine-tune-trading-strategy-per-symbol.html#cb142-20" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="seed-symbols-settings" class="section level2" number="10.6">
<h2><span class="header-section-number">10.6</span> Seed symbols‚Äô settings</h2>
<p>So we have all the pieces of implementation to be able to create DB, migrate the <code>settings</code> table, and query it using Ecto. To be able to drop the hardcoded settings from the <code>Naive.Leader</code> we will need to fill our database with the ‚Äúdefault‚Äù setting for each symbol. To achieve that we will define default settings inside the <code>config/config.exs</code> file and we will create a seed script that will fetch all pairs from Binance and insert a new config row inside DB for each one.</p>
<p>Let‚Äôs start by adding those default values to the config file(we will merge them into the structure defining <code>binance_client</code> and <code>ecto_repos</code>):</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb143-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># config/config.exs</span></span>
<span id="cb143-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-2" aria-hidden="true" tabindex="-1"></a>config <span class="va">:naive</span>,</span>
<span id="cb143-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">ecto_repos:</span> [<span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span>],</span>
<span id="cb143-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">binance_client:</span> <span class="cn">BinanceMock</span>,</span>
<span id="cb143-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">trading:</span> %{</span>
<span id="cb143-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">defaults:</span> %{</span>
<span id="cb143-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">chunks:</span> <span class="dv">5</span>,</span>
<span id="cb143-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-8" aria-hidden="true" tabindex="-1"></a>      <span class="va">budget:</span> <span class="fl">1000.0</span>,</span>
<span id="cb143-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-9" aria-hidden="true" tabindex="-1"></a>      <span class="va">buy_down_interval:</span> <span class="fl">0.0001</span>,</span>
<span id="cb143-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-10" aria-hidden="true" tabindex="-1"></a>      <span class="va">profit_interval:</span> <span class="op">-</span><span class="fl">0.0012</span>,</span>
<span id="cb143-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-11" aria-hidden="true" tabindex="-1"></a>      <span class="va">rebuy_interval:</span> <span class="fl">0.001</span></span>
<span id="cb143-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-12" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb143-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb143-13" aria-hidden="true" tabindex="-1"></a>  }</span></code></pre></div>
<p>Moving on to the seeding script, we need to create a new file called <code>seed_settings.exs</code> inside the <code>/apps/naive/lib/naive/priv/</code> directory. Let‚Äôs start by aliasing the required modules and requiring the <code>Logger</code>:</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb144-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb144-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/seed_settings.exs</span></span>
<span id="cb144-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb144-2" aria-hidden="true" tabindex="-1"></a><span class="im">require</span> <span class="cn">Logger</span></span>
<span id="cb144-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb144-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb144-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb144-4" aria-hidden="true" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Decimal</span></span>
<span id="cb144-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb144-5" aria-hidden="true" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb144-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb144-6" aria-hidden="true" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">Settings</span></span></code></pre></div>
<p>Next, we will get the Binance client from the config:</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb145-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/seed_settings.exs</span></span>
<span id="cb145-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb145-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb145-3" aria-hidden="true" tabindex="-1"></a>binance_client <span class="op">=</span> <span class="cn">Application</span><span class="op">.</span>get_env(<span class="va">:naive</span>, <span class="va">:binance_client</span>)</span></code></pre></div>
<p>Now, it‚Äôs time to fetch all the symbols(pairs) that Binance supports:</p>
<div class="sourceCode" id="cb146"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb146-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb146-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/seed_settings.exs</span></span>
<span id="cb146-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb146-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb146-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb146-3" aria-hidden="true" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info(<span class="st">&quot;Fetching exchange info from Binance to create trading settings&quot;</span>)</span>
<span id="cb146-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb146-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb146-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb146-5" aria-hidden="true" tabindex="-1"></a>{<span class="va">:ok</span>, %{<span class="va">symbols:</span> symbols}} <span class="op">=</span> binance_client<span class="op">.</span>get_exchange_info()</span></code></pre></div>
<p>Now we need to fetch default trading settings from the config file as well as the current timestamp:</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb147-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/seed_settings.exs</span></span>
<span id="cb147-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb147-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-3" aria-hidden="true" tabindex="-1"></a>%{</span>
<span id="cb147-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">chunks:</span> chunks,</span>
<span id="cb147-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">budget:</span> budget,</span>
<span id="cb147-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">buy_down_interval:</span> buy_down_interval,</span>
<span id="cb147-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">profit_interval:</span> profit_interval,</span>
<span id="cb147-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">rebuy_interval:</span> rebuy_interval</span>
<span id="cb147-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-9" aria-hidden="true" tabindex="-1"></a>} <span class="op">=</span> <span class="cn">Application</span><span class="op">.</span>get_env(<span class="va">:naive</span>, <span class="va">:trading</span>)<span class="op">.</span>defaults</span>
<span id="cb147-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb147-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-11" aria-hidden="true" tabindex="-1"></a>timestamp <span class="op">=</span> <span class="cn">NaiveDateTime</span><span class="op">.</span>utc_now()</span>
<span id="cb147-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb147-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">|&gt;</span> <span class="cn">NaiveDateTime</span><span class="op">.</span>truncate(<span class="va">:second</span>)</span></code></pre></div>
<p>We will use the default settings for all rows to be able to insert data into the database. Normally we wouldn‚Äôt need to set <code>inserted_at</code> and <code>updated_at</code> fields as Ecto would generate those values for us when using <code>Repo.insert/2</code> but we won‚Äôt be able to use this functionality as it takes a <em>single</em> record at the time. We will be using <code>Repo.insert_all/3</code> which is a bit more low-level function without those nice features like filling timestamps(sadly). Just to be crystal clear - <code>Repo.insert/2</code> takes <em>at least a couple of seconds</em>(on my machine) for 1000+ symbols currently supported by Binance, on the other hand <code>Repo.insert_all/3</code>, will insert all of them in a couple of hundred milliseconds.</p>
<p>As our structs will differ by only the <code>symbol</code> column we can first create a full struct that will serve as a template:</p>
<div class="sourceCode" id="cb148"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb148-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/seed_settings.exs</span></span>
<span id="cb148-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb148-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-3" aria-hidden="true" tabindex="-1"></a>base_settings <span class="op">=</span> %{</span>
<span id="cb148-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">symbol:</span> <span class="st">&quot;&quot;</span>,</span>
<span id="cb148-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">chunks:</span> chunks,</span>
<span id="cb148-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">budget:</span> <span class="cn">Decimal</span><span class="op">.</span>from_float(budget),</span>
<span id="cb148-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">buy_down_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>from_float(buy_down_interval),</span>
<span id="cb148-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">profit_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>from_float(profit_interval),</span>
<span id="cb148-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">rebuy_interval:</span> <span class="cn">Decimal</span><span class="op">.</span>from_float(rebuy_interval),</span>
<span id="cb148-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">status:</span> <span class="st">&quot;off&quot;</span>,</span>
<span id="cb148-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">inserted_at:</span> timestamp,</span>
<span id="cb148-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-12" aria-hidden="true" tabindex="-1"></a>  <span class="va">updated_at:</span> timestamp</span>
<span id="cb148-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb148-13" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>We will now map each of the retrieved symbols and inject them to the <code>base_settings</code> structs and pushing all of those to the <code>Repo.insert_all/3</code> function:</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb149-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/priv/seed_settings.exs</span></span>
<span id="cb149-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-2" aria-hidden="true" tabindex="-1"></a><span class="op">...</span></span>
<span id="cb149-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-3" aria-hidden="true" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info(<span class="st">&quot;Inserting default settings for symbols&quot;</span>)</span>
<span id="cb149-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-5" aria-hidden="true" tabindex="-1"></a>maps <span class="op">=</span> symbols</span>
<span id="cb149-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">|&gt;</span> <span class="cn">Enum</span><span class="op">.</span>map(<span class="op">&amp;</span>(%{base_settings <span class="op">|</span> <span class="va">symbol:</span> <span class="op">&amp;</span><span class="dv">1</span>[<span class="st">&quot;symbol&quot;</span>]}))</span>
<span id="cb149-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-8" aria-hidden="true" tabindex="-1"></a>{count, <span class="cn">nil</span>} <span class="op">=</span> <span class="cn">Repo</span><span class="op">.</span>insert_all(<span class="cn">Settings</span>, maps)</span>
<span id="cb149-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb149-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb149-10" aria-hidden="true" tabindex="-1"></a><span class="cn">Logger</span><span class="op">.</span>info(<span class="st">&quot;Inserted settings for </span><span class="ot">#{</span>count<span class="ot">}</span><span class="st"> symbols&quot;</span>)</span></code></pre></div>
</div>
<div id="update-the-naive.leader-to-fetch-settings" class="section level2" number="10.7">
<h2><span class="header-section-number">10.7</span> Update the <code>Naive.Leader</code> to fetch settings</h2>
<p>The final step will be to update the <code>Naive.Leader</code> to fetch the settings from the database. At the top of the module add the following:</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb150-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/lib/naive/leader.ex</span></span>
<span id="cb150-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb150-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb150-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb150-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Repo</span></span>
<span id="cb150-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb150-4" aria-hidden="true" tabindex="-1"></a>  <span class="im">alias</span> <span class="cn">Naive</span><span class="op">.</span><span class="cn">Schema</span><span class="op">.</span><span class="cn">Settings</span></span>
<span id="cb150-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb150-5" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<p>Now we need to modify the <code>fetch_symbol_settings/1</code> to fetch settings from DB instead of the hardcoded map. We will use <code>Repo.get_by!/3</code> as we are unable to trade without settings. The second trick used here is <code>Map.from_struct/1</code> that is required here as otherwise result would become the <code>Naive.Schema.Settings</code> struct(this would cause problems further down the line as we are iterating on the returned map and would get the <code>protocol Enumerable not implemented for %Naive.Schema.Settings</code> error):</p>
<div class="sourceCode" id="cb151"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb151-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/naive/lib/naive/leader.ex</span></span>
<span id="cb151-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-2" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span>
<span id="cb151-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-3" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> fetch_symbol_settings(symbol) <span class="kw">do</span></span>
<span id="cb151-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-4" aria-hidden="true" tabindex="-1"></a>    symbol_filters <span class="op">=</span> fetch_symbol_filters(symbol)</span>
<span id="cb151-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-5" aria-hidden="true" tabindex="-1"></a>    settings <span class="op">=</span> <span class="cn">Repo</span><span class="op">.</span>get_by!(<span class="cn">Settings</span>, <span class="va">symbol:</span> symbol)</span>
<span id="cb151-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb151-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-7" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Map</span><span class="op">.</span>merge(</span>
<span id="cb151-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-8" aria-hidden="true" tabindex="-1"></a>      symbol_filters,</span>
<span id="cb151-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-9" aria-hidden="true" tabindex="-1"></a>      settings <span class="op">|&gt;</span> <span class="cn">Map</span><span class="op">.</span>from_struct()</span>
<span id="cb151-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb151-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-11" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb151-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb151-12" aria-hidden="true" tabindex="-1"></a>  <span class="op">...</span></span></code></pre></div>
<p>We can now run the seeding script to fill our database with the default settings:</p>
<div class="sourceCode" id="cb152"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb152-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd apps/naive</span>
<span id="cb152-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb152-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mix run priv/seed_settings.exs</span>
<span id="cb152-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb152-3" aria-hidden="true" tabindex="-1"></a><span class="ex">18:52:29.341</span> [info]  Fetching exchange info from Binance to create trading settings</span>
<span id="cb152-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb152-4" aria-hidden="true" tabindex="-1"></a><span class="ex">18:52:31.571</span> [info]  Inserting default settings for symbols</span>
<span id="cb152-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb152-5" aria-hidden="true" tabindex="-1"></a><span class="ex">18:52:31.645</span> [info]  Inserted settings for 1276 symbols</span></code></pre></div>
<p>We can verify that records were indeed inserted into the database by connecting to it using the <code>psql</code> application:</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb153-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> psql <span class="at">-Upostgres</span> <span class="at">-hlocalhost</span></span>
<span id="cb153-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Password</span> for user postgres: <span class="co"># &lt;= use &#39;postgres&#39; password here </span></span>
<span id="cb153-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-3" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb153-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-4" aria-hidden="true" tabindex="-1"></a><span class="va">postgres=</span># <span class="ex">\c</span> naive</span>
<span id="cb153-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-5" aria-hidden="true" tabindex="-1"></a><span class="ex">You</span> are now connected to database <span class="st">&quot;naive&quot;</span> as user <span class="st">&quot;postgres&quot;</span>.</span>
<span id="cb153-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-6" aria-hidden="true" tabindex="-1"></a><span class="va">naive=</span># <span class="ex">\x</span></span>
<span id="cb153-7"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-7" aria-hidden="true" tabindex="-1"></a><span class="ex">Expanded</span> display is on.</span>
<span id="cb153-8"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-8" aria-hidden="true" tabindex="-1"></a><span class="va">naive=</span># <span class="ex">SELECT</span> <span class="pp">*</span> FROM settings<span class="kw">;</span></span>
<span id="cb153-9"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-9" aria-hidden="true" tabindex="-1"></a><span class="ex">-[</span> RECORD 1 ]-----+-------------------------------------</span>
<span id="cb153-10"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-10" aria-hidden="true" tabindex="-1"></a><span class="fu">id</span>                <span class="kw">|</span> <span class="ex">159c8f32-d571-47b2-b9d7-38bb42868043</span></span>
<span id="cb153-11"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-11" aria-hidden="true" tabindex="-1"></a><span class="ex">symbol</span>            <span class="kw">|</span> <span class="ex">ETHUSDT</span></span>
<span id="cb153-12"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-12" aria-hidden="true" tabindex="-1"></a><span class="ex">chunks</span>            <span class="kw">|</span> <span class="ex">5</span></span>
<span id="cb153-13"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-13" aria-hidden="true" tabindex="-1"></a><span class="ex">budget</span>            <span class="kw">|</span> <span class="ex">1000</span></span>
<span id="cb153-14"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-14" aria-hidden="true" tabindex="-1"></a><span class="ex">buy_down_interval</span> <span class="kw">|</span> <span class="ex">0.0001</span></span>
<span id="cb153-15"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-15" aria-hidden="true" tabindex="-1"></a><span class="ex">profit_interval</span>   <span class="kw">|</span> <span class="ex">-0.0012</span></span>
<span id="cb153-16"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-16" aria-hidden="true" tabindex="-1"></a><span class="ex">rebuy_interval</span>    <span class="kw">|</span> <span class="ex">0.001</span></span>
<span id="cb153-17"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-17" aria-hidden="true" tabindex="-1"></a><span class="ex">status</span>            <span class="kw">|</span> <span class="ex">off</span></span>
<span id="cb153-18"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-18" aria-hidden="true" tabindex="-1"></a><span class="ex">inserted_at</span>       <span class="kw">|</span> <span class="ex">2021-02-02</span> 18:52:31</span>
<span id="cb153-19"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-19" aria-hidden="true" tabindex="-1"></a><span class="ex">updated_at</span>        <span class="kw">|</span> <span class="ex">2021-02-02</span> 18:52:31</span>
<span id="cb153-20"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-21"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-21" aria-hidden="true" tabindex="-1"></a><span class="co"># press arrows to scroll, otherwise press `q`</span></span>
<span id="cb153-22"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-23"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-23" aria-hidden="true" tabindex="-1"></a><span class="va">naive=</span># <span class="ex">SELECT</span> COUNT<span class="er">(</span><span class="ex">*</span><span class="kw">)</span> <span class="ex">FROM</span> settings<span class="kw">;</span></span>
<span id="cb153-24"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-24" aria-hidden="true" tabindex="-1"></a><span class="ex">-[</span> RECORD 1 ]</span>
<span id="cb153-25"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-25" aria-hidden="true" tabindex="-1"></a><span class="ex">count</span> <span class="kw">|</span> <span class="ex">1276</span></span>
<span id="cb153-26"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb153-27"><a href="fine-tune-trading-strategy-per-symbol.html#cb153-27" aria-hidden="true" tabindex="-1"></a><span class="va">naive=</span># <span class="ex">\q</span> <span class="co"># &lt;= to close the `psql`</span></span></code></pre></div>
<p>That confirms that there are 1276 settings inside the database that will allow us to continue trading which we can check by running our app inside <code>iex</code>(from the main project‚Äôs directory):</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb154-1"><a href="fine-tune-trading-strategy-per-symbol.html#cb154-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> iex <span class="at">-S</span> mix</span>
<span id="cb154-2"><a href="fine-tune-trading-strategy-per-symbol.html#cb154-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb154-3"><a href="fine-tune-trading-strategy-per-symbol.html#cb154-3" aria-hidden="true" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="op">&gt;</span> Naive.start_trading<span class="kw">(</span><span class="st">&quot;NEOUSDT&quot;</span><span class="kw">)</span></span>
<span id="cb154-4"><a href="fine-tune-trading-strategy-per-symbol.html#cb154-4" aria-hidden="true" tabindex="-1"></a><span class="ex">19:20:02.936</span> [info]  Starting new supervision tree to trade on NEOUSDT</span>
<span id="cb154-5"><a href="fine-tune-trading-strategy-per-symbol.html#cb154-5" aria-hidden="true" tabindex="-1"></a><span class="ex">{:ok,</span> <span class="co">#PID&lt;0.378.0&gt;}</span></span>
<span id="cb154-6"><a href="fine-tune-trading-strategy-per-symbol.html#cb154-6" aria-hidden="true" tabindex="-1"></a><span class="ex">19:20:04.584</span> [info]  Initializing new trader<span class="er">(</span><span class="ex">1612293637000</span><span class="kw">)</span> <span class="cf">for</span> NEOUSDT</span></code></pre></div>
<p>The above log messages confirm that the <code>Naive.Leader</code> was able to fetch settings from the database that were later put into the <code>Naive.Trader</code>‚Äôs state and passed to it.</p>
<p>[Note] Please remember to run <code>mix format</code> to keep things nice and tidy.</p>
<p>Source code for this chapter can be found at <a href="https://github.com/frathon/create-a-cryptocurrency-trading-bot-in-elixir-source-code/tree/chapter_10">Github</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="run-multiple-traders-in-parallel.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="supervise-and-autostart-streaming.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/frathon/create-a-cryptocurrency-trading-bot-in-elixir/edit/main/10-fine-tune-trading-strategy.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["create-a-cryptocurrency-trading-bot-in-elixir.pdf", "create-a-cryptocurrency-trading-bot-in-elixir.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
