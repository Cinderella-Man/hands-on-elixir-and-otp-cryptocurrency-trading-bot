<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 1 Stream live crypto prices from Binance WSS | Create a cryptocurrency trading bot in Elixir</title>
  <meta name="description" content="Chapter 1 Stream live crypto prices from Binance WSS | Create a cryptocurrency trading bot in Elixir" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 1 Stream live crypto prices from Binance WSS | Create a cryptocurrency trading bot in Elixir" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="images/cover.png" />
  
  <meta name="github-repo" content="frathon/create-a-cryptocurrency-trading-bot-in-elixir" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 1 Stream live crypto prices from Binance WSS | Create a cryptocurrency trading bot in Elixir" />
  
  
  <meta name="twitter:image" content="images/cover.png" />

<meta name="author" content="Kamil Skowron" />


<meta name="date" content="2021-04-19" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-52FKGBX2B8"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-52FKGBX2B8');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Create a cryptocurrency trading bot in Elixir</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome 👋</a>
<ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#limit-of-liabilitydisclaimer-of-warranty"><i class="fa fa-check"></i>Limit of Liability/Disclaimer of Warranty</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#contributing-errata"><i class="fa fa-check"></i>Contributing / Errata</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#preface"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#who-this-book-is-for"><i class="fa fa-check"></i>Who this book is for</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#what-this-book-covers"><i class="fa fa-check"></i>What this book covers</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#source-code"><i class="fa fa-check"></i>Source code</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html"><i class="fa fa-check"></i><b>1</b> Stream live crypto prices from Binance WSS</a>
<ul>
<li class="chapter" data-level="1.1" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#objectives"><i class="fa fa-check"></i><b>1.1</b> Objectives</a></li>
<li class="chapter" data-level="1.2" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#create-an-umbrella-app"><i class="fa fa-check"></i><b>1.2</b> Create an umbrella app</a></li>
<li class="chapter" data-level="1.3" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#create-a-supervised-application-inside-an-umbrella"><i class="fa fa-check"></i><b>1.3</b> Create a supervised application inside an umbrella</a></li>
<li class="chapter" data-level="1.4" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#connect-to-binances-websocket-stream-using-the-websockex-module"><i class="fa fa-check"></i><b>1.4</b> Connect to Binance’s WebSocket Stream using the WebSockex module</a></li>
<li class="chapter" data-level="1.5" data-path="stream-live-crypto-prices-from-binance-wss.html"><a href="stream-live-crypto-prices-from-binance-wss.html#decode-incoming-events-using-the-jason-module"><i class="fa fa-check"></i><b>1.5</b> Decode incoming events using the Jason module</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><i class="fa fa-check"></i><b>2</b> Create a naive trading strategy - a single trader process without supervision</a>
<ul>
<li class="chapter" data-level="2.1" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#objectives-1"><i class="fa fa-check"></i><b>2.1</b> Objectives</a></li>
<li class="chapter" data-level="2.2" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#initializiation"><i class="fa fa-check"></i><b>2.2</b> Initializiation</a></li>
<li class="chapter" data-level="2.3" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#how-trading-strategy-will-work"><i class="fa fa-check"></i><b>2.3</b> How trading strategy will work?</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-of-the-first-scenario"><i class="fa fa-check"></i><b>2.3.1</b> Implementation of the first scenario</a></li>
<li class="chapter" data-level="2.3.2" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-of-the-second-scenario"><i class="fa fa-check"></i><b>2.3.2</b> Implementation of the second scenario</a></li>
<li class="chapter" data-level="2.3.3" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-of-the-third-scenario"><i class="fa fa-check"></i><b>2.3.3</b> Implementation of the third scenario</a></li>
<li class="chapter" data-level="2.3.4" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#implementation-fallback-scenario"><i class="fa fa-check"></i><b>2.3.4</b> Implementation fallback scenario</a></li>
<li class="chapter" data-level="2.3.5" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#updating-the-naive-interface"><i class="fa fa-check"></i><b>2.3.5</b> Updating the Naive interface</a></li>
<li class="chapter" data-level="2.3.6" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#updating-streamer-app"><i class="fa fa-check"></i><b>2.3.6</b> Updating streamer app</a></li>
<li class="chapter" data-level="2.3.7" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#access-details-to-binance"><i class="fa fa-check"></i><b>2.3.7</b> Access details to Binance</a></li>
<li class="chapter" data-level="2.3.8" data-path="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html"><a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html#test-run"><i class="fa fa-check"></i><b>2.3.8</b> Test run</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html"><i class="fa fa-check"></i><b>3</b> Introduce PubSub as a communication method</a>
<ul>
<li class="chapter" data-level="3.1" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#objectives-2"><i class="fa fa-check"></i><b>3.1</b> Objectives</a></li>
<li class="chapter" data-level="3.2" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#design"><i class="fa fa-check"></i><b>3.2</b> Design</a></li>
<li class="chapter" data-level="3.3" data-path="introduce-pubsub-as-a-communication-method.html"><a href="introduce-pubsub-as-a-communication-method.html#implementation"><i class="fa fa-check"></i><b>3.3</b> Implementation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html"><i class="fa fa-check"></i><b>4</b> Mock the Binance API</a>
<ul>
<li class="chapter" data-level="4.1" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#objectives-3"><i class="fa fa-check"></i><b>4.1</b> Objectives</a></li>
<li class="chapter" data-level="4.2" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#design-1"><i class="fa fa-check"></i><b>4.2</b> Design</a></li>
<li class="chapter" data-level="4.3" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#create-binancemock-app"><i class="fa fa-check"></i><b>4.3</b> Create “BinanceMock” app</a></li>
<li class="chapter" data-level="4.4" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-getting-exchange-info"><i class="fa fa-check"></i><b>4.4</b> Implement getting exchange info</a></li>
<li class="chapter" data-level="4.5" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-placing-buy-and-sell-orders"><i class="fa fa-check"></i><b>4.5</b> Implement placing buy and sell orders</a></li>
<li class="chapter" data-level="4.6" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-order-retrival"><i class="fa fa-check"></i><b>4.6</b> Implement order retrival</a></li>
<li class="chapter" data-level="4.7" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#implement-callback-for-incoming-trade-events"><i class="fa fa-check"></i><b>4.7</b> Implement callback for incoming trade events</a></li>
<li class="chapter" data-level="4.8" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#upgrade-trader-and-config"><i class="fa fa-check"></i><b>4.8</b> Upgrade trader and config</a></li>
<li class="chapter" data-level="4.9" data-path="mock-the-binance-api.html"><a href="mock-the-binance-api.html#test-the-implementation"><i class="fa fa-check"></i><b>4.9</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html"><i class="fa fa-check"></i><b>5</b> Enable parallel trading on multiple symbols</a>
<ul>
<li class="chapter" data-level="5.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#objectives-4"><i class="fa fa-check"></i><b>5.1</b> Objectives</a></li>
<li class="chapter" data-level="5.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#introduction---architectural-design"><i class="fa fa-check"></i><b>5.2</b> Introduction - architectural design</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#update-application-supervisor"><i class="fa fa-check"></i><b>5.2.1</b> Update application supervisor</a></li>
<li class="chapter" data-level="5.2.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#add-interface-method"><i class="fa fa-check"></i><b>5.2.2</b> Add interface method</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.symbolsupervisor"><i class="fa fa-check"></i><b>5.3</b> Implement <code>Naive.SymbolSupervisor</code></a></li>
<li class="chapter" data-level="5.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#implement-naive.leader"><i class="fa fa-check"></i><b>5.4</b> Implement <code>Naive.Leader</code></a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-leader-module"><i class="fa fa-check"></i><b>5.4.1</b> Updating the <code>leader</code> module</a></li>
<li class="chapter" data-level="5.4.2" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#updating-the-naive.trader-module"><i class="fa fa-check"></i><b>5.4.2</b> Updating the <code>Naive.Trader</code> module</a></li>
<li class="chapter" data-level="5.4.3" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#finalizing-naive.leader-implementation"><i class="fa fa-check"></i><b>5.4.3</b> Finalizing <code>Naive.Leader</code> implementation</a></li>
<li class="chapter" data-level="5.4.4" data-path="enable-parallel-trading-on-multiple-symbols.html"><a href="enable-parallel-trading-on-multiple-symbols.html#iex-testing"><i class="fa fa-check"></i><b>5.4.4</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><i class="fa fa-check"></i><b>6</b> # Chapter 6 - Introduce a <code>buy_down_interval</code> to make a single trader more profitable</a>
<ul>
<li class="chapter" data-level="6.1" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#objectives-5"><i class="fa fa-check"></i><b>6.1</b> Objectives</a></li>
<li class="chapter" data-level="6.2" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#why-we-need-to-buy-below-the-current-price-feature-overview"><i class="fa fa-check"></i><b>6.2</b> Why we need to buy below the current price? Feature overview</a></li>
<li class="chapter" data-level="6.3" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#naive.trader-implementation"><i class="fa fa-check"></i><b>6.3</b> <code>Naive.Trader</code> implementation</a></li>
<li class="chapter" data-level="6.4" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#naive.leader-implementation"><i class="fa fa-check"></i><b>6.4</b> <code>Naive.Leader</code> implementation</a>
<ul>
<li class="chapter" data-level="6.4.1" data-path="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html"><a href="chapter-6-introduce-a-buy-down-interval-to-make-a-single-trader-more-profitable.html#iex-testing-1"><i class="fa fa-check"></i><b>6.4.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html"><i class="fa fa-check"></i><b>7</b> Introduce a trader budget and calculating the quantity</a>
<ul>
<li class="chapter" data-level="7.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#objectives-6"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#fetch-step_size"><i class="fa fa-check"></i><b>7.2</b> Fetch <code>step_size</code></a></li>
<li class="chapter" data-level="7.3" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state-inside-the-leader"><i class="fa fa-check"></i><b>7.3</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>’s state inside the <code>Leader</code></a></li>
<li class="chapter" data-level="7.4" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#append-budget-and-step_size-to-the-traders-state"><i class="fa fa-check"></i><b>7.4</b> Append <code>budget</code> and <code>step_size</code> to the <code>Trader</code>’s state</a></li>
<li class="chapter" data-level="7.5" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#calculate-quantity"><i class="fa fa-check"></i><b>7.5</b> Calculate quantity</a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="introduce-a-trader-budget-and-calculating-the-quantity.html"><a href="introduce-a-trader-budget-and-calculating-the-quantity.html#iex-testing-2"><i class="fa fa-check"></i><b>7.5.1</b> IEx testing</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html"><i class="fa fa-check"></i><b>8</b> Add support for multiple transactions per order</a>
<ul>
<li class="chapter" data-level="8.1" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#objectives-7"><i class="fa fa-check"></i><b>8.1</b> Objectives</a></li>
<li class="chapter" data-level="8.2" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#issue-with-the-current-implementation"><i class="fa fa-check"></i><b>8.2</b> Issue with the current implementation</a></li>
<li class="chapter" data-level="8.3" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.3</b> Improve buy order filled callback</a></li>
<li class="chapter" data-level="8.4" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#implement-buy-order-filled-callback"><i class="fa fa-check"></i><b>8.4</b> Implement buy order “filled” callback</a></li>
<li class="chapter" data-level="8.5" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#improve-sell-order-callback"><i class="fa fa-check"></i><b>8.5</b> Improve sell order callback</a></li>
<li class="chapter" data-level="8.6" data-path="add-support-for-multiple-transactions-per-order.html"><a href="add-support-for-multiple-transactions-per-order.html#test-the-implementation-1"><i class="fa fa-check"></i><b>8.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html"><i class="fa fa-check"></i><b>9</b> Run multiple traders in parallel</a>
<ul>
<li class="chapter" data-level="9.1" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#objectives-8"><i class="fa fa-check"></i><b>9.1</b> Objectives</a></li>
<li class="chapter" data-level="9.2" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#describe-and-design-the-required-functionality"><i class="fa fa-check"></i><b>9.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="9.3" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-inside-naive.trader"><i class="fa fa-check"></i><b>9.3</b> Implement rebuy inside <code>Naive.Trader</code></a></li>
<li class="chapter" data-level="9.4" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#implement-rebuy-in-the-naive.leader"><i class="fa fa-check"></i><b>9.4</b> Implement rebuy in the <code>Naive.Leader</code></a></li>
<li class="chapter" data-level="9.5" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#improve-logs-by-assigning-ids-to-traders"><i class="fa fa-check"></i><b>9.5</b> Improve logs by assigning ids to traders</a></li>
<li class="chapter" data-level="9.6" data-path="run-multiple-traders-in-parallel.html"><a href="run-multiple-traders-in-parallel.html#test-the-implementation-2"><i class="fa fa-check"></i><b>9.6</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html"><i class="fa fa-check"></i><b>10</b> Fine-tune trading strategy per symbol</a>
<ul>
<li class="chapter" data-level="10.1" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#objectives-9"><i class="fa fa-check"></i><b>10.1</b> Objectives</a></li>
<li class="chapter" data-level="10.2" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#describe-and-design-the-required-functionality-1"><i class="fa fa-check"></i><b>10.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="10.3" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#add-docker-to-project"><i class="fa fa-check"></i><b>10.3</b> Add docker to project</a></li>
<li class="chapter" data-level="10.4" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#set-up-ecto-inside-the-naive-app"><i class="fa fa-check"></i><b>10.4</b> Set up <code>ecto</code> inside the <code>naive</code> app</a></li>
<li class="chapter" data-level="10.5" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#create-and-migrate-the-db"><i class="fa fa-check"></i><b>10.5</b> Create and migrate the DB</a></li>
<li class="chapter" data-level="10.6" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#seed-symbols-settings"><i class="fa fa-check"></i><b>10.6</b> Seed symbols’ settings</a></li>
<li class="chapter" data-level="10.7" data-path="fine-tune-trading-strategy-per-symbol.html"><a href="fine-tune-trading-strategy-per-symbol.html#update-the-naive.leader-to-fetch-settings"><i class="fa fa-check"></i><b>10.7</b> Update the <code>Naive.Leader</code> to fetch settings</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html"><i class="fa fa-check"></i><b>11</b> Supervise and autostart streaming</a>
<ul>
<li class="chapter" data-level="11.1" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#objectives-10"><i class="fa fa-check"></i><b>11.1</b> Objectives</a></li>
<li class="chapter" data-level="11.2" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#describe-and-design-the-required-functionality-2"><i class="fa fa-check"></i><b>11.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="11.3" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#register-the-streamer.binance-processes-with-names"><i class="fa fa-check"></i><b>11.3</b> Register the <code>Streamer.Binance</code> processes with names</a></li>
<li class="chapter" data-level="11.4" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#set-up-ecto-inside-the-streamer-app"><i class="fa fa-check"></i><b>11.4</b> Set up <code>ecto</code> inside the <code>streamer</code> app</a></li>
<li class="chapter" data-level="11.5" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#create-and-migrate-the-db-1"><i class="fa fa-check"></i><b>11.5</b> Create and migrate the db</a></li>
<li class="chapter" data-level="11.6" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#seed-default-settings"><i class="fa fa-check"></i><b>11.6</b> Seed default settings</a></li>
<li class="chapter" data-level="11.7" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-supervision-tree-and-start-streaming-functionality"><i class="fa fa-check"></i><b>11.7</b> Implement the supervision tree and start streaming functionality</a></li>
<li class="chapter" data-level="11.8" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-stop-functionality"><i class="fa fa-check"></i><b>11.8</b> Implement the stop functionality</a></li>
<li class="chapter" data-level="11.9" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#implement-the-autostart-streaming-functionality"><i class="fa fa-check"></i><b>11.9</b> Implement the autostart streaming functionality</a></li>
<li class="chapter" data-level="11.10" data-path="supervise-and-autostart-streaming.html"><a href="supervise-and-autostart-streaming.html#test-the-implementation-3"><i class="fa fa-check"></i><b>11.10</b> Test the implementation</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html"><i class="fa fa-check"></i><b>12</b> Start, stop, shutdown and autostart trading</a>
<ul>
<li class="chapter" data-level="12.1" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#objectives-11"><i class="fa fa-check"></i><b>12.1</b> Objectives</a></li>
<li class="chapter" data-level="12.2" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#describe-and-design-the-required-functionality-3"><i class="fa fa-check"></i><b>12.2</b> Describe and design the required functionality</a></li>
<li class="chapter" data-level="12.3" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#re-implement-the-start-trading-functionality"><i class="fa fa-check"></i><b>12.3</b> (Re-)Implement the start trading functionality</a></li>
<li class="chapter" data-level="12.4" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-stop-trading-functionality"><i class="fa fa-check"></i><b>12.4</b> Implement the stop trading functionality</a></li>
<li class="chapter" data-level="12.5" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-autostart-trading-functionality"><i class="fa fa-check"></i><b>12.5</b> Implement the autostart trading functionality</a></li>
<li class="chapter" data-level="12.6" data-path="start-stop-shutdown-and-autostart-trading.html"><a href="start-stop-shutdown-and-autostart-trading.html#implement-the-shutdown-trading-functionality"><i class="fa fa-check"></i><b>12.6</b> Implement the shutdown trading functionality</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html"><i class="fa fa-check"></i><b>13</b> Abstract duplicated supervision code</a>
<ul>
<li class="chapter" data-level="13.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#objectives-12"><i class="fa fa-check"></i><b>13.1</b> Objectives</a></li>
<li class="chapter" data-level="13.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#overview-of-requirements"><i class="fa fa-check"></i><b>13.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="13.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#pseudo-generalize-core.servicesupervisor-module"><i class="fa fa-check"></i><b>13.3</b> Pseudo generalize Core.ServiceSupervisor module</a></li>
<li class="chapter" data-level="13.4" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#utilize-pseudo-generalized-code-inside-the-naive.dynamicsymbolsupervisor"><i class="fa fa-check"></i><b>13.4</b> Utilize pseudo generalized code inside the <code>Naive.DynamicSymbolSupervisor</code></a></li>
<li class="chapter" data-level="13.5" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#implement-a-truly-generic-core.servicesupervisor"><i class="fa fa-check"></i><b>13.5</b> Implement a truly generic <code>Core.ServiceSupervisor</code></a>
<ul>
<li class="chapter" data-level="13.5.1" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#first-path-starting-with-the-fetch_symbols_to_start0-function"><i class="fa fa-check"></i><b>13.5.1</b> First path starting with the <code>fetch_symbols_to_start/0</code> function</a></li>
<li class="chapter" data-level="13.5.2" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#second-path-starting-with-the-update_status2"><i class="fa fa-check"></i><b>13.5.2</b> Second path starting with the <code>update_status/2</code></a></li>
<li class="chapter" data-level="13.5.3" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#third-path-starting-with-the-get_pid1-function"><i class="fa fa-check"></i><b>13.5.3</b> Third path starting with the <code>get_pid/1</code> function</a></li>
</ul></li>
<li class="chapter" data-level="13.6" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#remove-boilerplate-using-use-macro"><i class="fa fa-check"></i><b>13.6</b> Remove boilerplate using <code>use</code> macro</a></li>
<li class="chapter" data-level="13.7" data-path="abstract-duplicated-supervision-code.html"><a href="abstract-duplicated-supervision-code.html#use-the-core.servicesupervisor-module-inside-the-streamer-application"><i class="fa fa-check"></i><b>13.7</b> Use the <code>Core.ServiceSupervisor</code> module inside the <code>streamer</code> application</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html"><i class="fa fa-check"></i><b>14</b> Store trade events and orders inside the database</a>
<ul>
<li class="chapter" data-level="14.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#objectives-13"><i class="fa fa-check"></i><b>14.1</b> Objectives</a></li>
<li class="chapter" data-level="14.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#overview-of-requirements-1"><i class="fa fa-check"></i><b>14.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="14.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-data_warehouse-application-in-the-umbrella"><i class="fa fa-check"></i><b>14.3</b> Create a new <code>data_warehouse</code> application in the umbrella</a></li>
<li class="chapter" data-level="14.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#connect-to-the-database-using-ecto"><i class="fa fa-check"></i><b>14.4</b> Connect to the database using Ecto</a></li>
<li class="chapter" data-level="14.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-trade-events-data"><i class="fa fa-check"></i><b>14.5</b> Store trade events’ data</a></li>
<li class="chapter" data-level="14.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#store-orders-data"><i class="fa fa-check"></i><b>14.6</b> Store orders’ data</a></li>
<li class="chapter" data-level="14.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#implement-supervision"><i class="fa fa-check"></i><b>14.7</b> Implement supervision</a>
<ul>
<li class="chapter" data-level="14.7.1" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-subscriber_settings-table"><i class="fa fa-check"></i><b>14.7.1</b> Create <code>subscriber_settings</code> table</a></li>
<li class="chapter" data-level="14.7.2" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#redesign-supervision-using-registry"><i class="fa fa-check"></i><b>14.7.2</b> Redesign supervision using Registry</a></li>
<li class="chapter" data-level="14.7.3" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-the-datawarehouse.subscriber.dynamicsupervisor-module"><i class="fa fa-check"></i><b>14.7.3</b> Create the <code>DataWarehouse.Subscriber.DynamicSupervisor</code> module</a></li>
<li class="chapter" data-level="14.7.4" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#register-worker-processes-using-via"><i class="fa fa-check"></i><b>14.7.4</b> Register Worker processes using :via</a></li>
<li class="chapter" data-level="14.7.5" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#create-a-new-supervision-level-for-registry-task-and-the-dynamicsupervisor"><i class="fa fa-check"></i><b>14.7.5</b> Create a new supervision level for Registry, Task and the DynamicSupervisor</a></li>
<li class="chapter" data-level="14.7.6" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#link-the-subscribersupervisor-to-the-application"><i class="fa fa-check"></i><b>14.7.6</b> Link the <code>SubscriberSupervisor</code> to the <code>Application</code></a></li>
<li class="chapter" data-level="14.7.7" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#add-interface"><i class="fa fa-check"></i><b>14.7.7</b> Add interface</a></li>
<li class="chapter" data-level="14.7.8" data-path="store-trade-events-and-orders-inside-the-database.html"><a href="store-trade-events-and-orders-inside-the-database.html#test"><i class="fa fa-check"></i><b>14.7.8</b> Test</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="15" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html"><i class="fa fa-check"></i><b>15</b> Backtest trading strategy</a>
<ul>
<li class="chapter" data-level="15.1" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#objectives-14"><i class="fa fa-check"></i><b>15.1</b> Objectives</a></li>
<li class="chapter" data-level="15.2" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#overview-of-requirements-2"><i class="fa fa-check"></i><b>15.2</b> Overview of requirements</a></li>
<li class="chapter" data-level="15.3" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#implement-the-storing-task"><i class="fa fa-check"></i><b>15.3</b> Implement the storing task</a></li>
<li class="chapter" data-level="15.4" data-path="backtest-trading-strategy.html"><a href="backtest-trading-strategy.html#test-the-backtesting"><i class="fa fa-check"></i><b>15.4</b> Test the backtesting</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://www.bookdown.org/" target="blank">Created with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Create a cryptocurrency trading bot in Elixir</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="stream-live-crypto-prices-from-binance-wss" class="section level1" number="1">
<h1><span class="header-section-number">Chapter 1</span> Stream live crypto prices from Binance WSS</h1>
<div id="objectives" class="section level2" number="1.1">
<h2><span class="header-section-number">1.1</span> Objectives</h2>
<ul>
<li>create an umbrella app</li>
<li>create a supervised application inside an umbrella</li>
<li>connect to Binance’s WebSocket Stream using the WebSockex module</li>
<li>define a TradeEvent struct that will hold incoming data</li>
<li>decode incoming events using the Jason module</li>
</ul>
</div>
<div id="create-an-umbrella-app" class="section level2" number="1.2">
<h2><span class="header-section-number">1.2</span> Create an umbrella app</h2>
<p>In the beginning, there was nothing… so we need to create an umbrella project:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">mix</span> new hedgehog <span class="at">--umbrella</span></span></code></pre></div>
</div>
<div id="create-a-supervised-application-inside-an-umbrella" class="section level2" number="1.3">
<h2><span class="header-section-number">1.3</span> Create a supervised application inside an umbrella</h2>
<p>We can now proceed with creating a new supervised application called <code>streamer</code> inside our umbrella:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="bu">cd</span> hedgehog/apps</span>
<span id="cb2-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">mix</span> new streamer <span class="at">--sup</span></span></code></pre></div>
</div>
<div id="connect-to-binances-websocket-stream-using-the-websockex-module" class="section level2" number="1.4">
<h2><span class="header-section-number">1.4</span> Connect to Binance’s WebSocket Stream using the WebSockex module</h2>
<p>To establish a connection to Binance API’s stream, we will need to use a WebSocket client. The module that we will use is called <a href="https://github.com/Azolo/websockex">WebSockex</a>. Scrolling down to the <code>Installation</code> section inside module’s readme on Github, we are instructed what dependency we need to add to our project.</p>
<p>We will append <code>:websockex</code> to the <code>deps</code> function inside the <code>mix.exs</code> file of the <code>streamer</code> application:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb3-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb3-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/mix.exs</span></span>
<span id="cb3-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb3-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb3-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb3-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb3-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb3-4" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:websockex</span>, <span class="st">&quot;~&gt; 0.4.2&quot;</span>}</span>
<span id="cb3-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb3-5" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb3-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb3-6" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>As we added a dependency to our project, we need to fetch it using <code>mix deps.get</code>.</p>
<p>We can now progress with creating a module that will be responsible for streaming. We will create a new file called <code>binance.ex</code> inside the <code>apps/streamer/lib/streamer</code> directory.</p>
<p>From the readme of <a href="https://github.com/Azolo/websockex">WebSockex</a> module, we can see that to use it we need to create a module that will implement the <code>WebSockex</code> behavior:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb4-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># WebSockex&#39;s readme</span></span>
<span id="cb4-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">WebSocketExample</span> <span class="kw">do</span></span>
<span id="cb4-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">use</span> <span class="cn">WebSockex</span></span>
<span id="cb4-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start_link(url, state) <span class="kw">do</span></span>
<span id="cb4-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-6" aria-hidden="true" tabindex="-1"></a>    <span class="cn">WebSockex</span><span class="op">.</span>start_link(url, <span class="cn">__MODULE__</span>, state)</span>
<span id="cb4-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_frame({type, msg}, state) <span class="kw">do</span></span>
<span id="cb4-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">IO</span><span class="op">.</span>puts <span class="st">&quot;Received Message - Type: </span><span class="ot">#{</span>inspect type<span class="ot">}</span><span class="st"> -- Message: </span><span class="ot">#{</span>inspect msg<span class="ot">}</span><span class="st">&quot;</span></span>
<span id="cb4-11"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-11" aria-hidden="true" tabindex="-1"></a>    {<span class="va">:ok</span>, state}</span>
<span id="cb4-12"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-12" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-13"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_cast({<span class="va">:send</span>, {type, msg} <span class="op">=</span> frame}, state) <span class="kw">do</span></span>
<span id="cb4-15"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-15" aria-hidden="true" tabindex="-1"></a>    <span class="cn">IO</span><span class="op">.</span>puts <span class="st">&quot;Sending </span><span class="ot">#{</span>type<span class="ot">}</span><span class="st"> frame with payload: </span><span class="ot">#{</span>msg<span class="ot">}</span><span class="st">&quot;</span></span>
<span id="cb4-16"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-16" aria-hidden="true" tabindex="-1"></a>    {<span class="va">:reply</span>, frame, state}</span>
<span id="cb4-17"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb4-18"><a href="stream-live-crypto-prices-from-binance-wss.html#cb4-18" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>We will copy the whole code above across to our new <code>binance.ex</code> file.</p>
<p>The first step will be to update the module name to match our file name:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb5-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb5-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span> <span class="kw">do</span></span></code></pre></div>
<p>In the spirit of keeping things tidy - we will now remove the <code>handle_cast/2</code> function (last function in our module) as we won’t be sending any messages back to Binance via WebSocket (to place orders etc - Binance provides a REST API which we will use in the next chapter).</p>
<p>Next, let’s look up what URL should we use to connect to Binance’s API. Binance has a separate WSS (Web Socket Streams) documentation at <a href="https://github.com/binance/binance-spot-api-docs/blob/master/web-socket-streams.md">Github</a></p>
<p>Scrolling down we can see the <code>General WSS information</code> section where 3 important pieces of information are listed:</p>
<blockquote>
<p>The base endpoint is: <a href="wss://stream.binance.com:9443" class="uri">wss://stream.binance.com:9443</a>
Raw streams are accessed at /ws/<streamName>
All symbols for streams are lowercase</p>
</blockquote>
<p>We can see that the full endpoint for raw streams(we will be using a “raw” stream) will be <code>wss://stream.binance.com:9443/ws/</code> with stream name at the end (together with lowercased symbol).</p>
<p>Note: In context of Binance API, “raw” means that no aggregation was performed before broadcasting the data on WebSocket.</p>
<p>Let’s introduce a module attribute that will hold the full raw stream endpoint which will be used across the module:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb6-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb6-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="ot">@stream_endpoint</span> <span class="st">&quot;wss://stream.binance.com:9443/ws/&quot;</span></span></code></pre></div>
<p>Now back in <a href="https://github.com/binance/binance-spot-api-docs/blob/master/web-socket-streams.md">Binance’s WSS documentation</a> we need to search for “Trade Streams”. “trade” in context of this documentation means an exchange of assets(coins/tokens) by two sides (buyer and seller). Our future trading strategy will be interested in the “latest price” which is simply the last trade event’s price.</p>
<p>We can see that docs are pointing to the following stream name:</p>
<pre><code>Stream Name: &lt;symbol&gt;@trade</code></pre>
<p>Together, our full URL looks like: “<a href="wss://stream.binance.com:9443/ws/" class="uri">wss://stream.binance.com:9443/ws/</a><symbol><span class="citation">@trade</span>”.
To give a concrete example: raw trade events stream URL for symbol XRPUSDT is:
“<a href="wss://stream.binance.com:9443/ws/xrpusdt@trade" class="uri">wss://stream.binance.com:9443/ws/xrpusdt@trade</a>” (remember that symbols need to be lowercased, otherwise no trade events will get streamed - there’s <em>no</em> error).</p>
<p>Back to the IDE, we will now modify the <code>start_link/2</code> function to use Binance API’s URL:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb8-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb8-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start_link(symbol) <span class="kw">do</span></span>
<span id="cb8-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-3" aria-hidden="true" tabindex="-1"></a>    symbol <span class="op">=</span> <span class="cn">String</span><span class="op">.</span>downcase(symbol)</span>
<span id="cb8-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-5" aria-hidden="true" tabindex="-1"></a>    <span class="cn">WebSockex</span><span class="op">.</span>start_link(</span>
<span id="cb8-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-6" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="ot">#{@stream_endpoint}#{</span>symbol<span class="ot">}</span><span class="st">@trade&quot;</span>,</span>
<span id="cb8-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="cn">__MODULE__</span>,</span>
<span id="cb8-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-8" aria-hidden="true" tabindex="-1"></a>      <span class="cn">nil</span></span>
<span id="cb8-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-9" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb8-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb8-10" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>Instead of passing an URL, we modified the function to accept a <code>symbol</code>, downcase it and use it together with the module’s <code>@stream_endpoint</code> attribute to build a full URL.</p>
<p>At this moment streaming of trade events already works which we can test using <code>iex</code>:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> iex <span class="at">-S</span> mix</span>
<span id="cb9-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb9-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb9-3" aria-hidden="true" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="op">&gt;</span> Streamer.Binance.start_link<span class="kw">(</span><span class="st">&quot;xrpusdt&quot;</span><span class="kw">)</span></span>
<span id="cb9-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="ex">{:ok,</span> <span class="co">#PID&lt;0.335.0&gt;}</span></span>
<span id="cb9-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Received</span> Message <span class="at">-</span> Type: :text <span class="at">--</span> Message: <span class="st">&quot;{</span><span class="dt">\&quot;</span><span class="st">e</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">trade</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">E</span><span class="dt">\&quot;</span><span class="st">:1603226394741,</span><span class="dt">\&quot;</span><span class="st">s</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">XRPUSDT</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">t</span><span class="dt">\&quot;</span><span class="st">:74608889,</span><span class="dt">\&quot;</span><span class="st">p</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">0.24373000</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">q</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">200.00000000</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">b</span><span class="dt">\&quot;</span><span class="st">:948244411,</span><span class="dt">\&quot;</span><span class="st">a</span><span class="dt">\&quot;</span><span class="st">:948244502,</span><span class="dt">\&quot;</span><span class="st">T</span><span class="dt">\&quot;</span><span class="st">:1603226394739,</span><span class="dt">\&quot;</span><span class="st">m</span><span class="dt">\&quot;</span><span class="st">:true,</span><span class="dt">\&quot;</span><span class="st">M</span><span class="dt">\&quot;</span><span class="st">:true}&quot;</span></span>
<span id="cb9-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb9-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Received</span> Message <span class="at">-</span> Type: :text <span class="at">--</span> Message: <span class="st">&quot;{</span><span class="dt">\&quot;</span><span class="st">e</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">trade</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">E</span><span class="dt">\&quot;</span><span class="st">:1603226394741,</span><span class="dt">\&quot;</span><span class="st">s</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">XRPUSDT</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">t</span><span class="dt">\&quot;</span><span class="st">:74608890,</span><span class="dt">\&quot;</span><span class="st">p</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">0.24372000</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">q</span><span class="dt">\&quot;</span><span class="st">:</span><span class="dt">\&quot;</span><span class="st">143.20000000</span><span class="dt">\&quot;</span><span class="st">,</span><span class="dt">\&quot;</span><span class="st">b</span><span class="dt">\&quot;</span><span class="st">:948244412,</span><span class="dt">\&quot;</span><span class="st">a</span><span class="dt">\&quot;</span><span class="st">:948244502,</span><span class="dt">\&quot;</span><span class="st">T</span><span class="dt">\&quot;</span><span class="st">:1603226394739,</span><span class="dt">\&quot;</span><span class="st">m</span><span class="dt">\&quot;</span><span class="st">:true,</span><span class="dt">\&quot;</span><span class="st">M</span><span class="dt">\&quot;</span><span class="st">:true}&quot;</span></span></code></pre></div>
<p>We can see the messages logged above because we copied the sample implementation from <a href="https://github.com/Azolo/websockex">WebSockex’s readme</a> where <code>handle_frame/2</code> function uses <code>IO.puts/1</code> to print out all incoming data. The lesson here is that every incoming message from Binance will cause the <code>handle_frame/2</code> callback to be called with the message and the process’ state.</p>
<p>Just for reference, our module should look currently as follows:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb10-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb10-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span> <span class="kw">do</span></span>
<span id="cb10-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="im">use</span> <span class="cn">WebSockex</span></span>
<span id="cb10-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@stream_endpoint</span> <span class="st">&quot;wss://stream.binance.com:9443/ws/&quot;</span></span>
<span id="cb10-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start_link(symbol) <span class="kw">do</span></span>
<span id="cb10-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-8" aria-hidden="true" tabindex="-1"></a>    symbol <span class="op">=</span> <span class="cn">String</span><span class="op">.</span>downcase(symbol)</span>
<span id="cb10-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-10" aria-hidden="true" tabindex="-1"></a>    <span class="cn">WebSockex</span><span class="op">.</span>start_link(</span>
<span id="cb10-11"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-11" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;</span><span class="ot">#{@stream_endpoint}#{</span>symbol<span class="ot">}</span><span class="st">@trade&quot;</span>,</span>
<span id="cb10-12"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-12" aria-hidden="true" tabindex="-1"></a>      <span class="cn">__MODULE__</span>,</span>
<span id="cb10-13"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-13" aria-hidden="true" tabindex="-1"></a>      <span class="cn">nil</span></span>
<span id="cb10-14"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-14" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb10-15"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-15" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb10-16"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-17" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_frame({type, msg}, state) <span class="kw">do</span></span>
<span id="cb10-18"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-18" aria-hidden="true" tabindex="-1"></a>    <span class="cn">IO</span><span class="op">.</span>puts <span class="st">&quot;Received Message - Type: </span><span class="ot">#{</span>inspect type<span class="ot">}</span><span class="st"> -- Message: </span><span class="ot">#{</span>inspect msg<span class="ot">}</span><span class="st">&quot;</span></span>
<span id="cb10-19"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-19" aria-hidden="true" tabindex="-1"></a>    {<span class="va">:ok</span>, state}</span>
<span id="cb10-20"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb10-21"><a href="stream-live-crypto-prices-from-binance-wss.html#cb10-21" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
</div>
<div id="decode-incoming-events-using-the-jason-module" class="section level2" number="1.5">
<h2><span class="header-section-number">1.5</span> Decode incoming events using the Jason module</h2>
<p>Currently, all incoming data from WebSocket is encoded as a JSON. To decode JSON we will use the <a href="https://github.com/michalmuskala/jason">jason</a> module.</p>
<p>Scrolling down to the <code>Installation</code> section inside module’s readme, we can see that we need to add it to the dependencies and we can start to use it right away.</p>
<p>Let’s open the <code>mix.exs</code> file of the <code>streamer</code> application and append the <code>:jason</code> dependency to the list inside <code>deps</code> function:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb11-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/mix.exs</span></span>
<span id="cb11-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> deps <span class="kw">do</span></span>
<span id="cb11-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-3" aria-hidden="true" tabindex="-1"></a>    [</span>
<span id="cb11-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-4" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:jason</span>, <span class="st">&quot;~&gt; 1.2&quot;</span>},</span>
<span id="cb11-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-5" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:websockex</span>, <span class="st">&quot;~&gt; 0.4.2&quot;</span>}</span>
<span id="cb11-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-6" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb11-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb11-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>As previously, don’t forget to run <code>mix deps.get</code> to fetch the new dependency.</p>
<p>Looking through the documentation of the Jason module we can see <code>encode!/2</code> and <code>decode!/2</code> functions, both of them have exclamation marks which indicates that they will throw an error whenever they will be unable to successfully encode or decode the passed value.</p>
<p>This is less than perfect for our use case as we would like to handle those errors in our own way(technically we could just use try/rescue but as we will find out both <code>encode/2</code> and <code>decode/2</code> are available).</p>
<p>We will go a little bit off-topic but I would highly recommend those sorts of journeys around somebody’s code. Let’s look inside the <a href="https://github.com/michalmuskala/jason/blob/master/lib/jason.ex">Jason</a> module. Scrolling down in search of <code>decode/2</code> (without the exclamation mark) we can see it about line 54:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb12-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb12-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /lib/jason.ex</span></span>
<span id="cb12-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb12-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> decode(input, opts \\ []) <span class="kw">do</span></span>
<span id="cb12-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb12-3" aria-hidden="true" tabindex="-1"></a>    input <span class="op">=</span> <span class="cn">IO</span><span class="op">.</span>iodata_to_binary(input)</span>
<span id="cb12-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb12-4" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Decoder</span><span class="op">.</span>parse(input, format_decode_opts(opts))</span>
<span id="cb12-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb12-5" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>It looks like it uses the <code>parse/2</code> function of a <code>Decoder</code> module, let’s scroll back up and check where it’s coming from. At line 6:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb13-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /lib/jason.ex</span></span>
<span id="cb13-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="im">alias</span> <span class="cn">Jason</span><span class="op">.</span>{<span class="cn">Encode</span>, <span class="cn">Decoder</span>, <span class="cn">DecodeError</span>, <span class="cn">EncodeError</span>, <span class="cn">Formatter</span>}</span></code></pre></div>
<p>we can see that <code>Decoder</code> is an alias of the <a href="https://github.com/michalmuskala/jason/blob/master/lib/decoder.ex"><code>Jason.Decoder</code></a>. Scrolling down to the <code>Jason.Decoder</code> module we will find a <code>parse/2</code> function about line 43:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb14-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /lib/decoder.ex</span></span>
<span id="cb14-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> parse(data, opts) <span class="kw">when</span> is_binary(data) <span class="kw">do</span></span>
<span id="cb14-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-3" aria-hidden="true" tabindex="-1"></a>    key_decode <span class="op">=</span> key_decode_function(opts)</span>
<span id="cb14-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    string_decode <span class="op">=</span> string_decode_function(opts)</span>
<span id="cb14-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">try</span> <span class="kw">do</span></span>
<span id="cb14-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-6" aria-hidden="true" tabindex="-1"></a>      value(data, data, <span class="dv">0</span>, [<span class="ot">@terminate</span>], key_decode, string_decode)</span>
<span id="cb14-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-7" aria-hidden="true" tabindex="-1"></a>    <span class="cf">catch</span></span>
<span id="cb14-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-8" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:position</span>, position} <span class="op">-&gt;</span></span>
<span id="cb14-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-9" aria-hidden="true" tabindex="-1"></a>        {<span class="va">:error</span>, %<span class="cn">DecodeError</span>{<span class="va">position:</span> position, <span class="va">data:</span> data}}</span>
<span id="cb14-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-10" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:token</span>, token, position} <span class="op">-&gt;</span></span>
<span id="cb14-11"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-11" aria-hidden="true" tabindex="-1"></a>        {<span class="va">:error</span>, %<span class="cn">DecodeError</span>{<span class="va">token:</span> token, <span class="va">position:</span> position, <span class="va">data:</span> data}}</span>
<span id="cb14-12"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span></span>
<span id="cb14-13"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-13" aria-hidden="true" tabindex="-1"></a>      value <span class="op">-&gt;</span></span>
<span id="cb14-14"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-14" aria-hidden="true" tabindex="-1"></a>        {<span class="va">:ok</span>, value}</span>
<span id="cb14-15"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-15" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb14-16"><a href="stream-live-crypto-prices-from-binance-wss.html#cb14-16" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>Based on the result of decoding it will either return <code>{:ok, value}</code> or <code>{:error, %Decode.Error{...}}</code> we can confirm that by digging through documentation of the module on <a href="https://hexdocs.pm/jason/Jason.html#decode/2">hex</a>.</p>
<p>Once again, the point of this lengthy investigation was to show that Elixir code is readable and easy to understand so don’t be thrown off when documentation is a little bit light, quite opposite, contribute to docs and code as you gain an better understanding of the codebase.</p>
<p>We can now get back to our <code>Streamer.Binance</code> module and modify the <code>handle_frame/2</code> function to decode the incoming JSON message. Based on the result of <code>Jason.decode/2</code> we will either call the <code>process_event/2</code> function or log an error. Here’s the new version of the <code>handle_frame/2</code> function:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb15-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb15-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> handle_frame({_type, msg}, state) <span class="kw">do</span></span>
<span id="cb15-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">case</span> <span class="cn">Jason</span><span class="op">.</span>decode(msg) <span class="kw">do</span></span>
<span id="cb15-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-4" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:ok</span>, event} <span class="op">-&gt;</span> process_event(event)</span>
<span id="cb15-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-5" aria-hidden="true" tabindex="-1"></a>      {<span class="va">:error</span>, _} <span class="op">-&gt;</span> <span class="cn">Logger</span><span class="op">.</span>error(<span class="st">&quot;Unable to parse msg: </span><span class="ot">#{</span>msg<span class="ot">}</span><span class="st">&quot;</span>)</span>
<span id="cb15-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">end</span></span>
<span id="cb15-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-8" aria-hidden="true" tabindex="-1"></a>    {<span class="va">:ok</span>, state}</span>
<span id="cb15-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>Please make note that <code>type</code> is now prefixed with an underscore as we aren’t using it at the moment.</p>
<p>Second important thing to note is that we are using <code>Logger</code> so it needs to be <code>require</code>d at the begining of the module:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb16-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb16-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb16-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="im">require</span> <span class="cn">Logger</span></span></code></pre></div>
<p>Before implementing the <code>process_event/2</code> function we need to create a structure that will hold the incoming trade event’s data.</p>
<p>Let’s create a new directory called <code>binance</code> inside the <code>apps/streamer/lib/streamer/</code> and new file called <code>trade_event.ex</code> inside it.</p>
<p>Our new module will hold all the trade event’s information but we will also use readable field names(you will see the incoming data below). We can start by writing a skeleton module code:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb17-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/streamer/lib/streamer/binance/trade_event.ex</span></span>
<span id="cb17-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb17-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">TradeEvent</span> <span class="kw">do</span></span>
<span id="cb17-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb17-3" aria-hidden="true" tabindex="-1"></a>    <span class="kw">defstruct</span> []</span>
<span id="cb17-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb17-4" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>We can refer to <a href="https://github.com/binance/binance-spot-api-docs/blob/master/web-socket-streams.md#trade-streams">Binance’s docs</a> to get a list of fields:</p>
<pre><code>{
  &quot;e&quot;: &quot;trade&quot;,     // Event type
  &quot;E&quot;: 123456789,   // Event time
  &quot;s&quot;: &quot;BNBUSDT&quot;,   // Symbol
  &quot;t&quot;: 12345,       // Trade ID
  &quot;p&quot;: &quot;0.001&quot;,     // Price
  &quot;q&quot;: &quot;100&quot;,       // Quantity
  &quot;b&quot;: 88,          // Buyer order ID
  &quot;a&quot;: 50,          // Seller order ID
  &quot;T&quot;: 123456785,   // Trade time
  &quot;m&quot;: true,        // Is the buyer the market maker?
  &quot;M&quot;: true         // Ignore
}</code></pre>
<p>Let’s copy them across and convert the comments to update the <code>defstruct</code> inside the
<code>Streamer.Binance.TradeEvent</code> module’s struct to following:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb19-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/lib/streamer/binance/trade_event.ex</span></span>
<span id="cb19-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defstruct</span> [</span>
<span id="cb19-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">:event_type</span>,</span>
<span id="cb19-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-4" aria-hidden="true" tabindex="-1"></a>    <span class="va">:event_time</span>,</span>
<span id="cb19-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">:symbol</span>,</span>
<span id="cb19-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">:trade_id</span>,</span>
<span id="cb19-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">:price</span>,</span>
<span id="cb19-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">:quantity</span>,</span>
<span id="cb19-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">:buyer_order_id</span>,</span>
<span id="cb19-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">:seller_order_id</span>,</span>
<span id="cb19-11"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-11" aria-hidden="true" tabindex="-1"></a>    <span class="va">:trade_time</span>,</span>
<span id="cb19-12"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">:buyer_market_maker</span></span>
<span id="cb19-13"><a href="stream-live-crypto-prices-from-binance-wss.html#cb19-13" aria-hidden="true" tabindex="-1"></a>  ]</span></code></pre></div>
<p>That’s all for this struct, we can now get back to implementing the <code>process_event/2</code> function inside the <code>Streamer.Binance</code> module. We will map every field of the response map to the <code>%Streamer.Binance.TradeEvent</code> struct. A useful trick here would be to copy the list of fields once again from the struct and assign the incoming fields one by one.
Inside the header of the function, we will pattern match on event type(a field called “e” in the message) to confirm that indeed we received a trade event). In the end, the <code>process_event/2</code> function should look as follows:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb20-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-1" aria-hidden="true" tabindex="-1"></a>  <span class="co"># /apps/streamer/lib/streamer/binance.ex</span></span>
<span id="cb20-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-2" aria-hidden="true" tabindex="-1"></a>  <span class="kw">defp</span> process_event(%{<span class="st">&quot;e&quot;</span> <span class="op">=&gt;</span> <span class="st">&quot;trade&quot;</span>} <span class="op">=</span> event) <span class="kw">do</span></span>
<span id="cb20-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-3" aria-hidden="true" tabindex="-1"></a>    trade_event <span class="op">=</span> %<span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span><span class="cn">TradeEvent</span>{</span>
<span id="cb20-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-4" aria-hidden="true" tabindex="-1"></a>      <span class="va">:event_type</span> <span class="op">=&gt;</span> event[<span class="st">&quot;e&quot;</span>],</span>
<span id="cb20-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-5" aria-hidden="true" tabindex="-1"></a>      <span class="va">:event_time</span> <span class="op">=&gt;</span> event[<span class="st">&quot;E&quot;</span>],</span>
<span id="cb20-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-6" aria-hidden="true" tabindex="-1"></a>      <span class="va">:symbol</span> <span class="op">=&gt;</span> event[<span class="st">&quot;s&quot;</span>],</span>
<span id="cb20-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">:trade_id</span> <span class="op">=&gt;</span> event[<span class="st">&quot;t&quot;</span>],</span>
<span id="cb20-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-8" aria-hidden="true" tabindex="-1"></a>      <span class="va">:price</span> <span class="op">=&gt;</span> event[<span class="st">&quot;p&quot;</span>],</span>
<span id="cb20-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-9" aria-hidden="true" tabindex="-1"></a>      <span class="va">:quantity</span> <span class="op">=&gt;</span> event[<span class="st">&quot;q&quot;</span>],</span>
<span id="cb20-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-10" aria-hidden="true" tabindex="-1"></a>      <span class="va">:buyer_order_id</span> <span class="op">=&gt;</span> event[<span class="st">&quot;b&quot;</span>],</span>
<span id="cb20-11"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-11" aria-hidden="true" tabindex="-1"></a>      <span class="va">:seller_order_id</span> <span class="op">=&gt;</span> event[<span class="st">&quot;a&quot;</span>],</span>
<span id="cb20-12"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-12" aria-hidden="true" tabindex="-1"></a>      <span class="va">:trade_time</span> <span class="op">=&gt;</span> event[<span class="st">&quot;T&quot;</span>],</span>
<span id="cb20-13"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-13" aria-hidden="true" tabindex="-1"></a>      <span class="va">:buyer_market_maker</span> <span class="op">=&gt;</span> event[<span class="st">&quot;m&quot;</span>]</span>
<span id="cb20-14"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb20-15"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-16"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-16" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Logger</span><span class="op">.</span>debug(</span>
<span id="cb20-17"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-17" aria-hidden="true" tabindex="-1"></a>      <span class="st">&quot;Trade event received &quot;</span> <span class="op">&lt;&gt;</span></span>
<span id="cb20-18"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-18" aria-hidden="true" tabindex="-1"></a>        <span class="st">&quot;</span><span class="ot">#{</span>trade_event<span class="op">.</span>symbol<span class="ot">}</span><span class="st">@</span><span class="ot">#{</span>trade_event<span class="op">.</span>price<span class="ot">}</span><span class="st">&quot;</span></span>
<span id="cb20-19"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-19" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb20-20"><a href="stream-live-crypto-prices-from-binance-wss.html#cb20-20" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span></code></pre></div>
<p>We added the <code>Logger.debug/2</code> function to be able to see logs of incoming trade events.</p>
<p>Lastly, before testing our implementation, let’s add a nice interface to our <code>streamer</code> application that allows to start streaming:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb21-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /apps/streamer/lib/streamer.ex</span></span>
<span id="cb21-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="kw">defmodule</span> <span class="cn">Streamer</span> <span class="kw">do</span></span>
<span id="cb21-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-3" aria-hidden="true" tabindex="-1"></a>  <span class="ot">@moduledoc &quot;&quot;&quot;</span></span>
<span id="cb21-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-4" aria-hidden="true" tabindex="-1"></a><span class="co">  Documentation for </span><span class="in">`Streamer`</span><span class="co">.</span></span>
<span id="cb21-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-5" aria-hidden="true" tabindex="-1"></a><span class="co">  </span><span class="ot">&quot;&quot;&quot;</span></span>
<span id="cb21-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">def</span> start_streaming(symbol) <span class="kw">do</span></span>
<span id="cb21-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-8" aria-hidden="true" tabindex="-1"></a>    <span class="cn">Streamer</span><span class="op">.</span><span class="cn">Binance</span><span class="op">.</span>start_link(symbol)</span>
<span id="cb21-9"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">end</span></span>
<span id="cb21-10"><a href="stream-live-crypto-prices-from-binance-wss.html#cb21-10" aria-hidden="true" tabindex="-1"></a><span class="kw">end</span></span></code></pre></div>
<p>The final version of the <code>Streamer.Binance</code> module should look like <a href="https://github.com/frathon/create-a-cryptocurrency-trading-bot-in-elixir-source-code/blob/chapter_01/apps/streamer/lib/streamer/binance.ex">this</a>.</p>
<p>Last step will be to add the <code>Logger</code> configuration into main <code>config/config.exs</code> file. We will set the <code>Logger</code> level to <code>:debug</code> for a moment to be able to see incoming trade events:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb22-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb22-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb22-2" aria-hidden="true" tabindex="-1"></a>config <span class="va">:logger</span>,</span>
<span id="cb22-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb22-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">level:</span> <span class="va">:debug</span></span></code></pre></div>
<p>This finishes the implementation part of this chapter, we can now give our implementation a whirl using <code>iex</code>:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode bash"><code class="sourceCode bash"><span id="cb23-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> iex <span class="at">-S</span> mix</span>
<span id="cb23-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="ex">...</span></span>
<span id="cb23-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="ex">iex</span><span class="er">(</span><span class="ex">1</span><span class="kw">)</span><span class="op">&gt;</span> Streamer.start_streaming<span class="kw">(</span><span class="st">&quot;xrpusdt&quot;</span><span class="kw">)</span></span>
<span id="cb23-4"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="ex">{:ok,</span> <span class="co">#PID&lt;0.251.0&gt;}</span></span>
<span id="cb23-5"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="ex">23:14:32.217</span> [debug] Trade event received XRPUSDT@0.25604000</span>
<span id="cb23-6"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="ex">23:14:33.381</span> [debug] Trade event received XRPUSDT@0.25604000</span>
<span id="cb23-7"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="ex">23:14:35.380</span> [debug] Trade event received XRPUSDT@0.25605000</span>
<span id="cb23-8"><a href="stream-live-crypto-prices-from-binance-wss.html#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="ex">23:14:36.386</span> [debug] Trade event received XRPUSDT@0.25606000</span></code></pre></div>
<p>As we can see, the streamer is establishing a WebSocket connection with the Binance’s API and it’s receiving trade events. It decodes them from JSON to <code>%Streamer.Binance.TradeEvent</code> struct and logs a compiled message. Also, our interface hides implementation details from the “user” of our application.</p>
<p>We will now flip the <code>Logger</code> level back to <code>info</code> so the output won’t every incoming trade event:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode elixir"><code class="sourceCode elixir"><span id="cb24-1"><a href="stream-live-crypto-prices-from-binance-wss.html#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># /config/config.exs</span></span>
<span id="cb24-2"><a href="stream-live-crypto-prices-from-binance-wss.html#cb24-2" aria-hidden="true" tabindex="-1"></a>config <span class="va">:logger</span>,</span>
<span id="cb24-3"><a href="stream-live-crypto-prices-from-binance-wss.html#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">level:</span> <span class="va">:info</span></span></code></pre></div>
<p>[Note] Please remember to run <code>mix format</code> to keep things nice and tidy.</p>
<p>Source code for this chapter can be found at <a href="https://github.com/frathon/create-a-cryptocurrency-trading-bot-in-elixir-source-code/tree/chapter_01">Github</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="create-a-naive-trading-strategy-a-single-trader-process-without-supervision.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/frathon/create-a-cryptocurrency-trading-bot-in-elixir/edit/master/01-stream-crypto-prices.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["create-a-cryptocurrency-trading-bot-in-elixir.pdf", "create-a-cryptocurrency-trading-bot-in-elixir.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
